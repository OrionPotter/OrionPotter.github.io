<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="OrionPotter" />










<meta property="og:type" content="website">
<meta property="og:title" content="Orion Potter&#39;s 个人博客">
<meta property="og:url" content="https://blog.orionpotter.space/page/5/index.html">
<meta property="og:site_name" content="Orion Potter&#39;s 个人博客">
<meta property="og:locale">
<meta property="article:author" content="Orion Potter">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.orionpotter.space/page/5/"/>





  <title>Orion Potter's 个人博客</title>
  








<meta name="generator" content="Hexo 6.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Orion Potter's 个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-folder"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/Geoserver.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/Geoserver.html" itemprop="url">安装GeoServer</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="离线安装GeoServer"><a href="#离线安装GeoServer" class="headerlink" title="离线安装GeoServer"></a>离线安装GeoServer</h2><blockquote>
<p>前提：安装好java,配置好JAVA_HOME</p>
</blockquote>
<p>1.准备源码包</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">https://jaist.dl.sourceforge.net/project/geoserver/GeoServer/2.15.1/geoserver-2.15.1-bin.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.解压</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> geoserver-2.15.1-bin.zip <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.修改端口</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> geoserver-2.15.1
<span class="token function">vi</span> start.ini 
<span class="token assign-left variable">jetty.port</span><span class="token operator">=</span><span class="token number">8181</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>4.启动程序</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> bin
./startup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.后台启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nohup</span> /root/geoserver-2.15.1/bin/startup.sh <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="geoserver跨域配置"><a href="#geoserver跨域配置" class="headerlink" title="geoserver跨域配置"></a>geoserver跨域配置</h2><p>1.查看对应的版本</p>
<blockquote>
<p>启动程序后，默认用户名&#x2F;密码登陆进去，F12抓取一下Response Header,Server里面有版本号</p>
</blockquote>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">Cache-Control: no-cache, no-store
Content-Length: 0
Date: Mon, 23 May 2022 07:56:02 GMT
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Location: http://180.76.187.95:8181/geoserver/web/?0
Pragma: no-cache
Server: Jetty(9.4.12.v20180830)
Set-Cookie: JSESSIONID=node012k3zcl8cf6121wuziii0dzvt75.node0;Path=/geoserver
X-Frame-Options: SAMEORIGIN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.下载jar包</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.eclipse.jetty/jetty-server --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.eclipse.jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jetty-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>9.4.12.v20180830<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3.上传jar包</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">上传路径 /root/geoserver-2.15.1/webapps/geoserver/WEB-INF/lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4.修改配置</p>
<pre class="line-numbers language-web.xml" data-language="web.xml"><code class="language-web.xml">vim &#x2F;root&#x2F;geoserver-2.15.1&#x2F;webapps&#x2F;geoserver&#x2F;WEB-INF&#x2F;web.xml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>CORS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>com.thetransactioncompany.cors.CORSFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>cors.allowOrigin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>cors.supportedMethods<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>GET,POST,HEAD,PUT,DELETE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>cors.supportedHeaders<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>Accept,Origin,X-Requested-With,Content-Type,Last-Modified<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>cors.exposedHeaders<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>Set-Cookie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>cors.supportsCredentials<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>CORS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/GithubAction.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/GithubAction.html" itemprop="url">Github</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git的通信协议"><a href="#git的通信协议" class="headerlink" title="git的通信协议"></a>git的通信协议</h1><h2 id="ssh协议"><a href="#ssh协议" class="headerlink" title="ssh协议"></a>ssh协议</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone git@github.com:BJPotter/BJPotter.github.io.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="https协议"><a href="#https协议" class="headerlink" title="https协议"></a>https协议</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/BJPotter/BJPotter.github.io.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="gitHub-Cli协议"><a href="#gitHub-Cli协议" class="headerlink" title="gitHub Cli协议"></a>gitHub Cli协议</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gh repo clone BJPotter/BJPotter.github.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="gitHub配置SSH-Key"><a href="#gitHub配置SSH-Key" class="headerlink" title="gitHub配置SSH Key"></a>gitHub配置SSH Key</h1><h2 id="设置git的用户名和邮箱"><a href="#设置git的用户名和邮箱" class="headerlink" title="设置git的用户名和邮箱"></a>设置git的用户名和邮箱</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在Git客户端执行</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"这里输入你在GitHub的账户名"</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"这里输入你在GitHub的注册邮箱名"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="生成SSH-Key"><a href="#生成SSH-Key" class="headerlink" title="生成SSH Key"></a>生成<strong>SSH Key</strong></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/.ssh
ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"这里输入你在 GitHub 的注册邮箱"</span>
<span class="token function">cat</span> id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="gitHub配置公钥"><a href="#gitHub配置公钥" class="headerlink" title="gitHub配置公钥"></a>gitHub配置公钥</h2><blockquote>
<p>在github中点击头像，依次点击Settings &gt; SSH and GPG Keys &gt; New SSH Key</p>
<p>把客户端的公钥复制到里面，并给title起一个名字保存即可</p>
</blockquote>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-T</span> git@github.com
<span class="token comment"># 返回 You've successfully authenticated则成功 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="https免密配置"><a href="#https免密配置" class="headerlink" title="https免密配置"></a>https免密配置</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 输入一次账号密码后第二次就会记住账号密码。</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> credential.helper store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h1 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h1><h2 id="什么是Actions"><a href="#什么是Actions" class="headerlink" title="什么是Actions"></a>什么是Actions</h2><blockquote>
<p>github action是一种持续集成和持续交付的（CI&#x2F;CD）平台，可用于自动执行生成、测试和部署管道。在github创建的仓库中，Actions是可以自定义的一些列的操作，如：提交代码后触发自动化编译打包和部署到远程服务器上，官方所说的定义是：在仓库中自动化、自定义操作执行软件开发工作流程，目前有很多现成的Actions可以直接拿来使用，也可以进行自定义创建到自己工作流程中。</p>
</blockquote>
<h2 id="Actions可以做什么"><a href="#Actions可以做什么" class="headerlink" title="Actions可以做什么"></a>Actions可以做什么</h2><blockquote>
<p>Actions通常用来两个方面</p>
<ol>
<li>自动化ci&#x2F;cd,触发事件后自动化编译打包部署。</li>
<li>自动添加标签，当有人提issues的时候可以自动化的添加标签</li>
</ol>
</blockquote>
<h2 id="Actions组件"><a href="#Actions组件" class="headerlink" title="Actions组件"></a>Actions组件</h2><blockquote>
<p>可以把Github Actions 工作流程配置为在存储库发生事件触发。</p>
<p>example: 拉取请求或者推送请求的时候触发工作流程[工作流程理解为jobs]</p>
<p>一个工作流程包含一个作业或者多个作业，这些作业可以按照顺序执行，也可以并发执行，每个作业都会在自己虚拟机中进行，或者在容器中进行，这个运行的进程可以理解为运行了一个runner,每个作业可能会有多个步骤，这个步骤运行自定义的脚本或者运行操作。</p>
</blockquote>
<img src="/images/action.png" style="zoom:50%;">

<h3 id="Workflows（工作流）"><a href="#Workflows（工作流）" class="headerlink" title="Workflows（工作流）"></a><strong>Workflows（工作流）</strong></h3><blockquote>
<p>工作流是一个可配置的自动化的程序。创建一个工作流，你需要定义一个 YAML 文件，当你的仓库触发某个事件的时候，工作流就会运行，当然也可以手动触发，或者定义一个时间表。</p>
</blockquote>
<h3 id="事件（Events）"><a href="#事件（Events）" class="headerlink" title="事件（Events）"></a><strong>事件（Events）</strong></h3><blockquote>
<p>事件是指仓库触发运行工作流的具体的行为，比如创建一个 pull request，新建一个 issue、或者推送一个 commit。你也可以使用时间表触发一个工作流，或者通过请求一个 REST API，再或者手动触发。</p>
</blockquote>
<h3 id="任务（Jobs）"><a href="#任务（Jobs）" class="headerlink" title="任务（Jobs）"></a><strong>任务（Jobs）</strong></h3><blockquote>
<p>任务是在同一个运行器上执行的一组步骤（steps）。一个步骤（steps）要么是一个shell 脚本（script）要么是一个动作（action）。步骤会顺序执行，并彼此独立。因为每一个步骤都在同一个运行器上被执行，所以你可以从一个步骤（step）传递数据到另一个步骤（step）。</p>
</blockquote>
<h3 id="动作（Actions）"><a href="#动作（Actions）" class="headerlink" title="动作（Actions）"></a><strong>动作（Actions）</strong></h3><blockquote>
<p>动作是 GitHub Actions 平台的一个自定义的应用，它会执行一个复杂但是需要频繁重复的作业。使用动作可以减少重复代码。比如一个 action 可以实现从 GitHub 拉取你的 git 仓库，为你的构建环境创建合适的工具链等。</p>
</blockquote>
<h3 id="运行器（Runners）"><a href="#运行器（Runners）" class="headerlink" title="运行器（Runners）"></a><strong>运行器（Runners）</strong></h3><blockquote>
<p>一个运行器是一个可以运行工作流的服务。每一个运行器一次只运行一个单独的任务。GitHub 提供 Ubuntu Linux，Microsoft Windows 和 macOS 运行器，每一个工作流都运行在一个独立新建的虚拟机中。</p>
</blockquote>
<h2 id="工作流参数"><a href="#工作流参数" class="headerlink" title="工作流参数"></a><strong>工作流参数</strong></h2><p>工作流程是一个可配置的自动化过程，它将运行一个或多个作业。 工作流程由签入到存储库的 YAML 文件定义，并在存储库中的事件触发时运行，也可以手动触发，或按定义的时间表触发。文件位于仓库的根目录下的<code>.github/workflows</code></p>
<h3 id="触发工作流程"><a href="#触发工作流程" class="headerlink" title="触发工作流程"></a>触发工作流程</h3><ol>
<li><p>工作流程存储库发生事件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 单个事件触发</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span> push
<span class="token comment"># 多个事件触发</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">,</span> fork<span class="token punctuation">]</span>
<span class="token comment"># 限定master分支发生push事件触发</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>    
      <span class="token punctuation">-</span> master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>预定时间</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 示例在每天 5:30 和 17:30 UTC 触发工作流程</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">schedule</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span>  <span class="token string">'30 5,17 * * *'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="使用作业"><a href="#使用作业" class="headerlink" title="使用作业"></a>使用作业</h3><ol>
<li>创建jobs</li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># workflow主体是jobs字段，表示要执行的一项或者多项任务jobs.&lt;job_id>.name job_id：名称自定义 name：任务的说明</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token comment">#作业id</span>
  <span class="token key atrule">my_first_job</span><span class="token punctuation">:</span>
  	<span class="token comment">#作业名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> My first job
  <span class="token key atrule">my_second_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> My second job
<span class="token comment"># jobs.&lt;job_id>.needs needs字段指定当前任务的依赖关系，即运行顺序，这个 workflow 的运行顺序依次为：job1、job2、job3</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">job1</span><span class="token punctuation">:</span>
  <span class="token key atrule">job2</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> job1
  <span class="token key atrule">job3</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>job1<span class="token punctuation">,</span> job2<span class="token punctuation">]</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>选择运行器</li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># jobs.&lt;job_id>.runs-on runs-on字段指定运行所需要的虚拟机环境。它是必填字段，目前可以使用的虚拟机如下</span>
<span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/images/runner.png" style="zoom:50%;">

<blockquote>
<p>以上是常见的运行器，就是用哪个虚拟机</p>
</blockquote>
<ol start="3">
<li>运行步骤</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"># jobs.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>job_id</span><span class="token punctuation">></span></span>.steps
# steps字段指定每个 Job 的运行步骤，可以包含一个或多个步骤。每个步骤都可以指定以下三个字段。
# 步骤名称。
jobs.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>job_id</span><span class="token punctuation">></span></span>.steps.name
# 该步骤运行的命令或者 action
jobs.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>job_id</span><span class="token punctuation">></span></span>.steps.run
# 该步骤所需的环境变量
jobs.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>job_id</span><span class="token punctuation">></span></span>.steps.env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="maven打jar包示例"><a href="#maven打jar包示例" class="headerlink" title="maven打jar包示例"></a>maven打jar包示例</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"># .github/workflows/maven.yml 
name: Java CI with Maven
on:
  push:
    branches: [ "master" ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven
      run: mvn -B clean package
    # Optional: Uploads the JAR file as an artifact
    - name: Upload JAR
      uses: actions/upload-artifact@v2
      with:
        name: DataHub
        path: target/*.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/JWT%E5%AE%9E%E8%B7%B5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/JWT%E5%AE%9E%E8%B7%B5.html" itemprop="url">基于SpringBoot+SpringSecurity+JWT认证实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/authorization/" itemprop="url" rel="index">
                    <span itemprop="name">authorization</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="认证流程原理"><a href="#认证流程原理" class="headerlink" title="认证流程原理"></a>认证流程原理</h1><h2 id="跨域认证的问题"><a href="#跨域认证的问题" class="headerlink" title="跨域认证的问题"></a>跨域认证的问题</h2><p>互联网服务离不开用户认证。一般流程是下面这样。</p>
<blockquote>
<p>1、用户向服务器发送用户名和密码。</p>
<p>2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p>
<p>3、服务器向用户返回一个 session_id，写入用户的 Cookie。</p>
<p>4、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</p>
<p>5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p>
</blockquote>
<p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p>
<h2 id="JWT-JSON-Web-Token"><a href="#JWT-JSON-Web-Token" class="headerlink" title="JWT (JSON Web Token)"></a>JWT (JSON Web Token)</h2><p>JWT是一种用于在各方之间作为JSON对象安全传输信息的紧凑、URL安全的令牌。它由三部分组成：</p>
<ul>
<li><strong>Header</strong>：包含令牌类型（通常为JWT）和签名算法（例如HMAC SHA256）。</li>
<li><strong>Payload</strong>：包含声明（claims），即传输的数据。常见的声明包括：用户ID、用户名、过期时间等。</li>
<li><strong>Signature</strong>：用于验证令牌的真实性。它是由Header和Payload通过签名算法和密钥生成的。</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">Header<span class="token punctuation">.</span>Payload<span class="token punctuation">.</span>Signature<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>Header 部分是一个 JSON 对象，描述 JWT 的元数据，通常是下面的样子。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>上面代码中，<code>alg</code>属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；<code>typ</code>属性表示这个令牌（token）的类型（type），JWT 令牌统一写为<code>JWT</code>。</p>
<p>最后，将上面的 JSON 对象使用 Base64URL 算法（详见后文）转成字符串。</p>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p>
<blockquote>
<ul>
<li>iss (issuer)：签发人</li>
<li>exp (expiration time)：过期时间</li>
<li>sub (subject)：主题</li>
<li>aud (audience)：受众</li>
<li>nbf (Not Before)：生效时间</li>
<li>iat (Issued At)：签发时间</li>
<li>jti (JWT ID)：编号</li>
</ul>
</blockquote>
<p>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"sub"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"admin"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在这个部分。</p>
<p>这个 JSON 对象也要使用 Base64URL 算法转成字符串。</p>
<h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><p>Signature 部分是对前两部分的签名，防止数据篡改。</p>
<p>首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户。然后，使用 Header 里面指定的签名算法（默认是 HMAC SHA256），按照下面的公式产生签名。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">HMACSHA256</span><span class="token punctuation">(</span>
  <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span>
  <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
  secret<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用”点”（<code>.</code>）分隔，就可以返回给用户。</p>
<h2 id="JWT-的使用方式"><a href="#JWT-的使用方式" class="headerlink" title="JWT 的使用方式"></a>JWT 的使用方式</h2><p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</p>
<p>此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息<code>Authorization</code>字段里面。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">Authorization</span><span class="token operator">:</span> Bearer <span class="token operator">&lt;</span>token<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>另一种做法是，跨域的时候，JWT 就放在 POST 请求的数据体里面。</p>
<h2 id="认证流程"><a href="#认证流程" class="headerlink" title="认证流程"></a>认证流程</h2><ol>
<li><strong>用户登录</strong>：用户提交用户名和密码。</li>
<li><strong>认证服务器验证</strong>：服务器验证用户信息，成功后生成JWT令牌。</li>
<li><strong>返回令牌</strong>：服务器将JWT令牌返回给客户端。</li>
<li><strong>客户端存储令牌</strong>：客户端存储令牌（通常在本地存储或Cookie中）。</li>
<li><strong>请求资源</strong>：客户端在每次请求资源时，将JWT令牌放入HTTP请求头中。</li>
<li><strong>服务器验证令牌</strong>：服务器验证JWT令牌的有效性，若有效则返回请求的资源。</li>
</ol>
<h1 id="编程步骤"><a href="#编程步骤" class="headerlink" title="编程步骤"></a>编程步骤</h1><h2 id="创建SpringBoot项目"><a href="#创建SpringBoot项目" class="headerlink" title="创建SpringBoot项目"></a>创建SpringBoot项目</h2><p>使用Spring Initializr创建一个Spring Boot项目，选择以下依赖：</p>
<ul>
<li>Spring Web</li>
<li>Spring Security</li>
<li>Spring Boot DevTools</li>
<li>JWT (可以通过Maven或Gradle添加依赖)</li>
</ul>
<h2 id="添加JWT依赖"><a href="#添加JWT依赖" class="headerlink" title="添加JWT依赖"></a>添加JWT依赖</h2><p>在<code>pom.xml</code>中添加JWT依赖：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建用户注册类"><a href="#创建用户注册类" class="headerlink" title="创建用户注册类"></a>创建用户注册类</h2><p>前期准备，创建一个用户注册类来进行用户注册，后续采用jwt登录涉及加密处理，前期注册的时候采用加密存进数据库。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//控制器类</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/auth"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">registerUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        userService<span class="token punctuation">.</span><span class="token function">registerUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"User registered successfully"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//接口类</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">registerUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//实现类</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserMapper</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> encodedPassword <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将用户名和加密后的密码存储到数据库中</span>
        <span class="token class-name">User</span> passwdUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        passwdUser<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        passwdUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>encodedPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>passwdUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//实体类</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>  <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建Security配置类"><a href="#创建Security配置类" class="headerlink" title="创建Security配置类"></a>创建Security配置类</h2><p>创建一个配置类来配置Spring Security：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtUserDetailsService</span> jwtUserDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtUtils</span> jwtUtils<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//禁用CSRF保护（对于无状态的REST API来说，CSRF保护通常是多余的）。</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span> <span class="token comment">//配置会话管理策略为无状态（STATELESS）</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/auth/login"</span><span class="token punctuation">,</span> <span class="token string">"/auth/register"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 允许匿名访问登录和注册路径</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            	<span class="token comment">//注册JWT过滤器，确保在每次请求时验证JWT令牌</span>
                <span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JwtRequestFilter</span><span class="token punctuation">(</span>jwtUtils<span class="token punctuation">,</span> userDetailsService<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        auth<span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>jwtUserDetailsService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	
    <span class="token comment">// 配置用户认证服务和密码编码器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建JWT工具类"><a href="#创建JWT工具类" class="headerlink" title="创建JWT工具类"></a>创建JWT工具类</h2><p>创建一个JWT工具类，用于生成和验证JWT令牌：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtils</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jwt.secret&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> secret<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jwt.expiration&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> expiration<span class="token punctuation">;</span>


    <span class="token comment">// 生成JWT令牌</span>
    <span class="token annotation punctuation">@CacheResult</span><span class="token punctuation">(</span>cacheKey <span class="token operator">=</span> <span class="token string">"#this.getCacheKey(#username)"</span><span class="token punctuation">,</span>expireTime <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">HS256</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"token:"</span><span class="token operator">+</span>username<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 提取声明（claims）</span>
    <span class="token keyword">public</span> <span class="token class-name">Claims</span> <span class="token function">extractClaims</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Extracting claims from Token: &#123;&#125;"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出接收到的令牌</span>
            <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SignatureException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Invalid JWT signature: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error extracting claims: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 验证JWT令牌</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">validateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token function">extractClaims</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>claims <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">String</span> tokenUsername <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isTokenExpired <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isValid <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tokenUsername<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isTokenExpired<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Token validation failed. Username: &#123;&#125;, Token Username: &#123;&#125;, Is Token Expired: &#123;&#125;"</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> tokenUsername<span class="token punctuation">,</span> isTokenExpired<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> isValid<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建用户认证服务"><a href="#创建用户认证服务" class="headerlink" title="创建用户认证服务"></a>创建用户认证服务</h2><p>创建一个用户认证服务，用于加载用户信息：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token comment">// 根据用户名加载用户</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> lambdaQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> queryWrapper <span class="token operator">=</span> lambdaQueryWrapper
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">"User not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// user是你自定义的UserDetails实现类</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建认证控制器"><a href="#创建认证控制器" class="headerlink" title="创建认证控制器"></a>创建认证控制器</h2><p>创建一个控制器来处理用户登录和生成JWT令牌：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/auth"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtUtils</span> jwtUtils<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtUserDetailsService</span> jwtUserDetailsService<span class="token punctuation">;</span>

    <span class="token comment">// 处理用户登录请求</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">createToken</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> authRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 进行用户认证</span>
            <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>
                    <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"Invalid username or password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 生成JWT令牌</span>
        <span class="token keyword">final</span> <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> jwtUserDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jwtUtils<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建JWT过滤器"><a href="#创建JWT过滤器" class="headerlink" title="创建JWT过滤器"></a>创建JWT过滤器</h2><p>创建一个JWT过滤器，用于在每次请求时验证JWT令牌：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtRequestFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtUtils</span> jwtUtil<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">JwtRequestFilter</span><span class="token punctuation">(</span><span class="token class-name">JwtUtils</span> jwtUtil<span class="token punctuation">,</span><span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsService <span class="token operator">=</span> userDetailsService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jwtUtil <span class="token operator">=</span> jwtUtil<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">final</span> <span class="token class-name">String</span> authorizationHeader <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jwt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// 从请求头中获取JWT令牌</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>authorizationHeader <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> authorizationHeader<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Bearer "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            jwt <span class="token operator">=</span> authorizationHeader<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            username <span class="token operator">=</span> jwtUtil<span class="token punctuation">.</span><span class="token function">extractClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 验证令牌并设置认证信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>jwtUtil<span class="token punctuation">.</span><span class="token function">validateToken</span><span class="token punctuation">(</span>jwt<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">UsernamePasswordAuthenticationToken</span> usernamePasswordAuthenticationToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>
                        userDetails<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                usernamePasswordAuthenticationToken
                        <span class="token punctuation">.</span><span class="token function">setDetails</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebAuthenticationDetailsSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildDetails</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>usernamePasswordAuthenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h1><h2 id="注册阶段"><a href="#注册阶段" class="headerlink" title="注册阶段"></a>注册阶段</h2><ol>
<li><strong>用户发送注册请求</strong>：通过客户端（如浏览器或Postman）发送一个json格式的user对象的POST请求到<code>/regester</code>接口。</li>
<li><strong>调用UserService的注册方法</strong>：将需要注册的user对象传入registerUser方法中，将密码使用PasswordEncoder加密后和用户名存到数据库。</li>
</ol>
<h2 id="认证阶段"><a href="#认证阶段" class="headerlink" title="认证阶段"></a>认证阶段</h2><ol>
<li><strong>用户登录请求</strong>：通过客户端（如浏览器或Postman）发送一个json格式的user对象的POST请求到<code>/login</code>接口</li>
<li><strong>创建认证请求对象</strong>：使用 <code>UsernamePasswordAuthenticationToken</code> 创建一个包含用户名和密码的认证请求对象。</li>
<li><strong>调用 <code>AuthenticationManager</code> 的 <code>authenticate</code> 方法</strong>：<code>AuthenticationManager</code> 调用内部配置的 <code>AuthenticationProvider</code> 进行认证。</li>
<li><strong><code>DaoAuthenticationProvider</code> 进行用户认证</strong>：</li>
</ol>
<ul>
<li>使用 <code>UserDetailsService</code> 加载用户信息。</li>
<li>使用 <code>PasswordEncoder</code> 验证密码。</li>
</ul>
<ol start="5">
<li><strong>返回认证结果</strong>：</li>
</ol>
<ul>
<li>如果认证成功，返回一个填充了用户详细信息和权限的 <code>Authentication</code> 对象。</li>
<li>如果认证失败，抛出 <code>AuthenticationException</code>。</li>
</ul>
<h2 id="生成JWT令牌阶段"><a href="#生成JWT令牌阶段" class="headerlink" title="生成JWT令牌阶段"></a>生成JWT令牌阶段</h2><ol>
<li><strong>调用 <code>loadUserByUsername</code> 方法</strong>：</li>
</ol>
<ul>
<li><code>jwtUserDetailsService</code> 是一个实现了 <code>UserDetailsService</code> 接口的服务类。</li>
<li><code>loadUserByUsername</code> 方法用于根据用户名加载用户详细信息。</li>
</ul>
<ol start="2">
<li><p><strong>查询用户信息</strong>：在 <code>loadUserByUsername</code> 方法中，通常会查询数据库或其他存储系统，以获取用户信息。</p>
</li>
<li><p><strong>返回 <code>UserDetails</code> 对象</strong>：查询到用户信息后，创建并返回一个实现了 <code>UserDetails</code> 接口的对象，通常是一个自定义的用户详细信息类（例如 <code>JwtUserDetails</code>）</p>
</li>
<li><p><strong>调用 <code>generateToken</code> 方法</strong>：</p>
</li>
</ol>
<ul>
<li><code>jwtUtils</code> 是一个用于生成和验证 JWT 令牌的工具类。</li>
<li><code>generateToken</code> 方法用于生成一个包含用户名和其他信息的 JWT 令牌。</li>
</ul>
<ol start="5">
<li><strong>创建 JWT 令牌</strong>：</li>
</ol>
<ul>
<li>在 <code>generateToken</code> 方法中，使用 JWT 库（例如 <code>jjwt</code>）创建一个 JWT 令牌。</li>
<li>令牌中通常包含用户名、签发时间、过期时间等信息，并使用指定的密钥进行签名。</li>
</ul>
<ol start="6">
<li><strong>返回 JWT 令牌</strong>：生成的 JWT 令牌以字符串形式返回。</li>
</ol>
<h2 id="受保护的控制器类"><a href="#受保护的控制器类" class="headerlink" title="受保护的控制器类"></a>受保护的控制器类</h2><p>以testController为例，来看受保护的请求，如何进行JWT验证的执行流程</p>
<ol>
<li><strong>请求到达</strong> <code>DispatcherServlet</code>：所有请求首先到达 Spring 的 <code>DispatcherServlet</code>。</li>
<li><strong>进入过滤器链</strong>：请求通过 Spring Security 配置的过滤器链。</li>
<li><strong>通过每个过滤器</strong>：</li>
</ol>
<ul>
<li><code>SecurityContextPersistenceFilter</code>：从存储中加载 <code>SecurityContext</code> 并将其存储在 <code>SecurityContextHolder</code> 中，以便在请求处理过程中使用。</li>
<li><code>JwtRequestFilter</code>（自定义过滤器）：从请求头中提取 JWT 令牌，并验证其有效性。如果令牌有效，将认证信息存储到 <code>SecurityContextHolder</code> 中。</li>
<li><code>ExceptionTranslationFilter</code>：处理认证和授权过程中抛出的异常，将其转换为适当的 HTTP 响应。</li>
<li><code>FilterSecurityInterceptor</code>：进行访问控制决策，检查当前用户是否有权限访问请求的资源。</li>
</ul>
<ol start="4">
<li><strong>处理器映射</strong>：<code>DispatcherServlet</code> 使用 <code>HandlerMapping</code> 查找与请求路径对应的处理器方法。</li>
<li><strong>调用处理器方法</strong>：<code>DispatcherServlet</code> 调用找到的处理器方法。</li>
<li><strong>返回响应</strong>：处理器方法执行并返回响应，<code>DispatcherServlet</code> 将响应返回给客户端。</li>
</ol>
<h1 id="涉及类介绍"><a href="#涉及类介绍" class="headerlink" title="涉及类介绍"></a>涉及类介绍</h1><h2 id="UsernamePasswordAuthenticationToken"><a href="#UsernamePasswordAuthenticationToken" class="headerlink" title="UsernamePasswordAuthenticationToken"></a><code>UsernamePasswordAuthenticationToken</code></h2><p><strong>作用：</strong></p>
<ol>
<li><strong>存储用户认证信息</strong>：<ul>
<li><code>UsernamePasswordAuthenticationToken</code> 对象包含了用户的认证信息，例如用户名（principal）和密码（credentials）。</li>
</ul>
</li>
<li><strong>传递认证请求</strong>：<ul>
<li>在用户登录时，<code>UsernamePasswordAuthenticationToken</code> 对象通常用于创建认证请求对象，并传递给 <code>AuthenticationManager</code> 进行认证。</li>
</ul>
</li>
<li><strong>表示认证状态</strong>：<ul>
<li><code>UsernamePasswordAuthenticationToken</code> 对象还可以表示认证状态，通过 <code>setAuthenticated</code> 方法设置为已认证或未认证。</li>
</ul>
</li>
</ol>
<p><strong>构造函数：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Object</span> credentials<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用父类的构造函数，传入 null 表示没有权限信息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>principal <span class="token operator">=</span> principal<span class="token punctuation">;</span> <span class="token comment">// 设置用户主体,就是用户名</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>credentials <span class="token operator">=</span> credentials<span class="token punctuation">;</span> <span class="token comment">// 设置用户凭据，就是密码</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置认证状态为未认证</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SecurityContextPersistenceFilter"><a href="#SecurityContextPersistenceFilter" class="headerlink" title="SecurityContextPersistenceFilter"></a><code>SecurityContextPersistenceFilter</code></h2><p><strong>作用</strong>：</p>
<ul>
<li>从存储中加载 <code>SecurityContext</code> 并将其存储在 <code>SecurityContextHolder</code> 中，以便在请求处理过程中使用。</li>
<li>在请求结束时，将 <code>SecurityContext</code> 的状态保存到存储中。</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
    <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>
    <span class="token class-name">SecurityContext</span> contextBeforeChainExecution <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">loadContext</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>contextBeforeChainExecution<span class="token punctuation">)</span><span class="token punctuation">;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SecurityContext</span> contextAfterChainExecution <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">clearContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repo<span class="token punctuation">.</span><span class="token function">saveContext</span><span class="token punctuation">(</span>contextAfterChainExecution<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ExceptionTranslationFilter"><a href="#ExceptionTranslationFilter" class="headerlink" title="ExceptionTranslationFilter"></a><code>ExceptionTranslationFilter</code></h2><p><strong>作用</strong>：</p>
<ul>
<li>处理认证和授权过程中抛出的异常，将其转换为适当的 HTTP 响应。</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
    <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">sendStartAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AccessDeniedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">handleAccessDeniedException</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="FilterSecurityInterceptor"><a href="#FilterSecurityInterceptor" class="headerlink" title="FilterSecurityInterceptor"></a><code>FilterSecurityInterceptor</code></h2><p><strong>作用</strong>：</p>
<ul>
<li>进行访问控制决策，检查当前用户是否有权限访问请求的资源。</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">FilterInvocation</span> fi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterInvocation</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InterceptorStatusToken</span> token <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">beforeInvocation</span><span class="token punctuation">(</span>fi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        fi<span class="token punctuation">.</span><span class="token function">getChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>fi<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fi<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finallyInvocation</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">afterInvocation</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/DDIA%E7%AC%94%E8%AE%B0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/DDIA%E7%AC%94%E8%AE%B0.html" itemprop="url">设计数据密集型应用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据系统的基石"><a href="#数据系统的基石" class="headerlink" title="数据系统的基石"></a>数据系统的基石</h1><h2 id="什么是数据密集型和计算密集型"><a href="#什么是数据密集型和计算密集型" class="headerlink" title="什么是数据密集型和计算密集型"></a>什么是数据密集型和计算密集型</h2><h3 id="数据密集型-Data-intensive"><a href="#数据密集型-Data-intensive" class="headerlink" title="数据密集型(Data-intensive)"></a>数据密集型(Data-intensive)</h3><p>数据密集型系统或应用通常涉及大量的数据输入、输出、处理和存储。典型的特点包括：</p>
<ul>
<li>需要处理的数据量非常大。</li>
<li>强调数据的获取、存储、管理和分析。</li>
<li>常常需要使用数据库、数据仓库、大数据技术如Hadoop或Spark。</li>
<li>任务可能涉及网络传输、磁盘I&#x2F;O和数据缓存等。</li>
<li>性能瓶颈可能出现在I&#x2F;O和网络带宽，而不是计算能力。</li>
</ul>
<p>数据密集型系统的例子包括社交网络服务、在线购物平台、大规模在线事务处理（OLTP）系统、搜索引擎和推荐系统等。</p>
<h3 id="计算密集型-Compute-intensive"><a href="#计算密集型-Compute-intensive" class="headerlink" title="计算密集型(Compute-intensive)"></a>计算密集型(Compute-intensive)</h3><p>计算密集型任务或系统则是指需要消耗大量CPU资源进行计算的应用。它们的特点包括：</p>
<ul>
<li>需要大量的计算操作。</li>
<li>花费的时间主要在进行数学计算，处理逻辑或进行数据转换等CPU密集型任务上。</li>
<li>性能瓶颈往往在CPU计算能力上。</li>
<li>任务通常需要高效的算法和优化以利用计算资源。</li>
</ul>
<p>计算密集型任务的例子包括科学计算、图像和视频编码、3D渲染、密码学分析、大规模模拟和数据挖掘等。</p>
<blockquote>
<p>数据密集型和计算密集型的最主要的区别在于它们对资源的需求差异，<strong>数据密集型的瓶颈是I&#x2F;O和网络带宽，而计算密集型的瓶颈是CPU的计算能力。</strong></p>
</blockquote>
<h2 id="可靠性，可扩展性，可维护性"><a href="#可靠性，可扩展性，可维护性" class="headerlink" title="可靠性，可扩展性，可维护性"></a>可靠性，可扩展性，可维护性</h2><h3 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h3><blockquote>
<p>系统在<strong>困境（adversity）</strong>（硬件故障、软件故障、人为错误）中仍可正常工作（正确完成功能，并能达到期望的性能水准）</p>
</blockquote>
<h3 id="可扩展性"><a href="#可扩展性" class="headerlink" title="可扩展性"></a>可扩展性</h3><blockquote>
<p>有合理的办法应对系统的增长（数据量、流量、复杂性）</p>
</blockquote>
<h3 id="可维护性"><a href="#可维护性" class="headerlink" title="可维护性"></a>可维护性</h3><blockquote>
<p>系统在不同的生命周期，都能高效地在系统上工作（使系统保持现有行为，并适应新的应用场景）</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/DataStructure.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/DataStructure.html" itemprop="url">数据结构和算法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          学习数据结构和算法的一些基本知识
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/post/DataStructure.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/Build%20tools.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/Build%20tools.html" itemprop="url">Build Tools</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><h1 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/Api.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/Api.html" itemprop="url">Api</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h1><h2 id="什么是-RESTful-API？"><a href="#什么是-RESTful-API？" class="headerlink" title="什么是 RESTful API？"></a>什么是 RESTful API？</h2><blockquote>
<p>Restful是指不通计算机系统之间按照Rest风格进行应用程序的通信</p>
</blockquote>
<h2 id="什么是-API？"><a href="#什么是-API？" class="headerlink" title="什么是 API？"></a>什么是 API？</h2><blockquote>
<p>开发人员公开或创建 API，以便他们的应用程序可以以编程方式与其他应用程序进行通信</p>
<p><strong>客户端：</strong> 客户端是要访问 Web 上信息的用户。客户端可以是使用 API 的个人或软件系统。例如，开发人员可以编写从天气系统访问天气数据的程序。或者，您可以在浏览器上直接访问天气网站访问相同的数据。</p>
<p><strong>资源：</strong>资源是不同的应用程序向其客户端提供的信息。资源可以是图像、视频、文本、数字或任何类型的数据。向客户端提供资源的设备也称为服务器。企业使用 API 分享资源，既能提供 Web 服务，还能确保安全、可控，身份验证。</p>
</blockquote>
<h2 id="什么是-REST？"><a href="#什么是-REST？" class="headerlink" title="什么是 REST？"></a>什么是 REST？</h2><p>表征状态传输 (REST) 是一种软件架构，决定了 API 的工作条件。REST 最初作为管理复杂网络（例如互联网）上的通信的指南而建立。您可以使用基于 REST 的架构为高性能和可靠的大规模通信提供支持。您可以轻松应用和修改此种架构，为任何 API 系统带来可见性和跨平台可能性。</p>
<p>API 开发人员可以使用多种不同的架构设计 API。遵循 REST 架构风格的 API 称为 REST API。实施 REST 架构的 Web 服务称为 RESTful Web 服务。术语 RESTful API 通常指 RESTful Web API。但是，术语 REST API 和 RESTful API 可以互换使用。</p>
<p>以下是 REST 架构风格的一些原则：</p>
<h3 id="统一接口"><a href="#统一接口" class="headerlink" title="统一接口"></a>统一接口</h3><p>统一接口是一切 RESTful Web 服务设计的基础。其表示服务器以标准格式传输信息。格式化的资源在 REST 中称为表征。此格式可以与服务器应用程序上资源的内部表征不同。例如，服务器可以将数据存储为文本，但以 HTML 表征格式发送该数据。</p>
<p>统一接口强制实施四个架构约束：</p>
<ol>
<li>请求应确定资源。它们通过使用统一的资源标识符实现此功能。</li>
<li>客户端包含资源表征中的足够信息以修改或删除资源（如需要）。服务器通过发送进一步描述资源的元数据以符合这一条件。</li>
<li>客户端接收有关如何进一步处理表征的信息。服务器通过发送自描述信息实现此功能，该信息包含了有关客户端如何以最佳方式使用这些信息的元数据。</li>
<li>客户端接收有关其完成任务需要的所有其他相关资源的信息。服务器通过在表征中发送超链接实现此功能，以便客户端可以动态发现更多资源。</li>
</ol>
<h3 id="无状态"><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3><p>在 REST 架构中，无状态指一种服务器独立于所有之前的请求完成每个客户端请求的通信方法。客户端可以以任意顺序请求资源，每个请求为无状态或与独立于其他请求。此 REST API 设计约束意味着服务器每次可以完全识别和满足请求。 </p>
<h3 id="层次化系统"><a href="#层次化系统" class="headerlink" title="层次化系统"></a>层次化系统</h3><p>在层次化系统架构中，客户端可以连接到客户端和服务器之间的其他授权中间方，其仍将接收来自服务器的响应。服务器也可以将请求传递到其他服务器。您可以将 RESTful Web 服务设计为在包含多个层级（例如安全、应用程序和业务逻辑）的数个服务器上运行，从而共同满足客户端请求。这些层级对客户端仍不可见。</p>
<h3 id="高速缓存能力"><a href="#高速缓存能力" class="headerlink" title="高速缓存能力"></a>高速缓存能力</h3><p>RESTful Web 服务支持缓存，缓存是指将一些响应存储在客户端或中间方上以提高服务器响应时间的流程。例如，假设您访问某个网站，该网站的每个页面都包含通用的页眉和页脚图像。每次您访问新的网站页面时，服务器必须重新发送相同的图像。为了避免出现这种情况，客户端在首次响应后会缓存或存储这些图像，之后直接使用缓存中的图像。RESTful Web 服务通过使用自行定义为可缓存或不可缓存的 API 响应来控制缓存。</p>
<h3 id="按需编码"><a href="#按需编码" class="headerlink" title="按需编码"></a>按需编码</h3><p>在 REST 架构风格中，服务器可以通过将软件编程代码传输到客户端暂时扩展或自定义客户端功能。例如，当您在任何网站上填写注册表单时，浏览器会立即高亮您填写内容的任何错误，例如不正确的电话号码。正是由于服务器发送的代码，浏览器才可以实现这个功能。</p>
<h2 id="RESTful-API-有哪些优势？"><a href="#RESTful-API-有哪些优势？" class="headerlink" title="RESTful API 有哪些优势？"></a>RESTful API 有哪些优势？</h2><p>RESTful API 有以下优势：</p>
<h3 id="可扩展性"><a href="#可扩展性" class="headerlink" title="可扩展性"></a>可扩展性</h3><p>采用了 REST API 的系统可以高效扩展，因为 REST 优化了客户端-服务器交互。无状态可减轻服务器负载，因为服务器不必保留过去的客户端请求信息。管理良好的缓存可部分或完全消除某些客户端-服务器交互。所有这些功能都支持可扩展性，并且不会导致通信瓶颈进而降低性能。</p>
<h3 id="灵活性"><a href="#灵活性" class="headerlink" title="灵活性"></a>灵活性</h3><p>RESTful Web 服务支持客户端-服务器完全分离。该服务简化并分离了多种服务器组件，以便可以独立改进每个部分。平台或技术在服务器应用程序端更改，不会影响客户端应用程序。分层应用程序功能可进一步提升灵活性。例如，开发人员可以更改数据库层，而无需重新编写应用程序逻辑。</p>
<h3 id="独立性"><a href="#独立性" class="headerlink" title="独立性"></a>独立性</h3><p>REST API 与所使用的技术相互独立。您可以在不影响 API 设计的情况下以多种编程语言编写客户端和服务器应用程序。您也可以在不影响通信的情况下更改任何一端的基础技术。</p>
<h2 id="RESTful-API-如何工作？"><a href="#RESTful-API-如何工作？" class="headerlink" title="RESTful API 如何工作？"></a>RESTful API 如何工作？</h2><p>RESTful API 的基本功能与浏览互联网一样。客户端在请求资源时使用 API 与服务器建立联系。API 开发人员在服务器应用程序 API 文档中说明了客户端应如何使用 REST API。以下是调用任何 REST API 的通用步骤：</p>
<ol>
<li>客户端向服务器发送请求。客户端遵循 API 文档以服务器可识别的方式设置请求格式。</li>
<li>服务器对客户端进行身份验证，并确认客户端有权发送该请求。</li>
<li>服务器接收请求并对其进行内部处理。</li>
<li>服务器向客户端返回响应。响应包含通知客户端请求是否成功的信息。响应也包括客户端请求的任何信息。</li>
</ol>
<p>REST API 请求和响应详细信息略有不同，具体取决于 API 开发人员如何设计 API。</p>
<h2 id="RESTful-API-客户端请求包含哪些内容？"><a href="#RESTful-API-客户端请求包含哪些内容？" class="headerlink" title="RESTful API 客户端请求包含哪些内容？"></a>RESTful API 客户端请求包含哪些内容？</h2><p>RESTful API 要求请求包含以下主要组件：</p>
<h3 id="唯一的资源标识符"><a href="#唯一的资源标识符" class="headerlink" title="唯一的资源标识符"></a>唯一的资源标识符</h3><p>服务器通过唯一的资源标识符识别每个资源。对于 REST 服务，服务器通常使用统一资源定位符 (URL) 执行资源识别。URL 指定资源的路径。URL 类似于您访问任何网页时在浏览器中输入的网站地址。URL 也称为请求端点，并向服务器清晰指明客户端请求的内容。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>开发人员通常使用超文本传输协议 (HTTP) 实施 RESTful API。HTTP 方法通知服务器需要对资源执行什么操作。以下为四种常见的 HTTP 方法：</p>
<p><em><strong>GET</strong></em></p>
<p>客户端使用 GET 访问位于服务器上指定 URL 上的资源。它们可以缓存 GET 请求，并在 RESTful API 请求中发送参数以指示服务器在发送之前筛选数据。</p>
<p><em><strong>POST</strong></em></p>
<p>客户端使用 POST 向服务器发送数据。它们将数据表征包含到了请求中。多次发送相同的 POST 请求会造成多次创建相同资源的不良影响。</p>
<p><em><strong>PUT</strong></em></p>
<p>客户端使用 PUT 更新服务器上的现有资源。与 POST 不同，在 RESTful Web 服务中多次发送相同的 PUT 请求具有相同的效果。</p>
<p><em><strong>DELETE</strong></em></p>
<p>客户端使用 DELETE 请求删除资源。DELETE 请求可以更改服务器状态。但是，如果用户没有合适的身份验证，则请求失败。</p>
<h3 id="HTTP-头"><a href="#HTTP-头" class="headerlink" title="HTTP 头"></a>HTTP 头</h3><p>请求头是客户端和服务器之间交换的元数据。例如，请求头表示请求和响应的格式，提供有关请求状态的信息等等。</p>
<p><em><strong>数据</strong></em></p>
<p>REST API 请求可能包含 POST、PUT 和其他 HTTP 方法成功运行所需的数据。</p>
<p><em><strong>参数</strong></em></p>
<p>RESTful API 请求可以包含参数，这些参数向服务器提供更多有关需采取行动的详细信息。以下为一些不同类型的参数：</p>
<ul>
<li>指定 URL 详细信息的路径参数。</li>
<li>请求有关资源的更多信息的查询参数。</li>
<li>对客户端进行快速身份验证的 Cookie 参数。</li>
</ul>
<h2 id="什么是-RESTful-API-身份验证方法？"><a href="#什么是-RESTful-API-身份验证方法？" class="headerlink" title="什么是 RESTful API 身份验证方法？"></a>什么是 RESTful API 身份验证方法？</h2><p>RESTful Web 服务必须首先对请求进行身份验证，然后才能发送响应。身份验证是指验证身份的流程。例如，您可以出示身份证或驾驶证证明您的身份。同理，RESTful 服务客户端必须向服务器证明其身份才能确立信任。</p>
<p>RESTful API 包含四种常见身份验证方法：</p>
<h3 id="HTTP-身份验证"><a href="#HTTP-身份验证" class="headerlink" title="HTTP 身份验证"></a>HTTP 身份验证</h3><p>HTTP 定义您实施 REST API 时可直接使用的一些身份验证方案。以下为这些方案的其中两种：</p>
<p><em><strong>基本身份验证</strong></em></p>
<p>在基本身份验证中，客户端在请求头中发送用户名和密码。其使用 base64 编码，该编码技术将对组转化为一套 64 个字符进行安全传输。</p>
<p><em><strong>不记名身份验证</strong></em></p>
<p>术语不记名身份验证指向不记名令牌授予访问控制的流程。不记名令牌通常是服务器在响应登录请求时生成的加密字符串。客户端在请求头中发送令牌以访问资源。</p>
<h3 id="API-密钥"><a href="#API-密钥" class="headerlink" title="API 密钥"></a>API 密钥</h3><p>API 密钥是 REST API 身份验证的另一个选项。在此方案中，服务器向首次通信的客户端分配生成的唯一值。无论客户端何时尝试访问资源，其使用唯一的 API 密钥进行验证。API 密钥的安全性较低，因为客户端必须传输密钥，其易受网络盗窃的攻击。</p>
<h3 id="OAuth"><a href="#OAuth" class="headerlink" title="OAuth"></a>OAuth</h3><p>OAuth 结合密码和令牌实现对任何系统的高度安全登录访问。服务器首先请求密码，然后再额外请求令牌以完成授权流程。其可以随时查看令牌，也可以在特定范围和长度的一段时间内查看令牌。</p>
<h2 id="RESTful-API-服务器响应包含哪些内容？"><a href="#RESTful-API-服务器响应包含哪些内容？" class="headerlink" title="RESTful API 服务器响应包含哪些内容？"></a>RESTful API 服务器响应包含哪些内容？</h2><p>REST 原则要求服务器响应包含以下主要组件：</p>
<h3 id="状态行"><a href="#状态行" class="headerlink" title="状态行"></a>状态行</h3><p>状态行包含三位数字状态代码表示请求成功或请求出现故障。例如，2XX 代码表示成功，但 4XX 和 5XX 代码表示错误。3XX 代码表示 URL 重定向。</p>
<p>以下为一些常见的状态代码：</p>
<ul>
<li>200：通用成功响应</li>
<li>201：POST 方法成功响应</li>
<li>400：服务器无法处理的不正确请求</li>
<li>404：未找到资源</li>
</ul>
<h3 id="信息正文"><a href="#信息正文" class="headerlink" title="信息正文"></a>信息正文</h3><p>响应正文包含资源表征。服务器根据请求头包含的内容选择合适的表征格式。客户端可以以 XML 或 JSON 格式请求信息，这些格式定义如何以纯文本方式编写数据。例如，如果客户端请求名为 John 的人员的姓名和年龄，则服务器返回如下 JSON 表征：</p>
<p>‘{“name”:”John”, “age”:30}’</p>
<h3 id="头"><a href="#头" class="headerlink" title="头"></a>头</h3><p>响应也包含有关响应的头或元数据。它们提供有关响应的更多背景内容，包含服务器、编码、日期和内容类型等信息。</p>
<h1 id="JSON-APIs"><a href="#JSON-APIs" class="headerlink" title="JSON APIs"></a>JSON APIs</h1><h2 id="资源（Resources）"><a href="#资源（Resources）" class="headerlink" title="资源（Resources）"></a><strong>资源（Resources）</strong></h2><p>资源是 API 暴露的核心实体，通常代表系统中的业务对象（如文章、用户、评论等）。每个资源都有一个唯一的标识符（ID）和类型。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code<span class="token punctuation">&#123;</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"articles"</span><span class="token punctuation">,</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Introduction to JSON API"</span><span class="token punctuation">,</span>
      <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"..."</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="关系（Relationships）"><a href="#关系（Relationships）" class="headerlink" title="关系（Relationships）"></a><strong>关系（Relationships）</strong></h2><p>资源之间可以有关系。例如，一篇文章可以有多个评论，评论与文章之间形成了关系。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code<span class="token punctuation">&#123;</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"articles"</span><span class="token punctuation">,</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token property">"relationships"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"comments"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"comments"</span><span class="token punctuation">,</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"comments"</span><span class="token punctuation">,</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"2"</span> <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="端点（Endpoints）"><a href="#端点（Endpoints）" class="headerlink" title="端点（Endpoints）"></a><strong>端点（Endpoints）</strong></h2><p>JSON API 使用一致的端点命名方式。例如，获取所有文章的请求可能是 <code>GET /articles</code>。</p>
<h2 id="包含（Inclusion）"><a href="#包含（Inclusion）" class="headerlink" title="包含（Inclusion）"></a><strong>包含（Inclusion）</strong></h2><p>允许客户端在一次请求中包含与主资源相关联的其他资源。这可以减少多次请求的需求。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code<span class="token punctuation">&#123;</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"articles"</span><span class="token punctuation">,</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token property">"relationships"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"authors"</span><span class="token punctuation">,</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"42"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"included"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"authors"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"42"</span><span class="token punctuation">,</span>
      <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="分页（Pagination）"><a href="#分页（Pagination）" class="headerlink" title="分页（Pagination）"></a><strong>分页（Pagination）</strong></h2><p>JSON API 支持对结果集的分页，以避免一次性返回大量数据。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code<span class="token punctuation">&#123;</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ... (当前页的资源)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"meta"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"pagination"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"total-pages"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"current-page"</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="排序（Sorting）"><a href="#排序（Sorting）" class="headerlink" title="排序（Sorting）"></a><strong>排序（Sorting）</strong></h2><p>客户端可以指定返回结果的排序方式。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code
GET /articles?sort=title<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="过滤（Filtering）"><a href="#过滤（Filtering）" class="headerlink" title="过滤（Filtering）"></a><strong>过滤（Filtering）</strong></h2><p>客户端可以指定一些条件，以限制返回结果。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code
GET /articles?filter<span class="token punctuation">[</span>author<span class="token punctuation">]</span>=<span class="token number">42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="错误处理（Error-Handling）"><a href="#错误处理（Error-Handling）" class="headerlink" title="错误处理（Error Handling）"></a><strong>错误处理（Error Handling）</strong></h2><p>定义了一套标准的错误格式和处理机制，使得错误信息一致且易于理解。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">jsonCopy code<span class="token punctuation">&#123;</span>
  <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"404"</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token property">"detail"</span><span class="token operator">:</span> <span class="token string">"Resource not found."</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h1><ol>
<li><p><strong>协议：</strong> SOAP 是一种协议，规定了消息的格式和交互方式。它通常在 HTTP 或 SMTP 等传输协议上运行。</p>
</li>
<li><p><strong>消息格式：</strong> SOAP 消息是用 XML 构建的。一个典型的 SOAP 消息包括 <code>&lt;Envelope&gt;</code> 元素，其中包含 <code>&lt;Header&gt;</code> 和 <code>&lt;Body&gt;</code> 元素，分别用于包含头部信息和主体信息。</p>
<pre class="line-numbers language-none"><code class="language-none">xmlCopy code&lt;soap:Envelope xmlns:soap&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2003&#x2F;05&#x2F;soap-envelope&quot; xmlns:m&#x3D;&quot;http:&#x2F;&#x2F;www.example.org&quot;&gt;
  &lt;soap:Header&gt;
    &lt;!-- 头部信息 --&gt;
  &lt;&#x2F;soap:Header&gt;
  &lt;soap:Body&gt;
    &lt;!-- 主体信息 --&gt;
  &lt;&#x2F;soap:Body&gt;
&lt;&#x2F;soap:Envelope&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>基于 XML-RPC：</strong> SOAP 被认为是 XML-RPC 的进一步发展，提供了更多的功能和灵活性。</p>
</li>
<li><p><strong>协议中立：</strong> 由于它可以在多种传输协议上运行，SOAP 是协议中立的。它可以在 HTTP、SMTP、JMS（Java Message Service）等协议上使用。</p>
</li>
<li><p><strong>支持 Web Services：</strong> SOAP 在 Web Services 中得到广泛应用。Web Services 是一种通过网络进行通信的技术，它使用标准的 Web 协议（如 HTTP、SOAP）来实现跨平台的应用集成。</p>
</li>
<li><p><strong>安全性：</strong> SOAP 提供了一些机制来确保消息的安全性，例如可以使用 HTTPS 来加密传输的数据，还可以通过 WS-Security 等标准来实现消息级的安全。</p>
</li>
<li><p><strong>复杂性：</strong> 与 REST 相比，SOAP 的消息格式相对较为复杂，因为它使用 XML，而且在一些简单的使用场景下可能显得繁琐。</p>
</li>
</ol>
<h1 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h1><p>gRPC（gRPC Remote Procedure Call）是一个高性能、开源的 RPC（Remote Procedure Call）框架，由 Google 开发。它使用 HTTP&#x2F;2 协议进行通信，并支持多种编程语言。gRPC 的目标是使跨网络的服务调用更加简单和高效。</p>
<p>以下是 gRPC 的一些关键特点：</p>
<ol>
<li><strong>IDL（Interface Definition Language）：</strong> 使用 Protobuf（Protocol Buffers）作为接口定义语言。IDL 描述了服务的方法、参数和返回值的数据结构。</li>
<li><strong>多语言支持：</strong> gRPC 提供了多种语言的支持，包括但不限于 C++, Java, Python, Go, Ruby, C#, Node.js。</li>
<li><strong>HTTP&#x2F;2：</strong> 使用基于二进制的 HTTP&#x2F;2 协议进行通信，以提高性能和效率。HTTP&#x2F;2 支持多路复用、头部压缩、流控制等特性。</li>
<li><strong>双向流：</strong> gRPC 支持双向流通信，允许客户端和服务端可以同时发送多个消息。</li>
<li><strong>代码生成：</strong> 使用 Protobuf 作为IDL，并通过代码生成工具生成客户端和服务端的代码。这简化了开发人员的工作，同时提供了强类型的 API。</li>
<li><strong>支持拦截器：</strong> gRPC 支持在客户端和服务端使用拦截器，以便在请求和响应的处理链中执行逻辑。</li>
<li><strong>多种服务调用类型：</strong> 支持四种服务调用类型，即单一请求-单一响应、单一请求-流响应、流请求-单一响应、流请求-流响应。</li>
<li><strong>支持服务发现：</strong> gRPC 支持使用服务发现机制，使得服务能够注册和发现其他服务的位置。</li>
<li><strong>可插拔：</strong> gRPC 的核心库是高度可插拔的，允许开发者根据需要选择适合的组件。</li>
</ol>
<h1 id="GraphQL"><a href="#GraphQL" class="headerlink" title="GraphQL"></a>GraphQL</h1><p>GraphQL（Graph Query Language）是一种由 Facebook 开发的查询语言和服务端运行时环境，用于 API 的查询和数据操纵。GraphQL 提供了一种更高效、强大且灵活的替代方式，相比于传统的 REST API，它更加精确地满足客户端的数据需求。</p>
<p>以下是 GraphQL 的一些关键特点和概念：</p>
<ol>
<li><strong>强大的查询语言：</strong> GraphQL 允许客户端按照其需要的方式定义查询，而不是由服务端决定返回的数据结构。客户端能够精确地指定所需的字段和关联关系。</li>
<li><strong>单一入口点：</strong> 所有的 GraphQL 查询都通过单一的入口点（通常是 <code>/graphql</code> 端点）进行。这个入口点能够处理客户端发起的各种查询。</li>
<li><strong>精确定义的数据：</strong> GraphQL 的查询由客户端定义，服务端返回的数据与查询结构一一对应。这消除了过度获取或缺少数据的问题，称为”过度获取”（Over-fetching）和”欠获取”（Under-fetching）。</li>
<li><strong>实时数据：</strong> 支持实时数据传输，使得服务端能够主动向客户端推送更新。</li>
<li><strong>类型系统：</strong> GraphQL 使用类型系统来定义 API 中的对象和操作。服务端通过类型系统告诉客户端可以请求哪些数据，并在响应中提供相应的数据。</li>
<li><strong>关联关系：</strong> 客户端能够一次性请求多个相关联的数据，减少了多次请求的需要。</li>
<li><strong>自省：</strong> GraphQL 具有自省能力，客户端能够通过查询获取有关 API 结构的信息，包括可用的查询、变更和类型等。</li>
<li><strong>扩展性：</strong> 允许服务端添加新的功能和字段，而不会破坏现有的查询。客户端可以选择是否使用新添加的功能。</li>
</ol>
<h1 id="Hateoas"><a href="#Hateoas" class="headerlink" title="Hateoas"></a>Hateoas</h1><p>HATEOAS，全称是“Hypermedia as the Engine of Application State”，中文翻译为“超媒体作为应用状态的引擎”，是一种 REST 架构风格的设计原则。</p>
<p>HATEOAS 的核心思想是将应用程序的状态以及与应用程序交互的方式嵌入到 API 的响应中。在传统的 RESTful API 中，客户端需要提前了解 API 的结构，并且需要硬编码与 API 交互的方式。而 HATEOAS 的目标是通过在 API 的响应中提供相关的链接，使得客户端能够通过发现而非预先知道如何与 API 交互。</p>
<p>关键特点和概念包括：</p>
<ol>
<li><strong>超媒体链接：</strong> API 的响应中包含了与当前资源相关的链接，这些链接可以指向其他资源或描述可执行的操作。</li>
<li><strong>动态发现：</strong> 客户端不需要提前知道如何构造请求，而是通过解析 API 返回的超媒体链接来动态地发现可用的资源和操作。</li>
<li><strong>资源状态：</strong> 客户端可以通过 API 提供的链接获取当前资源的状态，并了解可执行的下一步操作。</li>
<li><strong>自描述性：</strong> API 提供了足够的信息，使得客户端能够理解如何使用 API，而无需依赖外部文档。</li>
</ol>
<p>HATEOAS 的设计理念强调了 API 的自描述性和灵活性，减少了客户端与服务端之间的紧耦合，提高了系统的可扩展性。实现 HATEOAS 的 API 可以更容易地适应变化，因为客户端只需要遵循 API 返回的链接，而不是依赖于硬编码的信息。</p>
<p>虽然 HATEOAS 是 RESTful 架构的一个重要原则，但在实际应用中，并不是所有的 RESTful API 都严格遵循 HATEOAS。其复杂性和在某些场景下的适用性取决于具体的应用需求。</p>
<h1 id="Open-api-spec"><a href="#Open-api-spec" class="headerlink" title="Open api spec"></a>Open api spec</h1><p>OpenAPI Specification（OpenAPI规范）是一种用于描述和定义 RESTful API 的开放标准。它以先前称为Swagger规范的形式开始，并在进入 Linux 基金会后更名为 OpenAPI。OpenAPI Specification 使用 JSON 或 YAML 格式，提供了一种清晰且易于理解的方式，用于描述 API 的结构、端点、参数、请求-响应规范以及其他相关信息。</p>
<p>关键特点和组成部分包括：</p>
<ol>
<li><strong>API 文档定义：</strong> OpenAPI Specification 用于编写 API 文档，其中包括 API 的路径、操作、参数、请求和响应示例等。</li>
<li><strong>端点和操作：</strong> 定义了 API 的不同端点（路径）以及每个端点上支持的操作（HTTP 方法）。</li>
<li><strong>请求和响应：</strong> 详细说明了每个操作的请求和响应的结构，包括参数、头部、响应码等。</li>
<li><strong>数据模型：</strong> 定义了在 API 中使用的数据模型，包括对象的属性、数据类型等。</li>
<li><strong>安全性定义：</strong> 描述了 API 的安全性要求，例如身份验证、授权等。</li>
<li><strong>标签和注释：</strong> 支持标签和注释，使得 API 文档更易读和更易于理解。</li>
</ol>
<p>使用 OpenAPI Specification 的好处包括：</p>
<ul>
<li><strong>文档自动生成：</strong> 可以利用 OpenAPI Specification 自动生成 API 文档，减少了手动文档编写的工作量。</li>
<li><strong>客户端代码生成：</strong> 支持通过规范生成客户端代码，使得客户端更容易与 API 进行交互。</li>
<li><strong>工具和生态系统：</strong> OpenAPI Specification 已经成为广泛采用的标准，有许多工具和库支持该规范，从而帮助开发者更轻松地构建和维护 API。</li>
</ul>
<h1 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h1><h2 id="JWT-Authentication"><a href="#JWT-Authentication" class="headerlink" title="JWT Authentication"></a>JWT Authentication</h2><p>JWT（JSON Web Token）是一种用于进行信息传递的开放标准（RFC 7519）。它通常用于在服务之间传递声明式信息，以便进行身份验证和授权。JWT 由三部分组成，这三部分通过点号（.）连接在一起：</p>
<ol>
<li><strong>Header（头部）：</strong> 包含了令牌的元数据，例如算法和令牌类型。</li>
<li><strong>Payload（载荷）：</strong> 包含了声明，即关于实体（通常是用户）和其他数据的信息。有三种类型的声明：注册声明、公共声明和私有声明。</li>
<li><strong>Signature（签名）：</strong> 用于验证令牌的真实性，防止被篡改。</li>
</ol>
<p>JWT 的基本工作流程如下：</p>
<ol>
<li><strong>认证：</strong> 用户提供用户名和密码进行身份验证。</li>
<li><strong>颁发 Token：</strong> 服务器使用私钥生成 JWT，并将其返回给客户端。</li>
<li><strong>存储 Token：</strong> 客户端通常将 JWT 存储在本地，例如在浏览器的 localStorage 中。</li>
<li><strong>请求时发送 Token：</strong> 客户端在每个请求的 Authorization 头中发送 JWT。</li>
<li><strong>验证和授权：</strong> 服务器验证 JWT 的签名，检查权限，并提供响应。</li>
</ol>
<p>JWT 的优势和用途包括：</p>
<ul>
<li><strong>跨域身份验证：</strong> 由于 JWT 可以在不同域之间传递，并且不需要在用户和服务器之间存储状态，因此非常适合用于跨域身份验证。</li>
<li><strong>简化身份验证流程：</strong> JWT 简化了身份验证流程，因为它不需要在服务器上保存会话状态。</li>
<li><strong>声明性信息：</strong> JWT 载荷可以包含任何类型的声明，使其成为携带用户角色、权限和其他信息的有效工具。</li>
</ul>
<p>需要注意的是，为了确保 JWT 的安全性，应该使用 HTTPS 协议来传输 JWT，并在服务器端使用适当的密钥进行签名和验证。此外，避免在 JWT 中存储敏感信息，因为 JWT 的内容可以被 Base64 解码。</p>
<h2 id="Token-based-Authentication"><a href="#Token-based-Authentication" class="headerlink" title="Token based Authentication"></a>Token based Authentication</h2><p>Token-based authentication是一种身份验证方式，它通过使用令牌来验证用户身份。通常情况下，用户在登录成功后，系统会为其颁发一个令牌，该令牌包含了一些信息，用于标识用户和授予访问权限。这个令牌随后在每个请求中被发送，用于验证用户的身份和权限。</p>
<p>基于令牌的身份验证的主要特点包括：</p>
<ol>
<li><strong>状态无关：</strong> 与传统的基于会话的身份验证方式不同，基于令牌的身份验证是状态无关的。服务器不需要在后端存储用户的会话信息。令牌本身包含了必要的用户信息，因此服务器可以独立验证用户的身份。</li>
<li><strong>分布式系统：</strong> 适用于分布式系统和跨域应用程序。令牌可以在不同的服务之间传递，使得身份验证在不同服务之间更加灵活。</li>
<li><strong>无状态：</strong> 服务器不需要在后端存储任何会话状态。每个请求都包含了足够的信息，以便服务器验证用户身份和权限。</li>
<li><strong>安全性：</strong> 通过使用安全的令牌生成和验证机制，可以增加系统的安全性。例如，使用JWT（JSON Web Token）或其他加密算法可以保护令牌的传输和存储。</li>
</ol>
<p>Token-based身份验证通常涉及以下步骤：</p>
<ul>
<li><strong>用户登录：</strong> 用户提供凭据（通常是用户名和密码）进行身份验证。</li>
<li><strong>颁发令牌：</strong> 服务器验证用户身份后，颁发一个令牌给用户。这个令牌可能包含用户的一些信息，如用户ID、角色和过期时间。</li>
<li><strong>令牌存储：</strong> 客户端通常会将令牌存储在安全的位置，如浏览器的本地存储或内存中。</li>
<li><strong>请求时发送令牌：</strong> 客户端在每个请求的头部或其他安全方式中发送令牌。</li>
<li><strong>验证和授权：</strong> 服务器接收到令牌后，验证其签名和有效性，并根据令牌中的信息授权用户的访问。</li>
</ul>
<p>基于令牌的身份验证是现代应用程序中常见的一种方式，特别是在移动应用和前后端分离的Web应用中。</p>
<h2 id="Session-based-Authentication"><a href="#Session-based-Authentication" class="headerlink" title="Session based Authentication"></a>Session based Authentication</h2><p>Session-based authentication是一种身份验证方式，它使用会话来跟踪和验证用户的身份。这种方式通常基于浏览器的会话机制，用户在登录成功后，服务器会为其创建一个会话，并分配一个唯一的会话标识（通常是一个会话ID）。该标识存储在用户的浏览器中，通常以cookie的形式保存。</p>
<p>主要特点和步骤包括：</p>
<ol>
<li><strong>会话创建：</strong> 用户在登录成功后，服务器创建一个会话，生成一个唯一的会话ID，并将其发送到用户的浏览器，存储在cookie中。</li>
<li><strong>会话存储：</strong> 用户的会话信息通常存储在服务器端，包括用户的身份信息、权限等。这可以存储在内存中、数据库中或其他持久化存储中。</li>
<li><strong>请求时发送会话ID：</strong> 用户的浏览器在每个后续请求中都会将会话ID作为cookie发送到服务器。服务器使用这个ID来识别用户，并检查其会话状态。</li>
<li><strong>验证和授权：</strong> 服务器接收到会话ID后，验证其有效性并检查用户的权限。如果会话有效且用户有相应权限，服务器会允许请求。</li>
<li><strong>会话超时：</strong> 为了安全性，会话通常会设置过期时间。如果用户在一段时间内没有活动，会话可能会超时，需要重新登录。</li>
<li><strong>注销：</strong> 用户可以选择主动注销，或者服务器可以在一定条件下自动注销用户的会话。</li>
</ol>
<p>Session-based authentication适用于传统的Web应用，通过服务器端存储会话信息，可以实现更多的控制和安全性。然而，它也带来了一些挑战，如需要在服务器端维护会话状态、难以扩展到分布式环境等。</p>
<h2 id="Basic-Authentication"><a href="#Basic-Authentication" class="headerlink" title="Basic Authentication"></a>Basic Authentication</h2><p>Basic Authentication（基本身份验证）是一种简单的身份验证机制，通常用于HTTP协议。它是一种基于用户名和密码的验证方式，其工作原理如下：</p>
<ol>
<li><p><strong>请求时携带认证信息：</strong> 客户端在请求时，将用户名和密码按照一定的格式（Base64编码）加密，并放在请求的<code>Authorization</code>头中发送给服务器。</p>
<p>例如，HTTP请求头中的基本认证信息可能如下所示：</p>
<pre class="line-numbers language-none"><code class="language-none">makefileCopy code
Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>其中，<code>dXNlcm5hbWU6cGFzc3dvcmQ=</code> 是将用户名和密码编码后的Base64字符串。</p>
</li>
<li><p><strong>服务器验证认证信息：</strong> 服务器接收到请求后，解码<code>Authorization</code>头中的认证信息，获取用户名和密码。</p>
</li>
<li><p><strong>验证用户名和密码：</strong> 服务器验证解码后的用户名和密码，如果匹配则允许访问，否则返回未授权（401 Unauthorized）的响应。</p>
</li>
</ol>
<p>Basic Authentication的优点是简单易实现，适用于简单的身份验证场景。然而，它的安全性较低，因为用户名和密码是以明文的形式在网络上传输的，容易受到窃听攻击。</p>
<p>由于安全性的限制，通常建议在使用Basic Authentication时，要结合使用HTTPS协议，以加密通信，提高安全性。另外，对于更高级的身份验证需求，例如使用令牌（Token）等方式可能更为安全和灵活。</p>
<h2 id="OAuth-Open-Authorization"><a href="#OAuth-Open-Authorization" class="headerlink" title="OAuth - Open Authorization"></a>OAuth - Open Authorization</h2><p>OAuth（Open Authorization）是一种开放的授权协议，用于授权第三方应用程序访问资源所有者（用户）在另一服务提供者上存储的资源，而无需将资源所有者的凭据（例如用户名和密码）传递给第三方应用程序。</p>
<p>OAuth的主要设计目标是在让用户安全地授权第三方应用程序访问其资源的同时，避免将用户的用户名和密码传递给第三方应用。OAuth协议涉及四个主要角色：</p>
<ol>
<li><strong>资源所有者（Resource Owner）：</strong> 即用户，是拥有资源（如照片、文件）的实体，能够对资源进行授权的实体。</li>
<li><strong>客户端（Client）：</strong> 第三方应用程序，请求访问资源的应用。</li>
<li><strong>授权服务器（Authorization Server）：</strong> 负责验证资源所有者身份并颁发访问令牌（Access Token）的服务器。</li>
<li><strong>资源服务器（Resource Server）：</strong> 存储资源的服务器，受到访问令牌的保护，负责对请求进行认证和授权，并返回受保护的资源。</li>
</ol>
<p>OAuth协议中定义了不同的授权流程，其中最常见的是授权码授权流程（Authorization Code Grant），包括以下步骤：</p>
<ol>
<li><strong>客户端请求授权：</strong> 客户端向授权服务器请求授权，并提供回调地址。</li>
<li><strong>用户授权：</strong> 资源所有者登录授权服务器，同意授权请求，授权服务器返回授权码。</li>
<li><strong>授权码换取令牌：</strong> 客户端使用授权码向授权服务器请求访问令牌。</li>
<li><strong>使用令牌访问资源：</strong> 客户端使用访问令牌向资源服务器请求访问受保护的资源。</li>
</ol>
<p>OAuth协议的优势在于用户只需提供一次用户名和密码给授权服务器，而不直接提供给第三方应用。此外，通过使用访问令牌，可以限制第三方应用对用户资源的访问权限，提高了安全性。OAuth已成为许多互联网服务和应用程序中常见的身份验证和授权协</p>
<h2 id="SSO-Single-Sign-On"><a href="#SSO-Single-Sign-On" class="headerlink" title="SSO - Single Sign On"></a>SSO - Single Sign On</h2><p>单一登录（Single Sign-On，SSO）是一种身份验证过程，允许用户使用一组凭据（例如用户名和密码）登录到多个相关但独立的软件系统，而无需为每个系统单独进行身份验证。通过实现SSO，用户只需在登录时提供一次凭据，然后就可以在整个系统中无缝地访问其他受保护的资源，而无需反复进行身份验证。</p>
<p>SSO的关键目标是提供更便捷的用户体验，减少用户需要记忆和管理的凭据数量。主要的SSO机制通常包括以下几种：</p>
<ol>
<li><strong>身份提供者（Identity Provider，IdP）：</strong> 负责验证用户身份并颁发令牌的系统。常见的IdP包括登录服务、身份管理系统等。</li>
<li><strong>服务提供者（Service Provider，SP）：</strong> 提供受保护资源的系统。用户在IdP验证身份后，可以使用令牌访问相关SP的资源。</li>
<li><strong>令牌（Token）：</strong> 在用户成功通过身份验证后，IdP颁发一个令牌，用于在不同系统之间传递身份信息。</li>
</ol>
<p>SSO有助于提高安全性，因为用户不再需要在多个系统中重复使用相同的凭据。常见的SSO实现包括基于令牌的SSO（如OAuth、OpenID Connect）、基于SAML（Security Assertion Markup Language）的SSO等。</p>
<p>在企业环境中，SSO通常用于集成不同的企业应用程序、服务和系统，以提供更流畅的用户体验，减少密码疲劳问题。常见的SSO方案还包括通过企业的身份提供者（如Active Directory）实现的企业内部SSO。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/API%E7%BD%91%E5%85%B3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/API%E7%BD%91%E5%85%B3.html" itemprop="url">API网关</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是API网关"><a href="#什么是API网关" class="headerlink" title="什么是API网关"></a>什么是API网关</h1><blockquote>
<p>API 网关是一个管理、处理和路由API调用到后端服务的系统。作为微服务架构中的关键组件，API网关为客户端（如移动设备、Web应用程序、第三方服务等）提供了一个统一的入口点，并将请求路由到适当的微服务上。此外，它还可以提供额外的跨服务功能，包括请求聚合、协议转换、请求和响应转换等。</p>
</blockquote>
<h2 id="API的功能"><a href="#API的功能" class="headerlink" title="API的功能"></a>API的功能</h2><h3 id="请求路由"><a href="#请求路由" class="headerlink" title="请求路由"></a>请求路由</h3><p>API网关将接收到的请求转发到正确的服务。例如，它可以基于URL路径或请求参数将请求路由到特定的微服务。</p>
<h3 id="API聚合"><a href="#API聚合" class="headerlink" title="API聚合"></a>API聚合</h3><p>API网关可以将多个API请求聚合为一个请求，减少客户端需要做的调用次数，以便提升性能和用户体验。</p>
<h3 id="身份验证和授权"><a href="#身份验证和授权" class="headerlink" title="身份验证和授权"></a>身份验证和授权</h3><p>它可以在请求到达后端服务之前进行用户身份验证和授权检查，提供安全层，确保只有验证过的用户可以访问敏感信息。</p>
<h3 id="限流和服务降级"><a href="#限流和服务降级" class="headerlink" title="限流和服务降级"></a>限流和服务降级</h3><p>网关可以限制对后端服务的请求频率，帮助防范DDoS攻击，并在系统负载过高时实施服务降级策略。</p>
<h3 id="跨应用程序消息传递"><a href="#跨应用程序消息传递" class="headerlink" title="跨应用程序消息传递"></a>跨应用程序消息传递</h3><p>API网关支持不同类型的跨应用程序通讯协议，如HTTP, WebSocket等。</p>
<h3 id="监控和日志记录"><a href="#监控和日志记录" class="headerlink" title="监控和日志记录"></a>监控和日志记录</h3><p>为了诊断和调试问题，API网关可以对通过它的流量进行监控，并记录日志。</p>
<h3 id="响应转换"><a href="#响应转换" class="headerlink" title="响应转换"></a>响应转换</h3><p>它可以修改微服务的响应，以符合客户端的需要，例如把JSON转换为XML。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>API网关可以在多个实例之间分配流量，和负载均衡器的工作相似，以提高性能和可靠性。</p>
<h2 id="API网关的原理"><a href="#API网关的原理" class="headerlink" title="API网关的原理"></a>API网关的原理</h2><ol>
<li><p>接收请求：API网关的第一步是接收从客户端发来的API请求。</p>
</li>
<li><p>预处理和验证：在路由请求之前，API网关需要进行一些预处理工作，比如用户认证（确定请求是否来自一个有效的用户）、鉴权（确定用户是否有权访问请求的资源）、请求校验（确定请求是否合法，是否包含全部必要的参数）等。另外，它也可能需要进行一些消息转换或协议转换的工作。</p>
</li>
<li><p>路由请求：API网关将经过校验之后的有效请求路由到正确的后端服务或微服务，比如根据URL或者请求的参数来决定将请求路由到哪一个服务。</p>
</li>
<li><p>请求聚合：对于需要多个微服务共同配合来完成的请求，API网关可以将这些请求聚合，而后一次性返回给客户端。这样可以减少客户端需要发出的请求数，从而提升性能和用户体验。</p>
</li>
<li><p>响应返回：当后端服务处理完请求后，会将响应返回给API网关，网关之后再将这些响应返回给客户端。在这个过程中，API网关可能还会进行一些后处理，比如进行数据格式转换，或者添加一些特殊的HTTP头等。</p>
</li>
<li><p>日志和监控：在整个过程中，API网关会持续记录日志，同时进行性能监控和错误跟踪。这些信息对于系统的维护和故障排查产生重大价值。</p>
</li>
</ol>
<h2 id="API网关的优点"><a href="#API网关的优点" class="headerlink" title="API网关的优点"></a>API网关的优点</h2><ol>
<li><strong>抽象化：</strong>API 网关为外部消费者访问一组微服务提供了一个统一的入口点，对底层实施细节进行抽象化，同时允许微服务独立演进。</li>
<li><strong>安全性：</strong>API 网关可以处理身份验证、授权和速率限制等安全任务，从而提高底层微服务的安全性。</li>
<li><strong>性能：</strong>API 网关可以缓存响应并执行请求&#x2F;响应转换，提高系统的整体性能。</li>
<li><strong>开发人员体验：</strong>API 网关提供分析、归档和测试工具，使开发人员可以更容易建立和维护基于微服务的应用程序。</li>
<li><strong>消费者体验：</strong>API 网关可以让消费者更容易发现和使用微服务提供的 API，改善整体易用性和用户体验。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/Canal.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/Canal.html" itemprop="url">Canal</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据库复制和同步的基本概念"><a href="#数据库复制和同步的基本概念" class="headerlink" title="数据库复制和同步的基本概念"></a>数据库复制和同步的基本概念</h1><blockquote>
<p>作用：实现了数据在多个数据库实例之间的保持一致和同步。应用程序能够获得高可用性、灾备性和读取负载均衡等好处。</p>
</blockquote>
<ol>
<li>主从复制（Master-Slave Replication）：主从复制是最常见的数据库复制方法之一。在主从复制中，有一个主数据库（Master）和一个或多个从数据库（Slaves）。主数据库是数据的源头，它负责接收来自应用程序的写操作，并将这些写操作记录为称为日志（Log）的格式。从数据库则通过读取这些日志，将主数据库的写操作进行重演，以保持数据的一致性。</li>
<li>数据一致性（Data Consistency）：数据一致性是指主数据库和从数据库之间的数据保持一致。当在主数据库上进行写操作时，主数据库会将这些操作的日志记录下来，并将其发送给从数据库。从数据库会按照相同的顺序重现这些操作，确保数据的一致性。一致性的实现可以通过各种机制，例如基于事务日志（Transaction Log）或二进制日志（Binary Log）。</li>
<li>数据传输（Data Transfer）：数据传输是指将主数据库的数据从一个位置传输到另一个位置。在数据库复制和同步过程中，数据传输通常通过网络进行。主数据库将写操作记录为日志，并通过网络传输给从数据库，从数据库接收日志并执行相应的操作。</li>
<li>增量复制（Incremental Replication）：增量复制是一种常见的复制方式，其中只有发生了更改的部分数据会被复制和同步。这种方式可以减少网络传输的数据量，并提高复制效率。增量复制通常使用日志来跟踪数据的更改，只传输和应用这些更改。</li>
<li>数据延迟（Data Latency）：在数据库复制和同步中，主数据库和从数据库之间可能存在一定的延迟。这是因为数据在传输和应用过程中需要一定的时间。数据延迟可能会导致从数据库上的数据不是实时的，在某些情况下可能会有一定的时间窗口内的数据不一致。</li>
</ol>
<h1 id="canal作用及原理"><a href="#canal作用及原理" class="headerlink" title="canal作用及原理"></a>canal作用及原理</h1><p><img src="https://camo.githubusercontent.com/63881e271f889d4a424c55cea2f9c2065f63494fecac58432eac415f6e47e959/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139313130343130313733353934372e706e67"></p>
<p>canal作用：根据Mysql数据库增量日志进行解析，提供增量数据的订阅和消费。</p>
<p>canal原理：canal模拟Mysql slave交互协议，伪装成slave发送dump报文，主数据库master收到dump请求后，推送binary log给canal。</p>
<h1 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h1><p>1.开启binlog,&#x2F;etc&#x2F;my.cnf 中配置如下</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">log_bin</span><span class="token punctuation">=</span><span class="token value attr-value">mysql-bin</span>
<span class="token key attr-name">binlog-format</span><span class="token punctuation">=</span><span class="token value attr-value">row</span>
<span class="token key attr-name">bind-address</span><span class="token punctuation">=</span><span class="token value attr-value">0.0.0.0</span>
<span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">3306</span>
<span class="token key attr-name">basedir</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/mysql</span>
<span class="token key attr-name">datadir</span><span class="token punctuation">=</span><span class="token value attr-value">/data/mysql</span>
<span class="token key attr-name">socket</span><span class="token punctuation">=</span><span class="token value attr-value">/tmp/mysql.sock</span>
<span class="token key attr-name">log-error</span><span class="token punctuation">=</span><span class="token value attr-value">/data/mysql/mysql.err</span>
<span class="token key attr-name">pid-file</span><span class="token punctuation">=</span><span class="token value attr-value">/data/mysql/mysql.pid</span>
<span class="token comment">#character config</span>
<span class="token key attr-name">character_set_server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4</span>
<span class="token key attr-name">symbolic-links</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">explicit_defaults_for_timestamp</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.授权 canal 链接 MySQL 账号具有作为 MySQL slave 的权限, 如果已有账户可直接 grant</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> canal IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'canal'</span><span class="token punctuation">;</span>  
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">REPLICATION</span> SLAVE<span class="token punctuation">,</span> <span class="token keyword">REPLICATION</span> CLIENT <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'canal'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h1 id="安装Server"><a href="#安装Server" class="headerlink" title="安装Server"></a>安装Server</h1><blockquote>
<p>下载：canal.deployer-1.1.6.tar.gz</p>
</blockquote>
<p>1.conf&#x2F;example&#x2F;instance.properties配置修改</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#position info，需要改成自己的数据库信息</span>
<span class="token key attr-name">canal.instance.master.address</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1:3306 </span>
<span class="token key attr-name">canal.instance.master.journal.name</span> <span class="token value attr-value">= </span>
<span class="token key attr-name">canal.instance.master.position</span> <span class="token value attr-value">= </span>
<span class="token key attr-name">canal.instance.master.timestamp</span> <span class="token value attr-value">= </span>
<span class="token comment">#canal.instance.standby.address = </span>
<span class="token comment">#canal.instance.standby.journal.name =</span>
<span class="token comment">#canal.instance.standby.position = </span>
<span class="token comment">#canal.instance.standby.timestamp = </span>
<span class="token comment">#username/password，需要改成自己的数据库信息</span>
<span class="token key attr-name">canal.instance.dbUsername</span> <span class="token punctuation">=</span> <span class="token value attr-value">canal  </span>
<span class="token key attr-name">canal.instance.dbPassword</span> <span class="token punctuation">=</span> <span class="token value attr-value">canal</span>
<span class="token key attr-name">canal.instance.defaultDatabaseName</span> <span class="token value attr-value">=</span>
<span class="token key attr-name">canal.instance.connectionCharset</span> <span class="token punctuation">=</span> <span class="token value attr-value">UTF-8</span>
<span class="token comment">#table regex</span>
<span class="token key attr-name">canal.instance.filter.regex</span> <span class="token punctuation">=</span> <span class="token value attr-value">.\*\\\\..\*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> bin/startup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="安装RDB适配器"><a href="#安装RDB适配器" class="headerlink" title="安装RDB适配器"></a>安装RDB适配器</h1><blockquote>
<p>下载：canal.adapter-1.1.7-SNAPSHOT.tar.gz</p>
</blockquote>
<p>1.修改启动器配置: application.yml, 这里以mysql目标库为例,将bootstrap.yml注释掉</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">srcDataSources:
    defaultDS:
      url: jdbc:mysql://192.168.67.24:3306/mytest?useUnicode=true
      username: root
      password: *******
  canalAdapters:
  - instance: example # canal instance Name or mq topic name
    groups:
    - groupId: g1
      outerAdapters:
      - name: rdb                                               # 指定为rdb类型同步
        key: mysql1                                            # 指定adapter的唯一key, 与表映射配置中outerAdapterKey对应
        properties:
          jdbc.driverClassName: com.mysql.jdbc.Driver        # jdbc驱动名, 部分jdbc的jar包需要自行放致lib目录下
          jdbc.url: jdbc:mysql://192.168.67.16:31185/mytest?useUnicode=true        # jdbc url
          jdbc.username: dongzhimen                                 # jdbc username
          jdbc.password: **********                                # jdbc password
          druid.stat.enable: false                                           
		  druid.stat.slowSqlMillis: 1000	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.修改conf&#x2F;rdb&#x2F;mytest_user.yml文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">dataSourceKey: defaultDS
destination: example
outerAdapterKey: mysql1
concurrent: true
dbMapping:
  mirrorDb: true
  database: mytest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>其中dbMapping.database的值代表源库和目标库的schema名称，即两库的schema要一模一样</p>
</blockquote>
<p>3.启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> startup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.orionpotter.space/post/Git%20Tutorial.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/Git%20Tutorial.html" itemprop="url">git tutorial</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-01-24T00:00:00+08:00">
                2024-01-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T14:06:41+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          学习如何使用Git
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/post/Git%20Tutorial.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/OrionPotter" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/imlzgg" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Orion Potter</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
