<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/OrionPotter.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/OrionPotter.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="SQL," />










<meta name="description" content="重新学习如何使用SQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Sql Tutourial">
<meta property="og:url" content="https://orionpotter.space/post/SQL%20Tutorial.html">
<meta property="og:site_name" content="Orion Potter&#39;s 个人博客">
<meta property="og:description" content="重新学习如何使用SQL">
<meta property="og:locale">
<meta property="og:image" content="https://telegraph-image-2ni.pages.dev/file/ed982a598d21a6236e396.png">
<meta property="og:image" content="https://telegraph-image-2ni.pages.dev/file/b78aebc06adebbd52b923.png">
<meta property="article:published_time" content="2022-06-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-04T08:48:53.527Z">
<meta property="article:author" content="Orion Potter">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://telegraph-image-2ni.pages.dev/file/ed982a598d21a6236e396.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://orionpotter.space/post/SQL Tutorial.html"/>





  <title>Sql Tutourial | Orion Potter's 个人博客</title>
  








<meta name="generator" content="Hexo 6.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Orion Potter's 个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-folder"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://orionpotter.space/post/SQL%20Tutorial.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Sql Tutourial</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-06-18T00:00:00+08:00">
                2022-06-18
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T16:48:53+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  重新学习如何使用SQL
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Sql介绍"><a href="#Sql介绍" class="headerlink" title="Sql介绍"></a>Sql介绍</h1><h2 id="关系型数据库是什么"><a href="#关系型数据库是什么" class="headerlink" title="关系型数据库是什么"></a>关系型数据库是什么</h2><blockquote>
<p>关系型数据库是以结构化的方式组织和存储数据的数据库</p>
</blockquote>
<ul>
<li>表（Table）：数据存储的地方，可以想象为一个网格，由行和列组成。每个表代表数据库中的一个实体或概念。</li>
</ul>
<ul>
<li>行（Row）：表中的一行代表了一个记录（Record），即一组相关的数据项。每行都是一个数据实体的实例。</li>
<li>列（Column）：表中的一列存放的是同一种数据，例如名字或者价格等。列有一个定义好的数据类型，如整数、字符串、日期等。</li>
<li>主键（Primary Key）：表中的一个列或列的组合，它唯一标识表中的每一行，不会有重复的主键值。</li>
<li>外键（Foreign Key）：一个表中的字段，它是另一个表的主键，用于创建表与表之间的关联。</li>
<li>关系（Relationship）：表间的连结，通过外键实现，可以是一对一、一对多或多对多。</li>
<li>约束（Constraints）：用于确保数据库中数据的准确性和可靠性的规则。如主键约束、外键约束、唯一性约束等。</li>
<li>SQL（Structured Query Language）：用于执行各种操作的标准语言，如数据查询、更新记录、管理和定义数据结构等。</li>
</ul>
<blockquote>
<p>常见的关系型数据库管理系统（RDBMS）包括：Oracle、Microsoft SQL Server、MySQL、PostgreSQL和SQLite。</p>
</blockquote>
<h2 id="RDBMS的优点和缺点"><a href="#RDBMS的优点和缺点" class="headerlink" title="RDBMS的优点和缺点"></a>RDBMS的优点和缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><strong>关系模型</strong>：数据以表格形式存储，数据模型直观、清晰，易于理解和维护。</li>
<li><strong>支持事务</strong>：确保并发操作和故障恢复的一致性。</li>
<li><strong>SQL</strong>：支持SQL语句，简单易学。</li>
<li><strong>备份和恢复</strong>：提供强大的备份和恢复机制，确保数据在故障或灾难情况下的安全。</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li><strong>性能瓶颈</strong>：复杂的多表查询和嵌套查询在大规模数据下性能差。</li>
<li><strong>扩展性有限</strong>：垂直扩展成本高，水平扩展下分布式和高并发存在挑战。</li>
</ul>
<h2 id="SQL和NoSql数据库的区别"><a href="#SQL和NoSql数据库的区别" class="headerlink" title="SQL和NoSql数据库的区别"></a>SQL和NoSql数据库的区别</h2><h3 id="Sql数据库"><a href="#Sql数据库" class="headerlink" title="Sql数据库"></a>Sql数据库</h3><blockquote>
<p>SQL（结构化查询语言）数据库也称为关系数据库。它们具有预定义的架构，数据存储在由行和列组成的表中。 SQL数据库遵循ACID（原子性、一致性、隔离性、持久性）属性来确保事务的可靠。一些流行的 SQL 数据库包括 MySQL、PostgreSQL 和 Microsoft SQL Server。</p>
</blockquote>
<h3 id="NoSQL-数据库"><a href="#NoSQL-数据库" class="headerlink" title="NoSQL 数据库"></a>NoSQL 数据库</h3><blockquote>
<p>NoSQL（不仅是 SQL）数据库是指非关系数据库，它不遵循固定的数据存储模式。相反，它们使用灵活的半结构化格式，例如 JSON 文档、键值对或图表。 MongoDB、Cassandra、Redis是一些流行的 NoSQL 数据库。</p>
</blockquote>
<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><ul>
<li><strong>SQL数据库</strong>：数据以表格形式存储，表与表之间通过外键建立关系。</li>
<li><strong>NoSQL数据库</strong>：支持多种数据模型存储，包括文档模型、键值模型、列族模型和图模型。</li>
</ul>
<h3 id="查询语言"><a href="#查询语言" class="headerlink" title="查询语言"></a>查询语言</h3><ul>
<li><strong>SQL数据库</strong>：使用标准的SQL查询语言。</li>
<li><strong>NoSQL数据库</strong>：类型的NoSQL数据库使用不同的查询语言和API。</li>
</ul>
<h3 id="扩展性"><a href="#扩展性" class="headerlink" title="扩展性"></a>扩展性</h3><ul>
<li><strong>SQL数据库</strong>：垂直扩展成本高，水平扩展高并发和分布式有挑战。</li>
<li><strong>NoSQL数据库</strong>：扩展性好，通过水平扩展通过增加节点处理大规模数据和高并发。</li>
</ul>
<h3 id="事务和一致性"><a href="#事务和一致性" class="headerlink" title="事务和一致性"></a>事务和一致性</h3><ul>
<li><strong>SQL数据库</strong>：支持ACID（原子性、一致性、隔离性、持久性）事务，确保数据的一致性和完整性。</li>
<li><strong>NoSQL数据库</strong>：许多NoSQL数据库采用最终一致性模型，确保在一定时间内数据最终达到一致状态。</li>
</ul>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ul>
<li><strong>SQL数据库</strong>：<ul>
<li><strong>事务处理</strong>：适用于需要强一致性和事务支持的应用，如银行、金融、电商等。</li>
<li><strong>复杂查询</strong>：适用于需要执行复杂查询和报表生成的应用，如数据分析、商业智能等。</li>
</ul>
</li>
<li><strong>NoSQL数据库</strong>：<ul>
<li><strong>大规模数据处理</strong>：适用于需要处理大规模数据和高并发访问的应用，如社交媒体、物联网、大数据分析等。</li>
<li><strong>高可用性和分布式系统</strong>：适用于需要高可用性和分布式存储的应用，如分布式缓存、消息队列等。</li>
</ul>
</li>
</ul>
<h1 id="SQL基础"><a href="#SQL基础" class="headerlink" title="SQL基础"></a>SQL基础</h1><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><blockquote>
<p>SQL不区分大小写，关键字可以小写，为了方便阅读，约定他们都大写</p>
</blockquote>
<table>
<thead>
<tr>
<th>关键字</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>SELECT</strong></td>
<td>从数据库中检索数据</td>
</tr>
<tr>
<td><strong>FROM</strong></td>
<td>与select结合使用，指定哪个表</td>
</tr>
<tr>
<td><strong>WHERE</strong></td>
<td>用于过滤记录</td>
</tr>
<tr>
<td><strong>INSERT INTO</strong></td>
<td>往数据库中插入数据</td>
</tr>
<tr>
<td><strong>UPDATE</strong></td>
<td>更新数据库中的数据</td>
</tr>
<tr>
<td><strong>DELETE</strong></td>
<td>删除数据库中的数据</td>
</tr>
<tr>
<td><strong>CREATE DATABASE</strong></td>
<td>创建数据库</td>
</tr>
<tr>
<td><strong>ALTER DATABASE</strong></td>
<td>用于在已有的库的全局特性的修改</td>
</tr>
<tr>
<td><strong>DROP DATABASE</strong></td>
<td>删除数据库</td>
</tr>
<tr>
<td><strong>CREATE TABLE</strong></td>
<td>创建数据表</td>
</tr>
<tr>
<td><strong>ALTER TABLE</strong></td>
<td>用于在已有的表中添加、删除或修改列</td>
</tr>
<tr>
<td><strong>DROP TABLE</strong></td>
<td>删除数据表</td>
</tr>
</tbody></table>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><blockquote>
<p>SQL数据类型定义可以存储在数据库表列中的数据类型。根据 DBMS 的不同，数据类型的名称可能略有不同。</p>
</blockquote>
<p>INT用于整数。例如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employees <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>DECIMAL用于小数和小数。例如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Items <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>CHAR用于固定长度的字符串。例如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employees <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Initial <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>VARCHAR用于可变长度字符串。例如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employees <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>DATE用于格式为 ( <code>YYYY-MM-DD</code>) 的日期。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employees <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    BirthDate <span class="token keyword">DATE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>DATETIME用于格式为 ( <code>YYYY-MM-DD HH:MM:SS</code>) 的日期和时间值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    OrderDate <span class="token keyword">DATETIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>BINARY</code>用于二进制字符串</p>
<p><code>BOOLEAN</code>用于布尔值（<code>TRUE</code>或<code>FALSE</code>）</p>
<h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><blockquote>
<p>运算符主要分为几类：算术运算符、比较运算符、逻辑运算符、位运算符</p>
</blockquote>
<h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><ul>
<li>Addition</li>
<li>Subtraction</li>
<li>Multiplication</li>
<li>Division</li>
<li>Modulus</li>
</ul>
<h3 id="比较-关系-运算符"><a href="#比较-关系-运算符" class="headerlink" title="比较(关系)运算符"></a>比较(关系)运算符</h3><ul>
<li>Equal</li>
<li>Not equal</li>
<li>Greater than</li>
<li>Less than</li>
<li>Greater than or equal</li>
<li>Less than or equal</li>
</ul>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><ul>
<li>AND</li>
<li>OR</li>
<li>NOT</li>
</ul>
<h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><ul>
<li>&amp;</li>
<li>|</li>
<li>^</li>
</ul>
<h1 id="数据定义语言"><a href="#数据定义语言" class="headerlink" title="数据定义语言"></a>数据定义语言</h1><blockquote>
<p>Data Definition Language(DDL)，数据定义语言 (DDL) 主要功能是创建、修改和删除数据库表结构</p>
</blockquote>
<ol>
<li><p><code>CREATE</code>：该命令用于创建数据库或其对象（如表、索引、函数、视图、存储过程和触发器）。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//1.创建数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> myDatabase<span class="token punctuation">;</span>
<span class="token comment">//2.创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_Students_Name <span class="token keyword">ON</span> Students<span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//4.创建视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> HighGradeStudents <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Students
<span class="token keyword">WHERE</span> Grade <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>DROP</code>：该命令用于删除现有的数据库或表。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//1.删除数据库</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> myDatabase<span class="token punctuation">;</span>
<span class="token comment">//2.删除数据库表</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> Students<span class="token punctuation">;</span>
<span class="token comment">//3.删除所用</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_Students_Name <span class="token keyword">ON</span> Students<span class="token punctuation">;</span>
<span class="token comment">//4.删除视图</span>
<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> HighGradeStudents<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>ALTER</code>：这用于更改数据库的结构。它用于添加、删除&#x2F;删除或修改现有表中的列。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//1.添加列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> columnName datatype<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> <span class="token punctuation">(</span>columnName1 datatype<span class="token punctuation">,</span>columnName2 datatype<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.删除列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> columnName<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">DROP</span> <span class="token punctuation">(</span>columnName1<span class="token punctuation">,</span>columnName2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.修改列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> columnName <span class="token keyword">TYPE</span> newDataType<span class="token punctuation">;</span>
<span class="token comment">//4.添加约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> constraintName <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> column_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//5.删除约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> constraintName<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>TRUNCATE</code>：这用于从表中删除所有记录，包括为删除的记录分配的所有空间。</p>
<blockquote>
<p>TRUNCATE是SQL中的一个关键词，用于删除表中的所有记录，但不删除表本身。这意味着表的结构、属性、索引等将保持不变，只是表中的数据被清空。</p>
<p>相较于DELETE操作，TRUNCATE通常会更快，尤其是在大型表中，这是因为它在删除数据时不会记录个别行的删除操作。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>RENAME</code>：这用于重命名数据库中的对象。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> old_table_name <span class="token keyword">TO</span> new_table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<blockquote>
<p>在DDL操作中，不能执行<code>COMMIT</code>and<code>ROLLBACK</code>语句，因为MySQL引擎会自动提交更改。</p>
</blockquote>
<h1 id="数据操作语言"><a href="#数据操作语言" class="headerlink" title="数据操作语言"></a>数据操作语言</h1><blockquote>
<p>Data Manipulation Language (DML),数据操作语言 (DML)主要从数据库中插入、检索、更新和删除数据。包含了四个命令insert into、select、update、delete from</p>
</blockquote>
<ol>
<li><p><strong>INSERT INTO</strong> - 此命令用于将新行（记录）插入表中。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 1. 插入完整的列级</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> valueN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 2. 选择性插入</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> column3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> value3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>  
<span class="token comment">-- 3. 从另一个表插入</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table1 <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">,</span> columnN<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">,</span> columnN  <span class="token keyword">FROM</span> table2 <span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>SELECT</strong> - 该命令用于从数据库中选择数据。返回的数据存储在结果表中，称为结果集。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table_name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><strong>UPDATE</strong> - 此命令用于修改表中的现有行。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> table_name <span class="token keyword">SET</span> column1 <span class="token operator">=</span> value1<span class="token punctuation">,</span> column2 <span class="token operator">=</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><strong>DELETE FROM</strong> - 此命令用于从表中删除现有行（记录）。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 1. 删除表中所有行</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> students<span class="token punctuation">;</span>
<span class="token comment">-- 2. 删除指定行</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h1><h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><blockquote>
<p>SQL 聚合函数是内置函数，用于对数据执行某些计算并返回单个值。</p>
</blockquote>
<ul>
<li><p>COUNT()</p>
</li>
<li><p>SUM()</p>
</li>
<li><p>AVG()</p>
</li>
<li><p>MAX()</p>
</li>
<li><p>MIN()</p>
</li>
</ul>
<blockquote>
<p>聚合函数忽略NULL值，使用 COUNT(*) 时，会计算包括 NULL 在内的行的总数；但如果你指定某列如 COUNT(column_name)，则只会计算非 NULL 值的数量。</p>
</blockquote>
<h2 id="GROUP-BY和HAVING子句"><a href="#GROUP-BY和HAVING子句" class="headerlink" title="GROUP BY和HAVING子句"></a>GROUP BY和HAVING子句</h2><blockquote>
<p>在SQL中，<code>GROUP BY</code> 和 <code>HAVING</code> 子句通常与聚合函数一起使用，它们用于对数据分组，并对这些分组进行过滤。</p>
<p>GROUP BY 子句用于将结果集中的记录分组，每个分组包含有相同值的列。之后你可以使用聚合函数（如 COUNT, SUM, AVG, MAX, MIN），对每个分组进行聚合计算。通过 GROUP BY 子句，可以执行多样化的数据汇总分析</p>
<p>HAVING 子句类似于 WHERE 子句，不过 HAVING 主要用于过滤分组后的结果。WHERE 子句在数据分组之前进行过滤，而 HAVING 子句在数据分组之后对聚合后的结果进行过滤。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CustomerID<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>OrderID<span class="token punctuation">)</span> <span class="token keyword">AS</span> NumberOfOrders<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalAmount
<span class="token keyword">FROM</span> Orders
<span class="token keyword">WHERE</span> OrderDate <span class="token operator">BETWEEN</span> <span class="token string">'2018-01-01'</span> <span class="token operator">AND</span> <span class="token string">'2018-12-31'</span>
<span class="token operator">AND</span> <span class="token keyword">Status</span> <span class="token operator">=</span> <span class="token string">'Completed'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> CustomerID
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Amount<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="数据约束"><a href="#数据约束" class="headerlink" title="数据约束"></a>数据约束</h1><h2 id="NOT-NULL-约束"><a href="#NOT-NULL-约束" class="headerlink" title="NOT NULL 约束"></a>NOT NULL 约束</h2><blockquote>
<p>确保列不能有 NULL 值。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="UNIQUE-约束"><a href="#UNIQUE-约束" class="headerlink" title="UNIQUE 约束"></a>UNIQUE 约束</h2><blockquote>
<p>确保列中的所有值都不同。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="PRIMARY-KEY-约束"><a href="#PRIMARY-KEY-约束" class="headerlink" title="PRIMARY KEY 约束"></a>PRIMARY KEY 约束</h2><blockquote>
<p>唯一标识数据库表中的每条记录。主键必须包含唯一值。与 UNIQUE 约束完全相同，但一张表中可以有多个唯一约束，但每个表只能有一个 PRIMARY KEY 约束。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h2><blockquote>
<p>防止破坏表之间链接的操作。外键是一个表中的字段（或字段集合），它引用另一表中的主键。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders <span class="token punctuation">(</span>
    OrderID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    OrderNumber <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    ID <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>OrderID<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ID<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Students<span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CHECK-约束"><a href="#CHECK-约束" class="headerlink" title="CHECK 约束"></a>CHECK 约束</h2><blockquote>
<p>CHECK 约束确保列中的所有值都满足特定条件。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Age<span class="token operator">>=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="DEFAULT-约束"><a href="#DEFAULT-约束" class="headerlink" title="DEFAULT 约束"></a>DEFAULT 约束</h2><blockquote>
<p>在未指定任何列时为列提供默认值。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span><span class="token punctuation">,</span>
    City <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'Unknown'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="INDEX-约束"><a href="#INDEX-约束" class="headerlink" title="INDEX 约束"></a>INDEX 约束</h2><blockquote>
<p>用于快速创建数据库并从数据库检索数据。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> Students <span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h1><h2 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> table2 <span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name <span class="token operator">=</span> table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h2><blockquote>
<p>该<code>LEFT JOIN</code>关键字返回左表（table1）中的所有记录以及右表（table2）中的匹配记录。如果没有匹配，结果<code>NULL</code>从右侧开始。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> table2 <span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name <span class="token operator">=</span> table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="右连接"><a href="#右连接" class="headerlink" title="右连接"></a>右连接</h2><blockquote>
<p>该<code>RIGHT JOIN</code>关键字返回右表 (table2) 中的所有记录以及左表 (table1) 中的匹配记录。如果没有匹配，则结果<code>NULL</code>在左侧。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1 <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> table2 <span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name <span class="token operator">=</span> table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="全外连接"><a href="#全外连接" class="headerlink" title="全外连接"></a>全外连接</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span> 中的<span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span>是一种根据两个或多个表之间的相关列组合来自两个或多个表的行的方法。它返回左表 <span class="token punctuation">(</span> table1<span class="token punctuation">)</span> 和右表 <span class="token punctuation">(</span> table2<span class="token punctuation">)</span> 中的所有行。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span>   a<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>b<span class="token punctuation">.</span><span class="token operator">*</span>   <span class="token keyword">from</span>   a <span class="token keyword">full</span> <span class="token keyword">join</span> b <span class="token keyword">on</span> a<span class="token punctuation">.</span>id<span class="token operator">=</span>b<span class="token punctuation">.</span>id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h2><blockquote>
<p><code>SELF JOIN</code>是一个标准 SQL 操作，其中表与其自身连接。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>column_name<span class="token punctuation">,</span> b<span class="token punctuation">.</span>column_name <span class="token keyword">FROM</span> table_name <span class="token keyword">AS</span> a<span class="token punctuation">,</span> table_name <span class="token keyword">AS</span> b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>common_field <span class="token operator">=</span> b<span class="token punctuation">.</span>common_field<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h2><blockquote>
<p>SQL 中的交叉连接用于将第一个表的每一行与第二个表的每一行组合起来。它也称为两个表的笛卡尔积。执行交叉连接最重要的一点是它不需要任何连接条件。</p>
<p>交叉联接的问题是它返回两个表的笛卡尔积，这可能会导致大量行和大量资源使用。因此，明智地使用它们并且仅在必要时使用它们至关重要。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1 <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> table2<span class="token punctuation">;</span>
<span class="token comment">-- 等价于</span>
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1<span class="token punctuation">,</span> table2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h1><blockquote>
<p>在 SQL 中，子查询是嵌入另一个 SQL 查询中的查询。您也可以将其称为嵌套查询或内部查询。包含查询通常称为外部查询。子查询用于检索将在主查询中使用的数据，作为进一步限制要检索的数据的条件。</p>
<p>子查询可用于查询的各个部分，包括：</p>
<ul>
<li><strong>选择</strong>语句</li>
<li><strong>FROM</strong>子句</li>
<li><strong>WHERE</strong>子句</li>
<li><strong>GROUP BY</strong>子句</li>
<li><strong>HAVING</strong>子句</li>
</ul>
</blockquote>
<h2 id="标量子查询（单行子查询）"><a href="#标量子查询（单行子查询）" class="headerlink" title="标量子查询（单行子查询）"></a>标量子查询（单行子查询）</h2><p>标量子查询返回单个值的子查询，即返回结果是单行单列的。它通常用在比较操作符的右侧，例如 &#x3D;, &lt;, &gt;, &lt;&#x3D;, &gt;&#x3D;, &lt;&gt;。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> salary <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> employees
    <span class="token keyword">WHERE</span> department <span class="token operator">=</span> <span class="token string">'Sales'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="列子查询（多行单列子查询）"><a href="#列子查询（多行单列子查询）" class="headerlink" title="列子查询（多行单列子查询）"></a>列子查询（多行单列子查询）</h2><p>列子查询返回单列的多个值，且适用于 IN, NOT IN, ANY, ALL, EXISTS 等操作符。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> product_id <span class="token operator">IN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> product_id
    <span class="token keyword">FROM</span> order_details
    <span class="token keyword">WHERE</span> quantity <span class="token operator">></span> <span class="token number">10</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="行子查询（多行多列子查询）"><a href="#行子查询（多行多列子查询）" class="headerlink" title="行子查询（多行多列子查询）"></a>行子查询（多行多列子查询）</h2><p>行子查询返回一行或多行，并涉及多列数据，在与外部查询进行比较时使用。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span> order_date<span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> customer_id<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> orders
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer_id
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="相关子查询（相关子查询）"><a href="#相关子查询（相关子查询）" class="headerlink" title="相关子查询（相关子查询）"></a>相关子查询（相关子查询）</h2><p>相关子查询是指子查询引用了外部查询中的一个或多个列。子查询对于每一行或几行外部查询的结果，都需要重新运行一次。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e1<span class="token punctuation">.</span>employee_name
<span class="token keyword">FROM</span> employees e1
<span class="token keyword">WHERE</span> e1<span class="token punctuation">.</span>salary <span class="token operator">></span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>e2<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> employees e2
    <span class="token keyword">WHERE</span> e2<span class="token punctuation">.</span>department <span class="token operator">=</span> e1<span class="token punctuation">.</span>department
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="表子查询（派生表或内联视图）"><a href="#表子查询（派生表或内联视图）" class="headerlink" title="表子查询（派生表或内联视图）"></a>表子查询（派生表或内联视图）</h2><p>当子查询返回一个完整的表时，它可以作为一个派生表或内联视图使用在 FROM 子句中。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> department<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> salary
    <span class="token keyword">FROM</span> employees
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> department
<span class="token punctuation">)</span> <span class="token keyword">AS</span> department_total_salaries<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="EXISTS子查询"><a href="#EXISTS子查询" class="headerlink" title="EXISTS子查询"></a>EXISTS子查询</h2><p>EXISTS 子查询用于检查是否存在由子查询返回的行。EXISTS 子查询总是返回TRUE或FALSE。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> suppliers
<span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span>
    <span class="token keyword">FROM</span> products
    <span class="token keyword">WHERE</span> products<span class="token punctuation">.</span>supplier_id <span class="token operator">=</span> suppliers<span class="token punctuation">.</span>supplier_id
    <span class="token operator">AND</span> price <span class="token operator">&lt;</span> <span class="token number">20</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="高级-SQL-函数"><a href="#高级-SQL-函数" class="headerlink" title="高级 SQL 函数"></a>高级 SQL 函数</h1><h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><p><strong>ABS() 函数：</strong>该函数返回数字的绝对（正）值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">243</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- output: 243</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Avg() 函数：</strong>该函数返回列的平均值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>COUNT() 函数：</strong>该函数返回符合指定条件的行数。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>productID<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>SUM() 函数：</strong>该函数返回数字列的总和。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>MIN() &amp; MAX() 函数：</strong> MIN() 函数返回所选列的最小值，MAX() 函数返回所选列的最大值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>ROUND() 函数：</strong>此函数用于将数字字段舍入为最接近的整数，但是您可以指定要返回的小数位数。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>price<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>CEILING() 功能：</strong>该函数返回大于或等于指定数值表达式的最小整数。</p>
<pre class="line-numbers language-none"><code class="language-none">SELECT CEILING(price) FROM products;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>FLOOR() 函数：</strong>该函数返回小于或等于指定数值表达式的最大整数。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> FLOOR<span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>SQRT() 函数：</strong>该函数返回数字的平方根。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> SQRT<span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>PI() 函数：</strong>该函数返回常量Pi。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><p><code>CONCAT</code> 函数将两个或多个字符串组合成一个字符串。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CONCAT<span class="token punctuation">(</span>string1<span class="token punctuation">,</span> string2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> string_n<span class="token punctuation">)</span> 例如：
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//上述 SQL 语句的输出将是“Hello World”。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>SUBSTRING</code> 函数从给定字符串中提取字符串。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SUBSTRING<span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token keyword">start</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span> 例如：
<span class="token keyword">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token string">'SQL Tutorial'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//上述查询的输出将是“SQL”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>LENGTH</code> 函数返回字符串的长度。</p>
<pre class="line-numbers language-none"><code class="language-none">LENGTH(string) 例如：
SELECT LENGTH(&#39;Hello World&#39;);
&#x2F;&#x2F;上述 SQL 语句的输出将为 11。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>UPPER</code> 函数将字符串中的所有字母转换为大写，而 <code>LOWER</code> 函数则将字符串中的所有字母转换为小写。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">UPPER<span class="token punctuation">(</span>string<span class="token punctuation">)</span>
LOWER<span class="token punctuation">(</span>string<span class="token punctuation">)</span> 例如：
<span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//上述 SQL 语句的输出将分别是“HELLO WORLD”和“hello world”。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>TRIM</code> 函数删除字符串的前导和尾随空格,还可以删除其他指定的字符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">TRIM<span class="token punctuation">(</span><span class="token punctuation">[</span>LEADING<span class="token operator">|</span>TRAILING<span class="token operator">|</span>BOTH<span class="token punctuation">]</span> <span class="token punctuation">[</span>removal_string<span class="token punctuation">]</span> <span class="token keyword">FROM</span> original_string<span class="token punctuation">)</span> 例如：
<span class="token keyword">SELECT</span> TRIM<span class="token punctuation">(</span><span class="token string">'   Hello World   '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> TRIM<span class="token punctuation">(</span><span class="token string">'h'</span> <span class="token keyword">FROM</span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- output: 第一个查询的输出将是“Hello World”，第二个查询的输出将是“ello”。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>replace</code>函数替换指定的字符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REPLACE</span><span class="token punctuation">(</span>input_string<span class="token punctuation">,</span> string_to_replace<span class="token punctuation">,</span> replacement_string<span class="token punctuation">)</span> 例如：
<span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'Potter'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">)</span>
<span class="token comment">-- output: petter</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h2><p><strong>CASE表达式</strong></p>
<blockquote>
<p>相当于其他编程语言的IF-THEN-ELSE 逻辑</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 语法：</span>
<span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token keyword">CASE</span> 
    <span class="token keyword">WHEN</span> condition1 <span class="token keyword">THEN</span> result1
    <span class="token keyword">WHEN</span> condition2 <span class="token keyword">THEN</span> result2
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">ELSE</span> result 
<span class="token keyword">END</span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
<span class="token comment">-- 例子：</span>
<span class="token keyword">SELECT</span> OrderID<span class="token punctuation">,</span> Quantity<span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token keyword">CASE</span>
     <span class="token keyword">WHEN</span> Quantity <span class="token operator">></span> <span class="token number">30</span> <span class="token keyword">THEN</span> <span class="token string">'Over 30'</span>
     <span class="token keyword">WHEN</span> Quantity <span class="token operator">=</span> <span class="token number">30</span> <span class="token keyword">THEN</span> <span class="token string">'Equals 30'</span>
     <span class="token keyword">ELSE</span> <span class="token string">'Under 30'</span>
 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> QuantityText
<span class="token keyword">FROM</span> OrderDetails<span class="token punctuation">;</span>
<span class="token comment">-- output: 查询逻辑为：查询OrderID、Quantity、QuantityText三个字段，其中QuantityText字段的值根据Quantity值判断，如果大于30则为Over 30，等于30则为Equals 30，否则为Under 30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>COALESCE表达式</strong></p>
<blockquote>
<p>SQL中的函数<code>COALESCE</code>用于管理数据中的NULL值。它从左到右扫描参数并返回第一个不是NULL的参数。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> valueN<span class="token punctuation">)</span>
<span class="token comment">-- 示例1：</span>
<span class="token keyword">SELECT</span> product_name<span class="token punctuation">,</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>price<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Price  <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token comment">-- output: 如果产品条目的“价格”列为NULL，则它将返回“0”</span>
<span class="token comment">-- 示例2	：</span>
<span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'third value'</span><span class="token punctuation">,</span> <span class="token string">'fourth value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- output: 它将返回“第三个值”，因为这是列表中的第一个非 NULL 值。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>NULLIF表达式</strong></p>
<blockquote>
<p><code>NULLIF</code>相比<code>expression1</code>于<code>expression2</code>.如果<code>expression1</code>和<code>expression2</code>相等，则函数返回 NULL。否则，它返回<code>expression1</code>。两个表达式必须具有相同的数据类型。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">NULLIF</span><span class="token punctuation">(</span>expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">)</span><span class="token punctuation">;</span>
示例<span class="token number">1</span>：
<span class="token keyword">SELECT</span> 
    first_name<span class="token punctuation">,</span> 
    last_name<span class="token punctuation">,</span>
    <span class="token keyword">NULLIF</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> <span class="token string">'NA'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> email
<span class="token keyword">FROM</span> 
    users<span class="token punctuation">;</span>
<span class="token comment">-- output:  如果字段 email 为“NA”，则将返回 NULL。否则email返回实际的字段值。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>IF表达式</strong></p>
<blockquote>
<p><code>IF</code>如果条件为 TRUE，则函数返回 value_true；如果条件为 FALSE，则返回 value_false。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">IF</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span>value_true<span class="token punctuation">,</span>value_false<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'One is greater than zero'</span><span class="token punctuation">,</span> <span class="token string">'One is not greater than zero'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h2><h3 id="DATE"><a href="#DATE" class="headerlink" title="DATE"></a>DATE</h3><p>创建Date类型的表</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders <span class="token punctuation">(</span>
    OrderId <span class="token keyword">int</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    OrderDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>插入日期数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Orders <span class="token punctuation">(</span>OrderId<span class="token punctuation">,</span> ProductName<span class="token punctuation">,</span> OrderDate<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Product 1'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查询指定日期</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Orders  <span class="token keyword">WHERE</span> OrderDate <span class="token operator">=</span> <span class="token string">'2022-01-01'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>更新日期</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> Orders  <span class="token keyword">SET</span> OrderDate <span class="token operator">=</span> <span class="token string">'2022-01-02'</span>  <span class="token keyword">WHERE</span> OrderId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回当前日期</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>日期差异</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token string">'2022-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-15'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> DiffInDays<span class="token punctuation">;</span>
<span class="token comment">-- output: 14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>日期添加</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2022-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> NewDate<span class="token punctuation">;</span>
<span class="token comment">-- output:  Sun Jan 01 2023 08:00:00 GMT+0800 (台北标准时间)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="TIME"><a href="#TIME" class="headerlink" title="TIME"></a>TIME</h3><blockquote>
<p>在 SQL 中，TIME 数据类型用于在数据库中存储时间值。它允许您存储小时、分钟和秒。 TIME 的格式为“HH:MI:SS”。</p>
</blockquote>
<p>创建Time字段语法</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">(</span>
    column_name <span class="token keyword">TIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>插入时间字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'17:34:20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>范围</p>
<blockquote>
<p>SQL 中的时间范围是’00:00:00’到’23:59:59’。</p>
</blockquote>
<p>获取当前时间</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>添加时间</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'2007-12-31 23:59:59'</span><span class="token punctuation">,</span><span class="token string">'1 1:1:1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>时间差</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 减去时间差</span>
<span class="token keyword">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">'2000:01:01 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'2000:01:01 00:01:01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>转换</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 函数在MySQL中用于将时间值转换为秒</span>
<span class="token keyword">SELECT</span> TIME_TO_SEC<span class="token punctuation">(</span><span class="token string">'22:23:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- output: 80580</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="DATEPART"><a href="#DATEPART" class="headerlink" title="DATEPART"></a>DATEPART</h3><blockquote>
<p><code>DATEPART</code>是 SQL 中的一个有用函数，可以使用它从任何日期或时间表达式获取年、季度、月、年中的某一天、日、周、工作日、小时、分钟、秒或毫秒。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 在日期中提取年、月、日</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Year'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Month'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Day'</span><span class="token punctuation">;</span>
<span class="token comment">-- 日期时间中提取小时、分钟或秒</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">hour</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14T13:30:15'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Hour'</span><span class="token punctuation">,</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">minute</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14T13:30:15'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Minute'</span><span class="token punctuation">,</span>
<span class="token keyword">SELECT</span> DATEPART<span class="token punctuation">(</span><span class="token keyword">second</span><span class="token punctuation">,</span> <span class="token string">'2021-07-14T13:30:15'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Second'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="DATEADD"><a href="#DATEADD" class="headerlink" title="DATEADD"></a>DATEADD</h3><blockquote>
<p>语法：<br><code>DATEADD(interval, number, date)</code></p>
<ul>
<li>间隔类型（例如日、月、年、小时、分钟、秒）</li>
<li>一个数字（对于未来日期可以是正数，对于过去日期可以是负数）</li>
<li>计算所依据的日期。</li>
</ul>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'2022-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> NewDate
<span class="token comment">-- output: 2022-01-04</span>
<span class="token comment">-- 查找未来7天的数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Orders <span class="token keyword">WHERE</span> OrderDate <span class="token operator">&lt;=</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TIMESTAMP"><a href="#TIMESTAMP" class="headerlink" title="TIMESTAMP"></a>TIMESTAMP</h3><blockquote>
<p>SQL<code>TIMESTAMP</code>是一种允许您存储日期和时间的数据类型。它通常用于跟踪对记录所做的更新和更改，提供发生的时间顺序。</p>
<p>根据 SQL 平台的不同，格式和存储大小可能略有不同。例如，<code>MySQL</code> 使用<code>YYYY-MM-DD HH:MI:SS</code>格式，而在 <code>PostgreSQL</code> 中，它存储为<code>YYYY-MM-DD HH:MI:SS</code>格式，但它还可以存储微秒</p>
</blockquote>
<p><code>TIMESTAMP</code>以下是如何在 SQL 表中定义具有类型的列：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">(</span>
   column1 <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span>
   column2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一个常见的用例<code>TIMESTAMP</code>是每次更新行时自动更新时间戳。这可以通过将<code>DEFAULT</code>约束设置为来实现<code>CURRENT_TIMESTAMP</code>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">(</span>
   column1 <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
   column2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 MySQL 中，每当行的其他字段发生任何更改时，<code>ON UPDATE CURRENT_TIMESTAMP</code>可用于自动将字段更新为当前日期和时间。<code>TIMESTAMP</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">(</span>
   column1 <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
   column2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>您还可以插入或更新具有特定时间戳的记录：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2019-06-10 10:20:30'</span><span class="token punctuation">,</span> <span class="token string">'example data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> table_name <span class="token keyword">SET</span> column1 <span class="token operator">=</span> <span class="token string">'2020-07-20 15:30:45'</span> <span class="token keyword">WHERE</span> column2 <span class="token operator">=</span> <span class="token string">'example data'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><blockquote>
<p>视图是一个虚拟的表，不直接存储数据，存的是SQL的查询，因此视图根据原表的数据变化而变化</p>
</blockquote>
<p>创建视图</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> CustomerView <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> CustomerID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Address <span class="token keyword">FROM</span> Customers<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查询视图</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> CustomerView<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>更新视图</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> CustomerView <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> CustomerID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Address<span class="token punctuation">,</span> Phone <span class="token keyword">FROM</span> Customers<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>删除视图</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> CustomerView<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><blockquote>
<p>SQL中的触发器（Trigger）是一种特殊的存储过程，它会在特定的数据库事件（如INSERT、UPDATE、DELETE）发生时自动执行。</p>
</blockquote>
<h2 id="触发器的类型"><a href="#触发器的类型" class="headerlink" title="触发器的类型"></a>触发器的类型</h2><ol>
<li><strong>按触发事件分类</strong>：<ul>
<li><strong>INSERT触发器</strong>：在插入数据时触发。</li>
<li><strong>UPDATE触发器</strong>：在更新数据时触发。</li>
<li><strong>DELETE触发器</strong>：在删除数据时触发。</li>
</ul>
</li>
<li><strong>按触发时间分类</strong>：<ul>
<li><strong>BEFORE触发器</strong>：在执行DML语句（INSERT、UPDATE、DELETE）之前触发。</li>
<li><strong>AFTER触发器</strong>：在执行DML语句之后触发。</li>
</ul>
</li>
</ol>
<h2 id="触发器使用场景"><a href="#触发器使用场景" class="headerlink" title="触发器使用场景"></a>触发器使用场景</h2><h3 id="数据完整性和一致性"><a href="#数据完整性和一致性" class="headerlink" title="数据完整性和一致性"></a>数据完整性和一致性</h3><p>触发器可以确保数据在插入、更新或删除时满足特定的业务规则。例如，可以使用触发器来检查某个字段的值是否在允许的范围内，或者确保两个表之间的引用完整性。</p>
<h3 id="自动化任务"><a href="#自动化任务" class="headerlink" title="自动化任务"></a>自动化任务</h3><p>触发器可以用于自动执行一些任务，如记录日志、发送通知、更新相关表等。例如，当某个表中的数据发生变化时，可以使用触发器自动记录这些变化到日志表中。</p>
<h3 id="审计和日志"><a href="#审计和日志" class="headerlink" title="审计和日志"></a>审计和日志</h3><p>触发器可以用来记录对数据的所有更改，以便进行审计和追踪。例如，可以创建一个触发器，在每次更新或删除记录时，将旧数据保存到审计表中。</p>
<h3 id="复杂的业务逻辑"><a href="#复杂的业务逻辑" class="headerlink" title="复杂的业务逻辑"></a>复杂的业务逻辑</h3><p>触发器可以用来实现一些复杂的业务逻辑，这些逻辑可能很难通过简单的SQL语句来实现。例如，可以使用触发器来计算和更新库存量、自动生成订单编号等。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><strong>基本语法</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> trigger_name
BEFORE<span class="token operator">|</span><span class="token keyword">AFTER</span> 事件 <span class="token keyword">on</span> table_name
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">//todo 具体要做的事</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>创建一个在插入数据之前触发的触发器</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> before_insert_trigger
BEFORE <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> my_table
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 在插入数据之前执行的操作</span>
    <span class="token keyword">IF</span> NEW<span class="token punctuation">.</span>column1 <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span>
        <span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>column1 <span class="token operator">=</span> <span class="token string">'default_value'</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>创建一个在更新数据之后触发的触发器</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> after_update_trigger
<span class="token keyword">AFTER</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> my_table
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 在更新数据之后执行的操作</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_log <span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> operation<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> new_value<span class="token punctuation">,</span> change_time<span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'my_table'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>column1<span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>column1<span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>创建一个在删除数据之后触发的触发器</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> after_delete_trigger
<span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> my_table
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 在删除数据之后执行的操作</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_log <span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> operation<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> change_time<span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'my_table'</span><span class="token punctuation">,</span> <span class="token string">'DELETE'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>column1<span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="什么是索引"><a href="#什么是索引" class="headerlink" title="什么是索引"></a>什么是索引</h3><blockquote>
<p>索引是数据库中辅助快速查找数据的辅助数据结构，类似于书籍的目录，快速定位所需信息</p>
</blockquote>
<h3 id="索引的作用"><a href="#索引的作用" class="headerlink" title="索引的作用"></a>索引的作用</h3><ol>
<li>提高查询速度</li>
<li>提高连接操作的效率（连接键有索引）</li>
<li>加速排序和分组操作（利用索引的有序性）</li>
<li>唯一索引可以避免重复数据</li>
</ol>
<h3 id="索引的数据结构和工作原理"><a href="#索引的数据结构和工作原理" class="headerlink" title="索引的数据结构和工作原理"></a>索引的数据结构和工作原理</h3><h4 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B-Tree索引"></a>B-Tree索引</h4><p>B-树是一种自平衡的树数据结构，其节点按照一定的顺序排列，保证从根节点到叶节点的路径长度相同，数据都存储在叶节点中，内部节点只存储键值和指针，MySQL的InnoDB使用B+树作为默认索引结构。</p>
<p><strong>工作原理</strong></p>
<ol>
<li><strong>查找</strong>：从根节点开始，根据键值逐层向下查找，直到找到叶节点。</li>
<li><strong>插入</strong>：找到适当的叶节点插入新键值，如果节点满了，则进行分裂，可能导致树的高度增加。</li>
<li><strong>删除</strong>：找到要删除的键值，从叶节点删除，如果节点变得太空，则进行合并或重分配，可能导致树的高度减少。</li>
<li><strong>范围查询</strong>：从根节点开始，根据键值逐层向下查找，找到起始叶节点，然后顺序读取叶节点。</li>
</ol>
<h4 id="Hash索引"><a href="#Hash索引" class="headerlink" title="Hash索引"></a>Hash索引</h4><p>哈希索引基于哈希表实现，使用哈希函数将键值映射到哈希桶（Bucket）,主要用于等值查询。</p>
<p><strong>工作原理</strong></p>
<ol>
<li><strong>查找</strong>：使用哈希函数计算键值的哈希码，定位到对应的哈希桶，然后在桶中查找具体的键值。</li>
<li><strong>插入</strong>：使用哈希函数计算键值的哈希码，定位到对应的哈希桶，然后插入键值和指针。</li>
<li><strong>删除</strong>：使用哈希函数计算键值的哈希码，定位到对应的哈希桶，然后删除键值和指针。</li>
<li><strong>等值查询</strong>：哈希索引非常适合等值查询，但不适合范围查询。</li>
</ol>
<h4 id="BitMap索引"><a href="#BitMap索引" class="headerlink" title="BitMap索引"></a>BitMap索引</h4><p>位图索引使用位图（Bitmap）来表示数据的存在性，适用于低基数列（如性别、状态等）多条件查询。</p>
<p><strong>工作原理</strong></p>
<ol>
<li><strong>查找</strong>：根据键值找到对应的位图，然后扫描位图获取匹配的行记录。</li>
<li><strong>插入</strong>：更新对应的位图。</li>
<li><strong>删除</strong>：更新对应的位图。</li>
<li><strong>多条件查询</strong>：通过位图的按位操作（如AND、OR）高效地进行多条件查询。</li>
</ol>
<h4 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h4><p>全文索引用于对文本数据进行全文搜索，通常基于倒排索引（Inverted Index）实现，适用于文本数据全文搜索查询。</p>
<p><strong>工作原理</strong></p>
<ol>
<li><strong>查找</strong>：根据查询词找到对应的词条列表，然后合并词条列表获取匹配的文档。</li>
<li><strong>插入</strong>：将文档中的每个词添加到倒排索引中。</li>
<li><strong>删除</strong>：从倒排索引中删除文档中的每个词。</li>
<li><strong>查询</strong>：通过倒排索引高效地进行全文搜索。</li>
</ol>
<h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><ol>
<li><p>根据存储结构分类:</p>
<ul>
<li>B-Tree索引：这是最常见的索引类型，支持随机访问、顺序访问、范围访问和部分键匹配查询。</li>
<li>Hash索引：基于哈希表实现，适合等值查询，但不支持范围查询。</li>
<li>R-Tree索引：适用于空间数据，如地图坐标。</li>
<li>Bitmap索引：适用于有限离散取值的列，如性别、国家等。</li>
</ul>
</li>
<li><p>根据物理实现分类:</p>
<ul>
<li>聚簇索引（Clustered Index）：数据行的物理顺序与键值的逻辑（索引）顺序相同。一个表只能有一个聚簇索引。</li>
<li>非聚簇索引（Non-Clustered Index）：索引顺序与数据行的物理存储顺序不同。</li>
</ul>
</li>
<li><p>按照列的数目分类:</p>
<ul>
<li>单列索引：索引只包含一个列。</li>
<li>复合索引&#x2F;组合索引：也称多列索引，索引包含两个以上的列。</li>
</ul>
</li>
<li><p>按照唯一性分类:</p>
<ul>
<li>唯一索引（Unique Index）：确保索引键列的每行数据都是唯一的。</li>
<li>非唯一索引：允许索引键列中有重复的值。</li>
</ul>
</li>
<li><p>根据是否为表的一部分分类:</p>
<ul>
<li>主键索引：通常是表的主键的唯一索引。</li>
<li>辅助索引&#x2F;二级索引：表中除了主键索引之外的索引。</li>
</ul>
</li>
<li><p>功能性分类:</p>
<ul>
<li>全文索引（Full-text Indexes）：为了在文本数据列中支持复杂的查询，如匹配某些搜索词或短语等。</li>
<li>部分索引（Partial Indexes）：也称为过滤索引，只为表中符合特定条件的部分数据建立索引。</li>
</ul>
</li>
<li><p>其他特殊类型的索引:</p>
<ul>
<li>空间索引（Spatial Index）：用于地理空间数据的查询。</li>
<li>XML索引：用于XML数据类型的字段，加快XML数据的查询效率。</li>
</ul>
</li>
</ol>
<p>索引的选择和使用应该基于数据的使用模式、查询类型、数据分布和数据库管理系统的特性。合适的索引能够大幅提高查询性能，但是也会消耗额外的存储空间，且在数据变更时需要维护，可能影响写入性能。因此，设计索引时需要权衡查询优化与资源消耗。</p>
<h2 id="索引创建与管理"><a href="#索引创建与管理" class="headerlink" title="索引创建与管理"></a>索引创建与管理</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 创建单列索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 创建复合索引/多列索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name<span class="token punctuation">(</span>column1，column2，column3，……<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="重建索引"><a href="#重建索引" class="headerlink" title="重建索引"></a>重建索引</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 频繁操作后可能会产生碎片，重建索引可以提高效率</span>
REINDEX <span class="token keyword">INDEX</span> index_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> INDEXES <span class="token keyword">FROM</span>  table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h2><h3 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h3><h4 id="创建适当的索引"><a href="#创建适当的索引" class="headerlink" title="创建适当的索引"></a>创建适当的索引</h4><ul>
<li><strong>单列索引</strong>：对经常用于查询条件的单个列创建索引。</li>
<li><strong>多列索引（复合索引）</strong>：对经常一起使用的多个列创建复合索引，特别是WHERE子句中多个条件的组合。</li>
<li><strong>唯一索引</strong>：对需要唯一值的列（如用户名、电子邮件等）创建唯一索引，以确保数据的唯一性和加速查询。</li>
</ul>
<h4 id="使用覆盖索引"><a href="#使用覆盖索引" class="headerlink" title="使用覆盖索引"></a>使用覆盖索引</h4><p>覆盖索引包含查询所需的所有列，避免了回表操作（即从索引中找到主键后，再去主表中查找其他列），进一步提高查询效率。</p>
<h4 id="利用索引优化排序和分组"><a href="#利用索引优化排序和分组" class="headerlink" title="利用索引优化排序和分组"></a>利用索引优化排序和分组</h4><p>对经常用于ORDER BY和GROUP BY操作的列创建索引，可以显著提高排序和分组操作的性能。</p>
<h4 id="查询优化器的使用"><a href="#查询优化器的使用" class="headerlink" title="查询优化器的使用"></a>查询优化器的使用</h4><p>使用数据库的查询优化工具（如MySQL的EXPLAIN、PostgreSQL的EXPLAIN ANALYZE）来分析查询计划，确保索引被合理利用。</p>
<h3 id="索引的索引"><a href="#索引的索引" class="headerlink" title="索引的索引"></a>索引的索引</h3><h4 id="选择经常用于查询条件的列"><a href="#选择经常用于查询条件的列" class="headerlink" title="选择经常用于查询条件的列"></a>选择经常用于查询条件的列</h4><ul>
<li><strong>WHERE子句</strong>：对经常出现在WHERE子句中的列创建索引。</li>
<li><strong>JOIN操作</strong>：对经常用于表连接的列创建索引。</li>
</ul>
<h4 id="选择经常用于排序和分组的列"><a href="#选择经常用于排序和分组的列" class="headerlink" title="选择经常用于排序和分组的列"></a>选择经常用于排序和分组的列</h4><ul>
<li><strong>ORDER BY子句</strong>：对经常用于排序的列创建索引。</li>
<li><strong>GROUP BY子句</strong>：对经常用于分组的列创建索引。</li>
</ul>
<h4 id="选择基数较高的列"><a href="#选择基数较高的列" class="headerlink" title="选择基数较高的列"></a>选择基数较高的列</h4><ul>
<li><strong>高基数列</strong>：选择基数较高的列（即唯一值较多的列）创建索引，因为这些列的选择性较高，索引的效率更高。</li>
</ul>
<h4 id="选择适当的索引类型"><a href="#选择适当的索引类型" class="headerlink" title="选择适当的索引类型"></a>选择适当的索引类型</h4><ul>
<li><strong>B-树索引</strong>：适用于大多数查询操作，包括等值查询、范围查询、排序和分组。</li>
<li><strong>哈希索引</strong>：适用于等值查询，但不适用于范围查询。</li>
<li><strong>位图索引</strong>：适用于低基数列和多条件查询。</li>
<li><strong>全文索引</strong>：适用于全文搜索</li>
</ul>
<blockquote>
<ol>
<li><strong>避免过多索引</strong>：创建过多的索引会增加维护开销和存储空间，影响插入、更新和删除操作的性能。</li>
<li><strong>定期维护索引</strong>：定期重建或优化索引，以减少碎片和保持索引的高效性。</li>
<li><strong>监控和分析</strong>：使用查询优化工具（如EXPLAIN）监控和分析查询性能，确保索引被合理利用。</li>
<li><strong>选择合适的索引类型</strong>：根据查询类型和数据特性选择合适的索引类型，以达到最佳的查询性能。</li>
<li><strong>考虑复合索引的顺序</strong>：在创建复合索引时，考虑列的顺序。一般来说，选择性较高的列应放在前面。</li>
</ol>
</blockquote>
<h3 id="索引的缺点"><a href="#索引的缺点" class="headerlink" title="索引的缺点"></a>索引的缺点</h3><ol>
<li><strong>空间开销</strong>：索引需要额外的存储空间来维护数据结构，特别是对于大型表和多个索引。</li>
<li><strong>性能开销</strong>：插入、更新和删除操作需要同时更新索引，增加了性能开销。</li>
</ol>
<h2 id="索引性能调优"><a href="#索引性能调优" class="headerlink" title="索引性能调优"></a>索引性能调优</h2><h3 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h3><h4 id="什么是执行计划（EXPLAIN）"><a href="#什么是执行计划（EXPLAIN）" class="headerlink" title="什么是执行计划（EXPLAIN）"></a>什么是执行计划（EXPLAIN）</h4><p><code>EXPLAIN</code>是一个SQL命令，用于显示查询的执行计划。执行计划提供了查询优化器选择的执行路径，包括表的访问顺序、使用的索引、连接方式和估计的行数等信息。</p>
<h4 id="EXPLAIN的基本语法"><a href="#EXPLAIN的基本语法" class="headerlink" title="EXPLAIN的基本语法"></a><code>EXPLAIN</code>的基本语法</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">EXPLAIN SELECT * FROM table_name WHERE condition;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="解释执行计划的输出"><a href="#解释执行计划的输出" class="headerlink" title="解释执行计划的输出"></a>解释执行计划的输出</h4><ol>
<li>id：查询中每个子查询的标识符。查询的执行顺序是按照<code>id</code>的顺序进行的。</li>
<li>select_type：查询的类型，如<code>SIMPLE</code>（简单查询）、<code>PRIMARY</code>（主查询）、<code>SUBQUERY</code>（子查询）等。</li>
<li>table：查询中访问的表。</li>
<li>type：访问类型，表示查询使用的访问方法。常见的类型包括：<ul>
<li><code>ALL</code>：全表扫描。</li>
<li><code>index</code>：索引扫描。</li>
<li><code>range</code>：范围扫描。</li>
<li><code>ref</code>：使用非唯一索引扫描。</li>
<li><code>eq_ref</code>：使用唯一索引扫描。</li>
<li><code>const</code>：常量访问。</li>
</ul>
</li>
<li>possible_keys：查询中可能使用的索引。</li>
<li>key：查询实际使用的索引。</li>
<li>key_len：使用的索引的长度。</li>
<li>ref：索引列与查询条件的比较。</li>
<li>rows：查询优化器估计的需要读取的行数。</li>
<li>Extra：额外的信息，如<code>Using where</code>、<code>Using index</code>、<code>Using temporary</code>、<code>Using filesort</code>等。</li>
</ol>
<h4 id="常见的Extra列值及优化建议"><a href="#常见的Extra列值及优化建议" class="headerlink" title="常见的Extra列值及优化建议"></a>常见的<code>Extra</code>列值及优化建议</h4><h5 id="Using-where"><a href="#Using-where" class="headerlink" title="Using where"></a><code>Using where</code></h5><p>表示查询使用了WHERE条件进行过滤。这通常是正常的，但你可以确保WHERE条件中的列有适当的索引，以提高查询性能。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保WHERE条件中的列有索引。</li>
<li>考虑创建复合索引以覆盖多个WHERE条件。</li>
</ul>
<h5 id="Using-index"><a href="#Using-index" class="headerlink" title="Using index"></a><code>Using index</code></h5><p>表示查询使用了覆盖索引，所有需要的数据都从索引中获取，无需回表操作。这通常是理想的情况。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保查询所需的所有列都包含在索引中，以实现覆盖索引。</li>
<li>定期检查和维护索引，以确保索引的高效性。</li>
</ul>
<h5 id="Using-temporary"><a href="#Using-temporary" class="headerlink" title="Using temporary"></a><code>Using temporary</code></h5><p>表示查询使用了临时表，通常发生在需要排序或分组的查询中。这可能会影响查询性能。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保ORDER BY和GROUP BY子句中的列有索引。</li>
<li>尽量减少使用临时表的查询操作。</li>
<li>通过调整查询语句或创建适当的索引，减少临时表的使用。</li>
</ul>
<h5 id="Using-filesort"><a href="#Using-filesort" class="headerlink" title="Using filesort"></a><code>Using filesort</code></h5><p>表示查询使用了文件排序，通常发生在需要排序的查询中。这可能会影响查询性能。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保ORDER BY子句中的列有索引。</li>
<li>尽量减少使用文件排序的查询操作。</li>
<li>通过调整查询语句或创建适当的索引，减少文件排序的使用。</li>
</ul>
<h5 id="Using-join-buffer"><a href="#Using-join-buffer" class="headerlink" title="Using join buffer"></a><code>Using join buffer</code></h5><p>表示查询使用了连接缓冲区，通常发生在没有适当索引的连接操作中。这可能会影响查询性能。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保连接列有适当的索引。</li>
<li>考虑调整连接顺序或使用不同的连接方式（如嵌套循环连接、哈希连接等）。</li>
</ul>
<h5 id="Using-index-condition"><a href="#Using-index-condition" class="headerlink" title="Using index condition"></a><code>Using index condition</code></h5><p>表示查询使用了索引条件下推（Index Condition Pushdown，ICP），这是一种优化技术，可以减少回表操作。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保索引覆盖查询条件，以充分利用索引条件下推。</li>
</ul>
<h5 id="Using-intersect-union"><a href="#Using-intersect-union" class="headerlink" title="Using intersect/union"></a><code>Using intersect/union</code></h5><p>表示查询使用了索引合并，通过交集或并集操作合并多个索引的结果。</p>
<p><strong>优化建议</strong>：</p>
<ul>
<li>确保查询条件中的列有适当的索引。</li>
<li>考虑创建复合索引以替代索引合并。</li>
</ul>
<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引是指包含查询所需的所有列的索引。覆盖索引并不是一种不同的索引类型，而是复合索引的一种特殊用法。当一个索引包含了查询所需的所有列时，这个索引就被称为覆盖索引。覆盖索引可以避免回表操作，从而提高查询性能。</p>
<p>回表操作（Table Lookup 或 Table Access by Rowid）是指在使用索引查询时，数据库系统需要从索引中找到主键或行标识符（Rowid），然后再访问实际的数据行以获取所需的列数据。回表操作通常发生在索引不包含查询所需的所有列的情况下。</p>
<p><strong>回表操作的过程:</strong></p>
<ol>
<li><strong>索引查找</strong>：首先，数据库系统使用索引来快速定位符合查询条件的记录。在这个过程中，索引只包含索引列和指向实际数据行的指针（如主键或Rowid）。</li>
<li><strong>回表查找</strong>：一旦找到符合条件的索引记录，数据库系统使用指针（如主键或Rowid）访问实际的数据行，以获取查询所需的其他列的数据。</li>
</ol>
<h3 id="索引合并"><a href="#索引合并" class="headerlink" title="索引合并"></a>索引合并</h3><p>索引合并（Index Merge）是数据库查询优化器在执行查询时的一种优化策略。它允许查询优化器同时使用多个索引来满足查询条件，然后合并这些索引的结果，从而提高查询性能。</p>
<p><strong>索引合并的原理</strong></p>
<p>索引合并的基本思想是，当一个查询可以利用多个索引时，查询优化器会分别使用这些索引进行部分查询，然后将结果合并。</p>
<ol>
<li><strong>AND条件</strong>：当查询条件中包含多个列的AND操作时，查询优化器可以分别使用每个列上的索引，然后合并结果。</li>
<li><strong>OR条件</strong>：当查询条件中包含多个列的OR操作时，查询优化器可以分别使用每个列上的索引，然后合并结果。</li>
<li><strong>覆盖索引</strong>：当查询条件和选择列可以分别由不同的索引覆盖时，查询优化器可以分别使用这些索引，然后合并结果。</li>
</ol>
<p><strong>索引合并的类型</strong></p>
<ol>
<li><strong>联合索引合并（Union Index Merge）</strong>：用于处理OR条件。查询优化器分别使用每个列上的索引，然后将结果进行并集操作。</li>
<li><strong>交集索引合并（Intersection Index Merge）</strong>：用于处理AND条件。查询优化器分别使用每个列上的索引，然后将结果进行交集操作。</li>
<li><strong>排序合并（Sort-Union Index Merge）</strong>：用于处理需要排序的查询。查询优化器分别使用每个列上的索引，然后对结果进行排序和合并。</li>
</ol>
<h2 id="索引失效场景"><a href="#索引失效场景" class="headerlink" title="索引失效场景"></a>索引失效场景</h2><ol>
<li>模糊查询</li>
<li>不等值查询</li>
<li>查询提交索引列使用函数或者表达式</li>
<li>复合索引没有按照顺序</li>
<li>索引列类型不匹配，本来是int，你写sql是字符串，暗含了隐式转换</li>
<li>NULL值处理</li>
</ol>
<h2 id="聚簇索引和非聚簇索引"><a href="#聚簇索引和非聚簇索引" class="headerlink" title="聚簇索引和非聚簇索引"></a>聚簇索引和非聚簇索引</h2><p>从物理存储方式来看索引可以分为聚簇索引（Clustered Index）和非聚簇索引（Non-Clustered Index）。</p>
<h3 id="聚簇索引（Clustered-index）"><a href="#聚簇索引（Clustered-index）" class="headerlink" title="聚簇索引（Clustered index）"></a>聚簇索引（Clustered index）</h3><p>聚簇索引是按照索引键值顺序存储数据的索引。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> custered <span class="token keyword">index</span> index_name <span class="token keyword">on</span> table_name<span class="token punctuation">(</span>cloum<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li>数据存储顺序：数据行按照索引值进行物理排序存储。</li>
<li>唯一性：一个表只能由一个聚簇索引，默认是主键。</li>
<li>主键默认聚簇：数据库如果没有明确创建聚簇索引，默认主键就是聚簇索引。</li>
</ol>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ol>
<li>查询性能：根据数据行的有序性，进行范围查询、排序查询、分组查询、去重查询效率高。</li>
<li>快速检索：找到聚簇索引键值后可以快速定位到数据行，快速的查找其他的列的值。</li>
</ol>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>插入和更新开销：插入和更新操作可能会导致部分数据行重新排列。</li>
<li>表重建：更改聚簇索引，会导致整张表重新排列。</li>
</ol>
<h3 id="非聚簇索引（Non-Clustered-Index）"><a href="#非聚簇索引（Non-Clustered-Index）" class="headerlink" title="非聚簇索引（Non-Clustered Index）"></a>非聚簇索引（Non-Clustered Index）</h3><p>非聚簇索引不影响数据行的顺序，索引存在独立的B+树中，存储的是索引键值和指向数据的行指针</p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_last_name <span class="token keyword">ON</span> employees<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ol>
<li>独立存储：与数据分开存储，存储索引键值和数据的行指针</li>
<li>多个索引：不唯一，可以有多个</li>
</ol>
<h4 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h4><ol>
<li>灵活性：可以有多个聚簇索引，每个索引可以加速不同的查询操作。</li>
<li>插入和更新效率：数据行不受影响，效率高</li>
</ol>
<h4 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>回表操作：非聚簇索引需要进行回表操作（Table Lookup），即从索引中找到RowID或指针后，再访问实际的数据行。</li>
</ol>
<h2 id="数据分区"><a href="#数据分区" class="headerlink" title="数据分区"></a>数据分区</h2><p>数据分区是DBMS的一种功能，可以将一个大表或者索引分成更小、更易于管理的分区，每个分区独立存储和管理。</p>
<h3 id="数据分区的类型"><a href="#数据分区的类型" class="headerlink" title="数据分区的类型"></a>数据分区的类型</h3><ol>
<li>范围分区（Rang partitioning）: 根据列值分范围将数据分成不同的区，例如，根据日期范围分区，将数据按年份或月份分区。</li>
<li>列表分区（List partitioning）: 根据列值的具体列表将数据分成不同的分区,例如，根据地区代码分区，将数据按不同的地区分区。</li>
<li>哈希分区（Hash partitioning）: 根据列值的哈希值将数据分成不同的分区,适用于数据分布均匀的情况。</li>
<li>键值分区（Key partitioning）: 类似于哈希分区，但使用的是数据库系统内部的哈希函数,通常用于主键或唯一键。</li>
<li>复合分区（Composite partition）: 结合多种分区方法，将数据分成更细的分区,例如，先按范围分区，再按哈希分区。</li>
</ol>
<h3 id="数据分区的优点"><a href="#数据分区的优点" class="headerlink" title="数据分区的优点"></a>数据分区的优点</h3><ol>
<li><strong>提高查询性能</strong>：<ul>
<li>在特定分区内执行，减少数据扫描的范围，提高查询效率。</li>
<li>适用于范围查询和大数据量的查询。</li>
</ul>
</li>
<li><strong>简化管理</strong>：<ul>
<li>独立管理每个分区，例如备份、恢复、加载和卸载数据。</li>
<li>分区可以独立维护和优化，减少对整个表的影响。</li>
</ul>
</li>
<li><strong>提高可扩展性</strong>：<ul>
<li>分区可以分布在不同的存储设备上，提高数据存储和处理的可扩展性。</li>
<li>支持大规模数据的存储和处理。</li>
</ul>
</li>
<li><strong>提高可用性</strong>：<ul>
<li>如果一个分区出现故障，其他分区仍然可以正常工作，提高系统的可用性。</li>
</ul>
</li>
</ol>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 范围分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE <span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>
    <span class="token keyword">PARTITION</span> p2020 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2021 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2022 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 列表分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    region_code <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> LIST <span class="token punctuation">(</span>region_code<span class="token punctuation">)</span> <span class="token punctuation">(</span>
    <span class="token keyword">PARTITION</span> p_north <span class="token keyword">VALUES</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'N1'</span><span class="token punctuation">,</span> <span class="token string">'N2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p_south <span class="token keyword">VALUES</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'S1'</span><span class="token punctuation">,</span> <span class="token string">'S2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p_east <span class="token keyword">VALUES</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'E1'</span><span class="token punctuation">,</span> <span class="token string">'E2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p_west <span class="token keyword">VALUES</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'W1'</span><span class="token punctuation">,</span> <span class="token string">'W2'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 哈希分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span> PARTITIONS <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- 键值分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span> PARTITIONS <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- 复合分区</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE <span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span><span class="token punctuation">)</span> SUBPARTITION <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span> SUBPARTITIONS <span class="token number">4</span> <span class="token punctuation">(</span>
    <span class="token keyword">PARTITION</span> p2020 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2021 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2022 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="mysql数据分区如何分布在不同的存储设备"><a href="#mysql数据分区如何分布在不同的存储设备" class="headerlink" title="mysql数据分区如何分布在不同的存储设备"></a>mysql数据分区如何分布在不同的存储设备</h2><ol>
<li>创建表空间</li>
</ol>
<p>假设有三个存储设备，分别位于路径<code>/mnt/device1</code>、<code>/mnt/device2</code>和<code>/mnt/device3</code>。在每个存储设备上创建一个表空间：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> ts1 <span class="token keyword">ADD</span> DATAFILE <span class="token string">'/mnt/device1/datafile1.ibd'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> ts2 <span class="token keyword">ADD</span> DATAFILE <span class="token string">'/mnt/device2/datafile2.ibd'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> ts3 <span class="token keyword">ADD</span> DATAFILE <span class="token string">'/mnt/device3/datafile3.ibd'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建分区表并指向表空间</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    order_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE <span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>
    <span class="token keyword">PARTITION</span> p2020 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">)</span> <span class="token keyword">TABLESPACE</span> ts1<span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2021 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">)</span> <span class="token keyword">TABLESPACE</span> ts2<span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2022 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">)</span> <span class="token keyword">TABLESPACE</span> ts3
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>添加新的分区和表空间</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> ts4 <span class="token keyword">ADD</span> DATAFILE <span class="token string">'/mnt/device4/datafile4.ibd'</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> orders <span class="token keyword">ADD</span> <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> p2023 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">)</span> <span class="token keyword">TABLESPACE</span> ts4<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>删除分区</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> orders <span class="token keyword">DROP</span> <span class="token keyword">PARTITION</span> p2020<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="5">
<li>查看分区</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><blockquote>
<p>一个事务内的所有操作要么全部成功，要么全部失败，通过事务保证数据库数据的一致性。</p>
</blockquote>
<h2 id="如何使用事务"><a href="#如何使用事务" class="headerlink" title="如何使用事务"></a>如何使用事务</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 开启事务</span>
<span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span> 
<span class="token comment">-- 提交事务</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token comment">-- 回滚</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>保存点（<code>Savepoint</code>）</strong></p>
<blockquote>
<p>保存点就是快照，事务可以回滚到指定的快照节点，使用 <code>SAVEPOINT</code> 命令来设置保存点，使用 <code>ROLLBACK TO</code> 命令回滚到特定的保存点。</p>
<p>如果一个长事务在执行过程中只有某一小部分操作失败，那么在失败之前设置一个保存点，等失败后只需回滚这一部分操作，而不用回滚整个事务，提高效率。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SAVEPOINT</span> savepoint_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>事务示例：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> Accounts <span class="token keyword">SET</span> Balance <span class="token operator">=</span> Balance <span class="token operator">-</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> Accounts <span class="token keyword">SET</span> Balance <span class="token operator">=</span> Balance <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">-- 检查最后一个操作是否成功。如果上一个T-SQL操作没有产生错误，`@@ERROR`的值将为0。</span>
<span class="token keyword">IF</span> @<span class="token variable">@ERROR</span> <span class="token operator">=</span> <span class="token number">0</span> 
   <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">ELSE</span>
   <span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
<span class="token comment">-- 事务要么成功，要么失败</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="如何保证数据的完整性和可靠性"><a href="#如何保证数据的完整性和可靠性" class="headerlink" title="如何保证数据的完整性和可靠性"></a>如何保证数据的完整性和可靠性</h2><p><strong>1. 原子性（Atomicity）</strong></p>
<blockquote>
<p>一个事务（transaction）是一个原子单元，要么全部成功，要么全部不执行。</p>
</blockquote>
<p><strong>2. 一致性（Consistency）</strong></p>
<blockquote>
<p>事务操作前后，数据必须满足预定义的规则和约束，如数据类型、长度、范围等业务规则。如：一个银行应用其中一个规则是每个客户的账户余额必须大于或等于0。这是数据库的一个一致性状态。</p>
</blockquote>
<p><strong>3. 隔离性（Isolation）</strong></p>
<blockquote>
<p>一个事务执行后，它影响的数据对其他正在执行的事务是不可见的。</p>
</blockquote>
<p><strong>4. 持久性（Durability）</strong></p>
<blockquote>
<p>一个事务成功执行后，数据库中数据的更改会永久保存在数据库中。</p>
</blockquote>
<h2 id="事务并发时遇到的读取问题"><a href="#事务并发时遇到的读取问题" class="headerlink" title="事务并发时遇到的读取问题"></a>事务并发时遇到的读取问题</h2><p><strong>脏读（Dirty Read）</strong></p>
<blockquote>
<p>读取到了其他事务未提交的数据</p>
</blockquote>
<p><strong>不可重复读（Non-repeatable Read）</strong></p>
<blockquote>
<p>在一个事务内，不同的时刻读到的单个数据行的内容不一致，可能会受到其他事务的执行更新语句，改变了数据内容。</p>
</blockquote>
<p><strong>幻读（Phantom Read）</strong></p>
<blockquote>
<p>在一个事务，不同时刻读到的同一个数据范围（数据条数）不一致，可能受到了其他事务执行了插入语句后，改变了数据范围。</p>
</blockquote>
<h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><blockquote>
<p>事务的隔离级别在事务并发执行时，来管理事务之间的交互，以防范可能引发的数据不一致问题。</p>
</blockquote>
<ol>
<li><p><strong>读未提交（READ UNCOMMITTED）</strong> 一个事务可以读取其他事务未提交的更改后数据，也称为”脏读”,属于最低的隔离级别。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 以下是如何设置此级别的示例：</span>
<span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">UNCOMMITTED</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- Execute your SQL commands here</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>读已提交（READ COMMITTED）</strong> 一个事务要等到另一个事务提交后才能读取数据，解决了脏读问题，可能会遇到不可重复读的问题。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 设置此级别的方法如下：</span>
<span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- Execute your SQL commands here</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>可重复读（REPEATABLE READ）</strong> 一个事务内读到的数据保持一致，不允许其他事务进行修改操作，解决了不可重复读问题，但可能出现幻读问题。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 设置此级别的方法如下：</span>
<span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- Execute your SQL commands here</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>串行化（SERIALIZABLE）</strong> 序列化时最高级别的隔离，对查询中使用的数据获取读锁和写锁，以防止其他事务访问相应的数据。它避免了脏读、不可重复读和幻读的问题。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 设置此级别的方法如下：</span>
<span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- Execute your SQL commands here</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<blockquote>
<p><strong>更高级别的隔离通常会提供更高的一致性，但可能会由于锁等待时间的增加而降低性能。</strong></p>
</blockquote>
<h1 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h1><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><blockquote>
<p>SQL存储过程是保存了一组经过预编译的可重用的SQL代码</p>
</blockquote>
<h3 id="存储过程的优点"><a href="#存储过程的优点" class="headerlink" title="存储过程的优点"></a>存储过程的优点</h3><ol>
<li><p>预编译：存储过程在创建时会被编译并存储在数据库中。之后的调用不需要重新编译，只是执行已编译的代码，这可以提高执行效率。</p>
</li>
<li><p>减少网络流量：可以将多个SQL语句封装在一个存储过程中，用户只需一次调用，而非将多个语句分别从客户端发送到服务器，这样可以减少网络通信量。</p>
</li>
<li><p>重用和封装：存储过程可以被多个程序或应用重用。同时也可以将复杂的业务逻辑封装在存储过程内部，简化应用开发。</p>
</li>
<li><p>安全性：可以通过数据库的权限机制对存储过程进行权限控制，只允许特定用户执行特定的存储过程，从而增强了数据库操作的安全性。</p>
</li>
<li><p>事务管理：存储过程可以使用事务来确保数据的一致性。在存储过程中可以根据需要开始事务、提交事务或者在遇到错误时回滚事务。</p>
</li>
</ol>
<h3 id="存储过程如何使用"><a href="#存储过程如何使用" class="headerlink" title="存储过程如何使用"></a>存储过程如何使用</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 创建一个存储过程</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> getEmployeesBySalary
  <span class="token variable">@minSalary</span> <span class="token keyword">int</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">SELECT</span> firstName<span class="token punctuation">,</span> lastName
  <span class="token keyword">FROM</span> Employees
  <span class="token keyword">WHERE</span> salary <span class="token operator">></span> <span class="token variable">@minSalary</span>
<span class="token keyword">END</span>
GO
<span class="token comment">-- 执行存储过程</span>
<span class="token keyword">EXEC</span> getEmployeesBySalary <span class="token number">50000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><blockquote>
<p>SQL 函数是执行特定任务的一组 SQL 语句,函数必须返回一个值或结果。</p>
</blockquote>
<p><strong>1. 标量函数（Scalar functions）</strong>返回单个值，可以在使用单个表达式的地方使用。例如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> addNumbers<span class="token punctuation">(</span><span class="token variable">@a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token variable">@b</span> <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">int</span> 
<span class="token keyword">AS</span> 
<span class="token keyword">BEGIN</span>
   <span class="token keyword">RETURN</span> <span class="token variable">@a</span> <span class="token operator">+</span> <span class="token variable">@b</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. 表值函数（Table-valued functions）</strong>返回一个表。它们可以像普通表一样在 JOIN 子句中使用</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> getBooks <span class="token punctuation">(</span><span class="token variable">@authorID</span> <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">TABLE</span>
<span class="token keyword">AS</span> 
<span class="token keyword">RETURN</span> <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> books<span class="token punctuation">.</span>title<span class="token punctuation">,</span> books<span class="token punctuation">.</span>publicationYear 
   <span class="token keyword">FROM</span> books 
   <span class="token keyword">WHERE</span> books<span class="token punctuation">.</span>authorID <span class="token operator">=</span> <span class="token variable">@authorID</span>
<span class="token punctuation">)</span>
<span class="token comment">-- 调用getBooks函数</span>
<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> publicationYear <span class="token keyword">FROM</span> getBooks<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="存储过程和表值函数的区别"><a href="#存储过程和表值函数的区别" class="headerlink" title="存储过程和表值函数的区别"></a>存储过程和表值函数的区别</h2><ol>
<li><p>返回类型：</p>
<ul>
<li>存储过程可以返回零个、一个或多个结果集，也可以返回输出参数，或者根本不返回任何东西。</li>
<li>表值函数返回一个表对象，可以像使用普通表一样查询这个对象。</li>
</ul>
</li>
<li><p>使用上下文：</p>
<ul>
<li>存储过程不能在 SQL 语句（如 SELECT、UPDATE、INSERT、DELETE）中直接调用，通常需要使用特定的调用语句（如 CALL 或 EXECUTE）。</li>
<li>表值函数可以直接在 SQL 查询中作为数据源使用，就像一个表一样。</li>
</ul>
</li>
<li><p>副作用：</p>
<ul>
<li>存储过程可以包含产生副作用的 SQL 语句，如插入、更新、删除记录等。</li>
<li>表值函数通常不允许包括有副作用的操作，它们设计来用作只读操作，并且期望是确定性的。</li>
</ul>
</li>
<li><p>执行方式：</p>
<ul>
<li>存储过程需要显式执行，并且可以接受输入和输出参数。</li>
<li>表值函数可以像其他任何列或表一样参与查询，并且通常只接受输入参数。</li>
</ul>
</li>
<li><p>事务管理：</p>
<ul>
<li>存储过程中可以包含事务逻辑（如开始事务、提交事务、回滚事务）。</li>
<li>表值函数不能使用事务逻辑。</li>
</ul>
</li>
<li><p>调用方式：</p>
<ul>
<li>存储过程可以独立调用。</li>
<li>表值函数需要在 SELECT 语句中被调用，可以像表一样被 JOIN。</li>
</ul>
</li>
</ol>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><blockquote>
<p>SQL性能优化是指提高SQL的查询速度，更快的响应用户</p>
</blockquote>
<h2 id="查询优化技术"><a href="#查询优化技术" class="headerlink" title="查询优化技术"></a>查询优化技术</h2><h3 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h3><blockquote>
<p>创建索引可以提高查询性能，工作原理是将表的部分数据存储在可以快速访问的位置，索引保存列值以及记录本身的位置，这类似于书中目录页的内容和对应的页码。</p>
</blockquote>
<p>单列索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 指定某个列作为索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>复合索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 指定多个列作为索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>唯一索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 保证一列或多列的组合是唯一值</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>隐式索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 隐式索引由数据库服务器自动创建的索引。例如，当定义主键时。</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="避免选择"><a href="#避免选择" class="headerlink" title="避免选择*"></a>避免选择*</h3><blockquote>
<p>指获取所需要的列，不要使用 <code>SELECT *</code> 它减少了需要从磁盘读取的数据量</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> required_column <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="连接查询优化"><a href="#连接查询优化" class="headerlink" title="连接查询优化"></a>连接查询优化</h3><blockquote>
<p>遵循前两个的优化的基础上，在进行多表连接查询的时候，小表在前，大表在后</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Orders<span class="token punctuation">.</span>OrderID<span class="token punctuation">,</span> Customers<span class="token punctuation">.</span>CustomerName
<span class="token keyword">FROM</span> Orders
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Customers
<span class="token keyword">ON</span> Orders<span class="token punctuation">.</span>CustomerID<span class="token operator">=</span>Customers<span class="token punctuation">.</span>CustomerID<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用Limit"><a href="#使用Limit" class="headerlink" title="使用Limit"></a>使用Limit</h3><p>如果只需要一定数量的行，使用 LIMIT 关键字来限制查询返回的行数。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">column</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="避免在开头使用带通配符的-LIKE-运算符"><a href="#避免在开头使用带通配符的-LIKE-运算符" class="headerlink" title="避免在开头使用带通配符的 LIKE 运算符"></a>避免在开头使用带通配符的 LIKE 运算符</h3><p>在查询开头使用通配符 ( <code>LIKE &#39;%search_term&#39;</code>) 可能会导致全表扫描。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">column</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> <span class="token keyword">column</span> <span class="token operator">LIKE</span> <span class="token string">'search_term%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="查询分析技术"><a href="#查询分析技术" class="headerlink" title="查询分析技术"></a>查询分析技术</h2><h3 id="解释计划"><a href="#解释计划" class="headerlink" title="解释计划"></a>解释计划</h3><blockquote>
<p>数据库具有”解释计划”功能，可以显示数据库引擎执行查询的计划,这可以深入了解性能瓶颈，例如全表扫描、缺失索引等。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">PLAN</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="合理使用索引"><a href="#合理使用索引" class="headerlink" title="合理使用索引"></a>合理使用索引</h3><blockquote>
<p>使用适当的索引对于查询性能至关重要。如果存在正确的索引，则可以避免不必要的全表扫描。尽管 SQL 会自动确定要使用的适当索引，但手动指定用于复杂查询的索引会很有帮助。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 假设我们有一个用户表 users，它包含如下字段和索引：</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    first_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_last_name <span class="token keyword">ON</span> users<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 走索引查询</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Smith'</span><span class="token punctuation">;</span>  
<span class="token comment">-- 不走索引查询</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> LOWER<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'smith'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> id <span class="token operator">></span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> ABS<span class="token punctuation">(</span>id <span class="token operator">-</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1234</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>为了避免这种情况，避免表达式用于索引列。</strong></p>
<h1 id="高级SQL"><a href="#高级SQL" class="headerlink" title="高级SQL"></a>高级SQL</h1><h2 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h2><blockquote>
<p>递归查询是用于数据分析的高级 SQL 查询，尤其是在处理分层或树结构数据时。</p>
<p>递归 CTE 是引用自身的 CTE。递归 CTE 至少有两个查询：一个锚成员（仅运行一次）和一个递归成员（重复运行）</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 递归语法</span>
<span class="token keyword">WITH</span> RECURSIVE cte_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  
  <span class="token comment">-- Anchor member</span>
  <span class="token keyword">SELECT</span> column_list
  <span class="token keyword">FROM</span> table_name
  <span class="token keyword">WHERE</span> condition
  
  <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
  
  <span class="token comment">-- Recursive member</span>
  <span class="token keyword">SELECT</span> column_list
  <span class="token keyword">FROM</span> table_name
  <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> cte_name <span class="token keyword">ON</span> condition
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> cte_name<span class="token punctuation">;</span>
<span class="token comment">-- 例如：我们想要查询每个员工及其所有上级经理的信息,包括经理所在的部门名称。</span>
<span class="token keyword">WITH</span> RECURSIVE ManagerCTE <span class="token keyword">AS</span>
<span class="token punctuation">(</span>
    <span class="token comment">-- 非递归查询</span>
    <span class="token keyword">SELECT</span> 
        e<span class="token punctuation">.</span>EmployeeID<span class="token punctuation">,</span>
        e<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> EmployeeName<span class="token punctuation">,</span>
        d<span class="token punctuation">.</span>DepartmentName<span class="token punctuation">,</span>
        e<span class="token punctuation">.</span>ManagerID<span class="token punctuation">,</span>
        CAST<span class="token punctuation">(</span>e<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> ManagerNames<span class="token punctuation">,</span>
        <span class="token number">0</span> <span class="token keyword">AS</span> <span class="token keyword">Level</span>
    <span class="token keyword">FROM</span> Employee e
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Department d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>DepartmentID <span class="token operator">=</span> d<span class="token punctuation">.</span>DepartmentID
    <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>ManagerID <span class="token operator">IS</span> <span class="token boolean">NULL</span>
    
    <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
    
    <span class="token comment">-- 递归查询</span>
    <span class="token keyword">SELECT</span>
        e<span class="token punctuation">.</span>EmployeeID<span class="token punctuation">,</span>
        e<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> EmployeeName<span class="token punctuation">,</span> 
        d<span class="token punctuation">.</span>DepartmentName<span class="token punctuation">,</span>
        e<span class="token punctuation">.</span>ManagerID<span class="token punctuation">,</span>
        CAST<span class="token punctuation">(</span>m<span class="token punctuation">.</span>ManagerNames <span class="token operator">+</span> <span class="token string">' > '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        m<span class="token punctuation">.</span><span class="token keyword">Level</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">FROM</span> Employee e
    <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> ManagerCTE m <span class="token keyword">ON</span> e<span class="token punctuation">.</span>ManagerID <span class="token operator">=</span> m<span class="token punctuation">.</span>EmployeeID
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Department d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>DepartmentID <span class="token operator">=</span> d<span class="token punctuation">.</span>DepartmentID
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ManagerCTE<span class="token punctuation">;</span>
<span class="token comment">-- 结果</span>
EmployeeID <span class="token operator">|</span> EmployeeName <span class="token operator">|</span> DepartmentName <span class="token operator">|</span> ManagerID <span class="token operator">|</span> ManagerNames     <span class="token operator">|</span> <span class="token keyword">Level</span>
<span class="token comment">-----------+---------------+----------------+-----------+------------------+-------</span>
         <span class="token number">1</span> <span class="token operator">|</span> Mike         <span class="token operator">|</span> Sales          <span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span> M                <span class="token operator">|</span>     <span class="token number">0</span>
         <span class="token number">2</span> <span class="token operator">|</span> Jen          <span class="token operator">|</span> Sales          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span> M <span class="token operator">></span> Jen          <span class="token operator">|</span>     <span class="token number">1</span>
         <span class="token number">3</span> <span class="token operator">|</span> Rob          <span class="token operator">|</span> Marketing      <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span> M <span class="token operator">></span> Rob          <span class="token operator">|</span>     <span class="token number">1</span>  
         <span class="token number">4</span> <span class="token operator">|</span> Angie        <span class="token operator">|</span> Marketing      <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span> M <span class="token operator">></span> Rob <span class="token operator">></span> Angie  <span class="token operator">|</span>     <span class="token number">2</span>
         <span class="token number">5</span> <span class="token operator">|</span> Dina         <span class="token operator">|</span> Marketing      <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span> M <span class="token operator">></span> Rob <span class="token operator">></span> Dina   <span class="token operator">|</span>     <span class="token number">2</span>
         <span class="token number">6</span> <span class="token operator">|</span> Jack         <span class="token operator">|</span> IT             <span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span> J                <span class="token operator">|</span>     <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="转置操作"><a href="#转置操作" class="headerlink" title="转置操作"></a>转置操作</h2><blockquote>
<p>SQL的转置操作通常指的是PIVOT和UNPIVOT操作,用于在行和列之间转换数据。</p>
</blockquote>
<h2 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h2><blockquote>
<p>窗口函数，也叫OLAP函数（Online Anallytical Processing，联机分析处理），可以对数据库数据进行实时分析处理。</p>
</blockquote>
<p><strong>窗口函数的分类</strong></p>
<ul>
<li><p><strong>聚合函数</strong>: <code>count()、sum()、AVG()、MAX()、MIN（）</code></p>
</li>
<li><p><strong>排名函数</strong>:<code>RANK() OVER (PARTITION BY 分区内容 ORDER BY 排序内容 DESC) as rank</code></p>
</li>
<li><p><strong>值函数</strong>：<code>FIRST()、LAST_VALUE、NTH_VALUE()用于从窗口分区中获取第一个、最后一个或第N个值 </code></p>
</li>
<li><p><strong>偏移函数</strong>：<code>LAG():获取当前行的前n行的值,即往前偏移,LEAD():取当前行的后n行的值,即往后偏移</code></p>
</li>
</ul>
<h2 id="CTE（通用表表达式）"><a href="#CTE（通用表表达式）" class="headerlink" title="CTE（通用表表达式）"></a>CTE（通用表表达式）</h2><blockquote>
<p>CTE 或公用表表达式是一种临时结果集，在单个 SQL 语句的执行范围内定义。它们的作用就像单个查询的临时视图，通常用于简化子查询并提高可读性。</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WITH</span> CTE_Name <span class="token keyword">AS</span>
<span class="token punctuation">(</span>
    <span class="token keyword">SQL</span> Query
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> CTE_Name
<span class="token comment">-- 举例：</span>
<span class="token keyword">WITH</span> cte_authors <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name 
  <span class="token keyword">FROM</span> authors
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">AS</span> book_count
<span class="token keyword">FROM</span> cte_authors a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> books b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>author_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span>name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><blockquote>
<p>动态SQL（Dynamic SQL）是指在运行时生成和执行的SQL语句，而不是在编译时确定的静态SQL语句。动态SQL允许你根据不同的条件和参数构建和执行SQL查询。</p>
</blockquote>
<h1 id="Mysql安装"><a href="#Mysql安装" class="headerlink" title="Mysql安装"></a>Mysql安装</h1><h2 id="卸载自带mysql"><a href="#卸载自带mysql" class="headerlink" title="卸载自带mysql"></a>卸载自带mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">--nodeps</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="创建mysql文件夹"><a href="#创建mysql文件夹" class="headerlink" title="创建mysql文件夹"></a>创建mysql文件夹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://repo.mysql.com/mysql84-community-release-el7.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql84-community-release-el7.rpm
yum update
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="初始化mysql"><a href="#初始化mysql" class="headerlink" title="初始化mysql"></a>初始化mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqld <span class="token parameter variable">--initialize</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="赋予mysql权限"><a href="#赋予mysql权限" class="headerlink" title="赋予mysql权限"></a>赋予mysql权限</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql:mysql  /var/lib/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="查找默认密码"><a href="#查找默认密码" class="headerlink" title="查找默认密码"></a>查找默认密码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="测试登录"><a href="#测试登录" class="headerlink" title="测试登录"></a>测试登录</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> 
<span class="token comment">#输入密码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="修改默认密码"><a href="#修改默认密码" class="headerlink" title="修改默认密码"></a>修改默认密码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">alter user <span class="token string">'root'</span>@<span class="token string">'localhost'</span> identified by <span class="token string">'123456'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> 
<span class="token comment"># 输入密码</span>
use mysql<span class="token punctuation">;</span>
update user <span class="token builtin class-name">set</span> <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">'%'</span> where user <span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span>
GRANT ALL PRIVILEGES ON *.* TO <span class="token string">'root'</span>@<span class="token string">'%'</span>WITH GRANT OPTION<span class="token punctuation">;</span>
<span class="token comment"># 查询验证</span>
<span class="token keyword">select</span> user,host from user<span class="token punctuation">;</span>
<span class="token comment">#开放3306端口号，永久生效</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">3306</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment">#重启防火墙</span>
firewall-cmd <span class="token parameter variable">--reload</span>
<span class="token comment"># 查看当前开放端口</span>
firewall-cmd --list-ports<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="卸载mysql"><a href="#卸载mysql" class="headerlink" title="卸载mysql"></a>卸载mysql</h1><h2 id="关闭Mysql"><a href="#关闭Mysql" class="headerlink" title="关闭Mysql"></a>关闭Mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="使用yum卸载安装的mysql"><a href="#使用yum卸载安装的mysql" class="headerlink" title="使用yum卸载安装的mysql"></a>使用yum卸载安装的mysql</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum remove  mysql mysql-server mysql-libs mysql-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="删除残余安装包"><a href="#删除残余安装包" class="headerlink" title="删除残余安装包"></a>删除残余安装包</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-ev</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">rpm</span> -qa<span class="token operator">|</span><span class="token function">grep</span> mysql<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="删除残余文件夹"><a href="#删除残余文件夹" class="headerlink" title="删除残余文件夹"></a>删除残余文件夹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / <span class="token parameter variable">-name</span> mysql<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="数据库补充"><a href="#数据库补充" class="headerlink" title="数据库补充"></a>数据库补充</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p> MySQL 的架构共分为两层：<strong>Server 层和存储引擎层</strong></p>
<ul>
<li><strong>Server 层负责建立连接、分析和执行 SQL</strong>。MySQL 大多数的核心功能模块都在这实现，主要包括连接器，查询缓存、解析器、预处理器、优化器、执行器等。另外，所有的内置函数（如日期、时间、数学和加密函数等）和所有跨存储引擎的功能（如存储过程、触发器、视图等。）都在 Server 层实现。</li>
<li><strong>存储引擎层负责数据的存储和提取</strong>。支持 InnoDB、MyISAM、Memory 等多个存储引擎，不同的存储引擎共用一个 Server 层。现在最常用的存储引擎是 InnoDB，从 MySQL 5.5 版本开始， InnoDB 成为了 MySQL 的默认存储引擎。我们常说的索引数据结构，就是由存储引擎层实现的，不同的存储引擎支持的索引类型也不相同，比如 InnoDB 支持索引类型是 B+树 ，且是默认使用，也就是说在数据表中创建的主键索引和二级索引默认使用的是 B+ 树索引。</li>
</ul>
<h3 id="MySQL执行流程"><a href="#MySQL执行流程" class="headerlink" title="MySQL执行流程"></a>MySQL执行流程</h3><p>有一个名为 <code>employees</code> 的表，并执行以下查询：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行流程为：</p>
<ol>
<li><strong>客户端连接</strong>：客户端连接到 MySQL 服务器并发送查询 <code>SELECT first_name, last_name FROM employees WHERE employee_id = 1;</code>。</li>
<li><strong>查询缓存（可选）</strong>：检查查询缓存，如果有返回直接返回，没有缓存则继续下一步。</li>
<li><strong>解析器</strong>：词法分析：将查询字符串分解成标记。标记：<code>SELECT</code>、<code>first_name</code>、<code>last_name</code>、<code>FROM</code>、<code>employees</code>、<code>WHERE</code>、<code>employee_id</code>、<code>=</code>、<code>1</code>。语法分析：生成解析树。解析树：表示选择 <code>first_name</code> 和 <code>last_name</code> 列，从 <code>employees</code> 表中选择，过滤条件是 <code>employee_id = 1</code>。</li>
<li><strong>预处理器</strong>：语义检查：检查 <code>employees</code> 表和 <code>employee_id</code> 列是否存在，权限是否足够。视图展开（如果有视图）。</li>
<li><strong>优化器</strong>：选择最优执行计划：选择使用 <code>employee_id</code> 列上的索引。生成执行计划：扫描 <code>employees</code> 表，使用索引查找 <code>employee_id = 1</code> 的记录。</li>
<li><strong>执行器</strong>：执行查询：根据执行计划逐步执行查询。调用存储引擎接口：读取 <code>employees</code> 表中的数据。</li>
<li><strong>存储引擎</strong>：处理数据：存储引擎（如 InnoDB）读取数据并返回给执行器。使用 B+ 树索引查找 <code>employee_id = 1</code> 的记录，返回 <code>first_name</code> 和 <code>last_name</code> 列的数据。</li>
<li><strong>返回结果</strong>：执行器将结果集返回给客户端。结果集包括查询结果：<code>first_name</code> 和 <code>last_name</code> 列的数据。</li>
</ol>
<h3 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h3><h4 id="数据存储（InnoDB存储引擎）"><a href="#数据存储（InnoDB存储引擎）" class="headerlink" title="数据存储（InnoDB存储引擎）"></a>数据存储（InnoDB存储引擎）</h4><ul>
<li>存放目录：<code>/var/lib/mysql</code></li>
<li>文件内容：<ul>
<li><code>db.opt</code>：存储当前数据库的默认字符集和字符校验规则。</li>
<li><code>表名.frm</code>：存储表结构。</li>
<li><code>表名.ibd</code>：存储表数据。</li>
</ul>
</li>
</ul>
<h4 id="InnoDB存储结构"><a href="#InnoDB存储结构" class="headerlink" title="InnoDB存储结构"></a>InnoDB存储结构</h4><img src="https://telegraph-image-2ni.pages.dev/file/ed982a598d21a6236e396.png" style="zoom:33%;">

<ul>
<li><strong>段</strong>（segment）：表空间由各个段组成，段由多个区组成。<ul>
<li><strong>索引段</strong>：存放B+树的非叶子节点的区的集合。</li>
<li><strong>数据段</strong>：存放B+树的叶子节点的区的集合。</li>
<li><strong>回滚段</strong>：存放回滚数据的区的集合。</li>
</ul>
</li>
<li><strong>区（extent）</strong>：为索引分配空间的单位，每个区为1MB，连续的64个页。</li>
<li><strong>页（page）</strong>：InnoDB读取数据库是按页读取的，默认每个页的大小为16KB。</li>
<li><strong>行（row）</strong>：数据库表中的记录按行存放，每行记录根据不同的行格式有不同的存储结构。</li>
</ul>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="全局锁（Global-Lock）"><a href="#全局锁（Global-Lock）" class="headerlink" title="全局锁（Global Lock）"></a>全局锁（Global Lock）</h3><p>全局锁会锁定整个数据库实例，通常用于全库备份和维护操作。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">FLUSH <span class="token keyword">TABLES</span> <span class="token keyword">WITH</span> <span class="token keyword">READ</span> <span class="token keyword">LOCK</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>原理：全局锁会锁定所有表，阻止任何写操作，确保在备份期间数据一致性。读操作仍然允许。</p>
<p>场景：全局锁适用于需要确保整个数据库在某一时刻数据一致性的操作，但会阻塞所有写操作，因此不适合长时间使用。</p>
<h3 id="表级锁（Table-level-Locks）"><a href="#表级锁（Table-level-Locks）" class="headerlink" title="表级锁（Table-level Locks）"></a>表级锁（Table-level Locks）</h3><p><strong>表锁</strong>：锁定整个表，适用于需要对整个表进行大规模操作的情况。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> table_name <span class="token keyword">READ</span><span class="token punctuation">;</span>  <span class="token comment">-- 读锁</span>
<span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span> table_name <span class="token keyword">WRITE</span><span class="token punctuation">;</span> <span class="token comment">-- 写锁</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span> <span class="token comment">-- 解锁</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>意向锁（Intention Lock）</strong>：自动管理，无需显式使用。</p>
<p>原理：表锁会锁定整个表，阻止其他事务对该表的读写操作。意向锁用于表明事务即将对表中的某些行加锁，分为意向共享锁（IS）和意向排他锁（IX）。</p>
<p>场景：表级锁适用于需要对整个表进行大规模操作的情况，但会阻塞其他事务对该表的操作，因此不适合高并发环境。</p>
<h3 id="页级锁（Page-level-Locks）"><a href="#页级锁（Page-level-Locks）" class="headerlink" title="页级锁（Page-level Locks）"></a>页级锁（Page-level Locks）</h3><p>页级锁锁定数据页，介于表级锁和行级锁之间，较少使用。MySQL的BDB存储引擎支持页级锁，但InnoDB和MyISAM不支持。</p>
<p>原理：页级锁锁定的是数据页而不是单行或整表，适用于需要对多个连续行进行操作的情况。</p>
<p>场景：页级锁介于表级锁和行级锁之间，提供了较好的并发性和性能，但由于MySQL主流存储引擎不支持，实际应用较少。</p>
<h3 id="行级锁（Row-level-Locks）"><a href="#行级锁（Row-level-Locks）" class="headerlink" title="行级锁（Row-level Locks）"></a>行级锁（Row-level Locks）</h3><p>行级锁是InnoDB的默认锁机制，适用于高并发的场景。</p>
<p>共享锁（Shared Lock, S锁）：允许多个事务读取同一行，但不允许修改。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span> condition <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>排他锁（Exclusive Lock, X锁）：允许一个事务读取和修改一行，其他事务不能读取或修改。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span> condition <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>原理：行级锁通过B+树索引实现。每个索引记录都有一个锁定信息，InnoDB通过这些信息来管理锁的状态。行级锁包括记录锁（Record Lock）、间隙锁（Gap Lock）和临键锁（Next-Key Lock）。</p>
<p>场景：行级锁提供了最高的并发性，适用于高并发环境。通过锁定特定的行而不是整个表或页，行级锁能够最大限度地减少锁冲突。</p>
<h3 id="生产环境中的实际应用"><a href="#生产环境中的实际应用" class="headerlink" title="生产环境中的实际应用"></a>生产环境中的实际应用</h3><ul>
<li>全局锁用于全库备份</li>
<li>表级锁用于批量更新</li>
<li>行级锁用于并发控制</li>
</ul>
<h3 id="查看锁信息"><a href="#查看锁信息" class="headerlink" title="查看锁信息"></a>查看锁信息</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">ENGINE</span> <span class="token keyword">INNODB</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><p>分库分表是为了应对单库单表在面对大数据量、高并发时的性能瓶颈和可扩展性问题，通过将数据拆分到多个数据库或多个表中来实现数据存储和访问的分散。</p>
<h3 id="设计方案"><a href="#设计方案" class="headerlink" title="设计方案"></a>设计方案</h3><p><strong>垂直分库</strong>：按业务模块划分，将不同业务模块的数据存储到不同的数据库中。</p>
<p><strong>水平分库</strong>：将同一业务模块的数据按某种规则（如用户ID）拆分到多个数据库中。</p>
<p><strong>垂直分表</strong>：将一个表中不相关的列拆分到多个表中。</p>
<p><strong>水平分表</strong>：将一个表的数据按某种规则（如时间、ID）拆分到多个表中。</p>
<h3 id="分表算法"><a href="#分表算法" class="headerlink" title="分表算法"></a>分表算法</h3><ol>
<li><strong>范围分表（Range-based Sharding）</strong>：根据某个字段的值范围将数据分到不同的表中。<ul>
<li><strong>优点</strong>：实现简单，查询特定范围数据时效率较高。</li>
<li><strong>缺点</strong>：数据分布不均衡时，某些表的数据量可能会过大，影响性能。</li>
</ul>
</li>
<li><strong>哈希分表（Hash-based Sharding）</strong>：根据某个字段的哈希值将数据分配到不同的表中。<ul>
<li><strong>优点</strong>：数据分布均匀，避免了单表过大问题。</li>
<li><strong>缺点</strong>：查询效率受限于哈希算法，跨表查询复杂。</li>
</ul>
</li>
<li><strong>日期分表（Date-based Sharding）</strong>：根据日期将数据分到不同的表中，常用于按时间分区的业务场景。<ul>
<li><strong>优点</strong>：便于历史数据归档，查询指定时间范围的数据较快。</li>
<li><strong>缺点</strong>：需要定期维护新的分区表，历史表的管理和查询复杂度较高。</li>
</ul>
</li>
</ol>
<h3 id="全局唯一ID生成算法"><a href="#全局唯一ID生成算法" class="headerlink" title="全局唯一ID生成算法"></a>全局唯一ID生成算法</h3><ol>
<li>数据库自增键：利用数据库的自增主键生成唯一ID通过设置不同的自增初始值和步长来实现分布式环境下的唯一性</li>
</ol>
<p><strong>优点</strong>: 实现简单，利用数据库现有功能，趋势递增，适合需要有序ID的场景</p>
<p><strong>缺点</strong>: 依赖数据库，数据库故障会导致服务不可用，扩展性较差，需要重新设置自增初始值和步长</p>
<ol start="2">
<li>UUID : 通过结合机器MAC地址、时间戳、随机数等信息生成全局唯一的128位ID</li>
</ol>
<p><strong>优点</strong>: 生成速度快，无需访问数据库，不依赖于中心化的服务</p>
<p><strong>缺点</strong>: 生成的ID长度较长，不利于存储和传输，部分算法会泄露MAC地址信息，存在安全隐患</p>
<ol start="3">
<li>雪花算法：将64位ID分为4部分:1位符号位、41位时间戳、10位机器ID、12位序列号，通过时间戳、机器ID和序列号的组合生成全局唯一ID</li>
</ol>
<p><strong>优点</strong>: 生成速度快，支持高并发，趋势递增，适合需要有序ID的场景，不依赖于中心化的服务</p>
<p><strong>缺点</strong>: 需要保证机器时钟单调递增，存在时钟回拨问题，机器ID需要提前分配，不太灵活</p>
<ol start="4">
<li>薄雾算法：通过简单的位运算和异或操作生成全局唯一ID，不依赖时间戳、机器ID等信息</li>
</ol>
<p><strong>优点</strong>: 生成速度极快，性能远超雪花算法，代码简单，易于实现和维护</p>
<p><strong>缺点</strong>: 生成的ID可能会重复，需要依赖其他机制保证唯一性</p>
<h3 id="分库分表工具"><a href="#分库分表工具" class="headerlink" title="分库分表工具"></a>分库分表工具</h3><p>常见的分库分表工具包括：</p>
<ol>
<li><strong>Mycat</strong>：一个开源的分库分表中间件，支持读写分离、分库分表等功能。</li>
<li><strong>ShardingSphere</strong>：Apache ShardingSphere 是一个开源分布式数据库中间件，包括分库分表、数据加密、读写分离等功能。</li>
<li><strong>Vitess</strong>：一个用于大规模分布式数据库的解决方案，支持水平拆分、故障转移等功能。</li>
</ol>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a><strong>实现原理</strong></h3><p>分库分表的核心是通过合理的分区策略将数据分散到不同的数据库和表中，主要实现方式包括：</p>
<ul>
<li>使用中间件如ShardingSphere、MyCAT等，实现数据分片、路由和聚合查询。</li>
<li>自定义分片策略，将数据按特定规则分配到不同的数据库和表中。</li>
</ul>
<h3 id="配置代码"><a href="#配置代码" class="headerlink" title="配置代码"></a>配置代码</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sharding</span><span class="token punctuation">:</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_$<span class="token punctuation">&#123;</span>0..1<span class="token punctuation">&#125;</span>.user_$<span class="token punctuation">&#123;</span>0..1<span class="token punctuation">&#125;</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">inline</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">algorithmExpression</span><span class="token punctuation">:</span> user_$<span class="token punctuation">&#123;</span>user_id % 2<span class="token punctuation">&#125;</span>
      <span class="token key atrule">keyGenerator</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
        <span class="token key atrule">column</span><span class="token punctuation">:</span> user_id
  <span class="token key atrule">defaultDatabaseStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">inline</span><span class="token punctuation">:</span>
      <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
      <span class="token key atrule">algorithmExpression</span><span class="token punctuation">:</span> ds_$<span class="token punctuation">&#123;</span>user_id % 2<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>主从复制（Master-Slave Replication）是指将主数据库的数据实时复制到从数据库，从数据库可以作为备份，也可以用于读写分离，提高读性能。</p>
<img src="https://telegraph-image-2ni.pages.dev/file/b78aebc06adebbd52b923.png" style="zoom:40%;">



<h3 id="设计方案-1"><a href="#设计方案-1" class="headerlink" title="设计方案"></a>设计方案</h3><p><strong>异步复制</strong>：主数据库执行写操作后立即返回，从数据库异步复制数据。</p>
<p><strong>同步复制</strong>：主数据库在确认从数据库收到数据后再返回。</p>
<p><strong>半同步复制</strong>：介于异步和同步之间，主数据库等待至少一个从数据库确认数据收到。</p>
<h3 id="实现原理-1"><a href="#实现原理-1" class="headerlink" title="实现原理"></a><strong>实现原理</strong></h3><p>主数据库的变更通过二进制日志（binlog）记录，从数据库读取binlog并执行相同的操作。复制流程主要包括：</p>
<ol>
<li>主数据库将变更写入binlog。</li>
<li>从数据库通过I&#x2F;O线程读取主数据库的binlog并写入中继日志（relay log）。</li>
<li>从数据库通过SQL线程读取中继日志并执行相应操作。</li>
</ol>
<h3 id="配置代码-1"><a href="#配置代码-1" class="headerlink" title="配置代码"></a>配置代码</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- 在主库上配置
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
server-id<span class="token operator">=</span><span class="token number">1</span>
log-bin<span class="token operator">=</span>mysql-bin

-- 在从库上配置
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
server-id<span class="token operator">=</span><span class="token number">2</span>
relay-log<span class="token operator">=</span>relay-bin
log-bin<span class="token operator">=</span>mysql-bin

-- 在从库上执行
CHANGE MASTER TO
<span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">'主库IP'</span>,
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">'复制用户'</span>,
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">'复制用户密码'</span>,
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">'mysql-bin.000001'</span>,
<span class="token assign-left variable">MASTER_LOG_POS</span><span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

START SLAVE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h2><p>数据库的备份与恢复是指定期对数据库进行备份，以便在数据丢失或损坏时可以恢复到备份时的状态。</p>
<h3 id="全量备份"><a href="#全量备份" class="headerlink" title="全量备份"></a>全量备份</h3><h4 id="设计方案-2"><a href="#设计方案-2" class="headerlink" title="设计方案"></a>设计方案</h4><p><strong>逻辑备份</strong>：如使用mysqldump导出SQL脚本。</p>
<h4 id="实现原理-2"><a href="#实现原理-2" class="headerlink" title="实现原理"></a>实现原理</h4><p><strong>逻辑备份</strong>：通过导出数据库的SQL语句实现，可以导出表结构和数据。</p>
<h4 id="配置代码-2"><a href="#配置代码-2" class="headerlink" title="配置代码"></a>配置代码</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#备份</span>
mysqldump <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> database_name <span class="token operator">></span> backup.sql
<span class="token comment">#恢复</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> database_name <span class="token operator">&lt;</span> backup.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="增量备份"><a href="#增量备份" class="headerlink" title="增量备份"></a>增量备份</h3><p>增量备份是对自上次全量或增量备份后发生变更的数据进行备份。增量备份可以减少备份时间和存储空间，适合大规模数据的备份策略。</p>
<h4 id="实现原理-3"><a href="#实现原理-3" class="headerlink" title="实现原理"></a>实现原理</h4><p><strong>逻辑备份</strong>：基于二进制日志（binlog）的增量备份通过备份binlog文件实现。</p>
<h4 id="配置代码-3"><a href="#配置代码-3" class="headerlink" title="配置代码"></a>配置代码</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#在 my.cnf 文件中添加以下配置：</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment"># 备份命令</span>
mysqlbinlog mysql-bin.000001 <span class="token operator">></span> incremental_backup.sql
<span class="token comment"># 恢复命令</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> incremental_backup.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Orion Potter
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://orionpotter.space/post/SQL%20Tutorial.html" title="Sql Tutourial">https://orionpotter.space/post/SQL%20Tutorial.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/SQL/" rel="tag"># SQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html" rel="next" title="负载均衡">
                <i class="fa fa-chevron-left"></i> 负载均衡
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/Git%20Tutorial.html" rel="prev" title="git tutorial">
                git tutorial <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">54</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/OrionPotter" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/imlzgg" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Sql%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">Sql介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.1.</span> <span class="nav-text">关系型数据库是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDBMS%E7%9A%84%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9"><span class="nav-number">1.2.</span> <span class="nav-text">RDBMS的优点和缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">1.2.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">1.2.2.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E5%92%8CNoSql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.</span> <span class="nav-text">SQL和NoSql数据库的区别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.3.1.</span> <span class="nav-text">Sql数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NoSQL-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.3.2.</span> <span class="nav-text">NoSQL 数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.3.3.</span> <span class="nav-text">数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="nav-number">1.3.4.</span> <span class="nav-text">查询语言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%80%A7"><span class="nav-number">1.3.5.</span> <span class="nav-text">扩展性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%92%8C%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">1.3.6.</span> <span class="nav-text">事务和一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.3.7.</span> <span class="nav-text">适用场景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E5%9F%BA%E7%A1%80"><span class="nav-number">2.</span> <span class="nav-text">SQL基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">2.1.</span> <span class="nav-text">关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.2.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">2.3.</span> <span class="nav-text">操作符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.3.1.</span> <span class="nav-text">算术运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83-%E5%85%B3%E7%B3%BB-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.3.2.</span> <span class="nav-text">比较(关系)运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.3.3.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.3.4.</span> <span class="nav-text">位运算符</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80"><span class="nav-number">3.</span> <span class="nav-text">数据定义语言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80"><span class="nav-number">4.</span> <span class="nav-text">数据操作语言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.</span> <span class="nav-text">聚合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-BY%E5%92%8CHAVING%E5%AD%90%E5%8F%A5"><span class="nav-number">5.2.</span> <span class="nav-text">GROUP BY和HAVING子句</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.</span> <span class="nav-text">数据约束</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NOT-NULL-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.1.</span> <span class="nav-text">NOT NULL 约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UNIQUE-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.2.</span> <span class="nav-text">UNIQUE 约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PRIMARY-KEY-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.3.</span> <span class="nav-text">PRIMARY KEY 约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.4.</span> <span class="nav-text">外键约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CHECK-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.5.</span> <span class="nav-text">CHECK 约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DEFAULT-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.6.</span> <span class="nav-text">DEFAULT 约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#INDEX-%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.7.</span> <span class="nav-text">INDEX 约束</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.</span> <span class="nav-text">连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.1.</span> <span class="nav-text">内连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A6%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.2.</span> <span class="nav-text">左连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%B3%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.3.</span> <span class="nav-text">右连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.4.</span> <span class="nav-text">全外连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.5.</span> <span class="nav-text">自连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.6.</span> <span class="nav-text">交叉连接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">8.</span> <span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="nav-number">8.1.</span> <span class="nav-text">标量子查询（单行子查询）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%A4%9A%E8%A1%8C%E5%8D%95%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="nav-number">8.2.</span> <span class="nav-text">列子查询（多行单列子查询）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="nav-number">8.3.</span> <span class="nav-text">行子查询（多行多列子查询）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="nav-number">8.4.</span> <span class="nav-text">相关子查询（相关子查询）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E6%B4%BE%E7%94%9F%E8%A1%A8%E6%88%96%E5%86%85%E8%81%94%E8%A7%86%E5%9B%BE%EF%BC%89"><span class="nav-number">8.5.</span> <span class="nav-text">表子查询（派生表或内联视图）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EXISTS%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">8.6.</span> <span class="nav-text">EXISTS子查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7-SQL-%E5%87%BD%E6%95%B0"><span class="nav-number">9.</span> <span class="nav-text">高级 SQL 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="nav-number">9.1.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">9.2.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="nav-number">9.3.</span> <span class="nav-text">条件函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="nav-number">9.4.</span> <span class="nav-text">时间函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DATE"><span class="nav-number">9.4.1.</span> <span class="nav-text">DATE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TIME"><span class="nav-number">9.4.2.</span> <span class="nav-text">TIME</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DATEPART"><span class="nav-number">9.4.3.</span> <span class="nav-text">DATEPART</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DATEADD"><span class="nav-number">9.4.4.</span> <span class="nav-text">DATEADD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TIMESTAMP"><span class="nav-number">9.4.5.</span> <span class="nav-text">TIMESTAMP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">10.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">11.</span> <span class="nav-text">触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">11.1.</span> <span class="nav-text">触发器的类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">11.2.</span> <span class="nav-text">触发器使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7%E5%92%8C%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">11.2.1.</span> <span class="nav-text">数据完整性和一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%BB%E5%8A%A1"><span class="nav-number">11.2.2.</span> <span class="nav-text">自动化任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E5%92%8C%E6%97%A5%E5%BF%97"><span class="nav-number">11.2.3.</span> <span class="nav-text">审计和日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91"><span class="nav-number">11.2.4.</span> <span class="nav-text">复杂的业务逻辑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">11.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">12.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">12.1.</span> <span class="nav-text">基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95"><span class="nav-number">12.1.1.</span> <span class="nav-text">什么是索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">12.1.2.</span> <span class="nav-text">索引的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">12.1.3.</span> <span class="nav-text">索引的数据结构和工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#B-Tree%E7%B4%A2%E5%BC%95"><span class="nav-number">12.1.3.1.</span> <span class="nav-text">B-Tree索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hash%E7%B4%A2%E5%BC%95"><span class="nav-number">12.1.3.2.</span> <span class="nav-text">Hash索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BitMap%E7%B4%A2%E5%BC%95"><span class="nav-number">12.1.3.3.</span> <span class="nav-text">BitMap索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="nav-number">12.1.3.4.</span> <span class="nav-text">全文索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">12.1.4.</span> <span class="nav-text">索引的分类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="nav-number">12.2.</span> <span class="nav-text">索引创建与管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">12.2.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-number">12.2.2.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">12.2.3.</span> <span class="nav-text">重建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="nav-number">12.2.4.</span> <span class="nav-text">查询索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">12.3.</span> <span class="nav-text">索引的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="nav-number">12.3.1.</span> <span class="nav-text">查询优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%80%82%E5%BD%93%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">12.3.1.1.</span> <span class="nav-text">创建适当的索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="nav-number">12.3.1.2.</span> <span class="nav-text">使用覆盖索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84"><span class="nav-number">12.3.1.3.</span> <span class="nav-text">利用索引优化排序和分组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">12.3.1.4.</span> <span class="nav-text">查询优化器的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">12.3.2.</span> <span class="nav-text">索引的索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E7%BB%8F%E5%B8%B8%E7%94%A8%E4%BA%8E%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%88%97"><span class="nav-number">12.3.2.1.</span> <span class="nav-text">选择经常用于查询条件的列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E7%BB%8F%E5%B8%B8%E7%94%A8%E4%BA%8E%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84%E7%9A%84%E5%88%97"><span class="nav-number">12.3.2.2.</span> <span class="nav-text">选择经常用于排序和分组的列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E5%9F%BA%E6%95%B0%E8%BE%83%E9%AB%98%E7%9A%84%E5%88%97"><span class="nav-number">12.3.2.3.</span> <span class="nav-text">选择基数较高的列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E9%80%82%E5%BD%93%E7%9A%84%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="nav-number">12.3.2.4.</span> <span class="nav-text">选择适当的索引类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="nav-number">12.3.3.</span> <span class="nav-text">索引的缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="nav-number">12.4.</span> <span class="nav-text">索引性能调优</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="nav-number">12.4.1.</span> <span class="nav-text">执行计划</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%88EXPLAIN%EF%BC%89"><span class="nav-number">12.4.1.1.</span> <span class="nav-text">什么是执行计划（EXPLAIN）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXPLAIN%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">12.4.1.2.</span> <span class="nav-text">EXPLAIN的基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E7%9A%84%E8%BE%93%E5%87%BA"><span class="nav-number">12.4.1.3.</span> <span class="nav-text">解释执行计划的输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84Extra%E5%88%97%E5%80%BC%E5%8F%8A%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">12.4.1.4.</span> <span class="nav-text">常见的Extra列值及优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-where"><span class="nav-number">12.4.1.4.1.</span> <span class="nav-text">Using where</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-index"><span class="nav-number">12.4.1.4.2.</span> <span class="nav-text">Using index</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-temporary"><span class="nav-number">12.4.1.4.3.</span> <span class="nav-text">Using temporary</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-filesort"><span class="nav-number">12.4.1.4.4.</span> <span class="nav-text">Using filesort</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-join-buffer"><span class="nav-number">12.4.1.4.5.</span> <span class="nav-text">Using join buffer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-index-condition"><span class="nav-number">12.4.1.4.6.</span> <span class="nav-text">Using index condition</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-intersect-union"><span class="nav-number">12.4.1.4.7.</span> <span class="nav-text">Using intersect&#x2F;union</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="nav-number">12.4.2.</span> <span class="nav-text">覆盖索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%90%88%E5%B9%B6"><span class="nav-number">12.4.3.</span> <span class="nav-text">索引合并</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF"><span class="nav-number">12.5.</span> <span class="nav-text">索引失效场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95"><span class="nav-number">12.6.</span> <span class="nav-text">聚簇索引和非聚簇索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%EF%BC%88Clustered-index%EF%BC%89"><span class="nav-number">12.6.1.</span> <span class="nav-text">聚簇索引（Clustered index）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">12.6.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">12.6.1.2.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-1"><span class="nav-number">12.6.1.3.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="nav-number">12.6.1.4.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%EF%BC%88Non-Clustered-Index%EF%BC%89"><span class="nav-number">12.6.2.</span> <span class="nav-text">非聚簇索引（Non-Clustered Index）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="nav-number">12.6.2.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E7%82%B9-1"><span class="nav-number">12.6.2.2.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-2"><span class="nav-number">12.6.2.3.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="nav-number">12.6.2.4.</span> <span class="nav-text">缺点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA"><span class="nav-number">12.7.</span> <span class="nav-text">数据分区</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">12.7.1.</span> <span class="nav-text">数据分区的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-number">12.7.2.</span> <span class="nav-text">数据分区的优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="nav-number">12.7.3.</span> <span class="nav-text">语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA%E5%A6%82%E4%BD%95%E5%88%86%E5%B8%83%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87"><span class="nav-number">12.8.</span> <span class="nav-text">mysql数据分区如何分布在不同的存储设备</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">13.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1"><span class="nav-number">13.1.</span> <span class="nav-text">如何使用事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E5%92%8C%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="nav-number">13.2.</span> <span class="nav-text">如何保证数据的完整性和可靠性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%B9%B6%E5%8F%91%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E8%AF%BB%E5%8F%96%E9%97%AE%E9%A2%98"><span class="nav-number">13.3.</span> <span class="nav-text">事务并发时遇到的读取问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">13.4.</span> <span class="nav-text">事务隔离级别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0"><span class="nav-number">14.</span> <span class="nav-text">存储过程和函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">14.1.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-number">14.1.1.</span> <span class="nav-text">存储过程的优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="nav-number">14.1.2.</span> <span class="nav-text">存储过程如何使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">14.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E8%A1%A8%E5%80%BC%E5%87%BD%E6%95%B0%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">14.3.</span> <span class="nav-text">存储过程和表值函数的区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">15.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="nav-number">15.1.</span> <span class="nav-text">查询优化技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="nav-number">15.1.1.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E9%80%89%E6%8B%A9"><span class="nav-number">15.1.2.</span> <span class="nav-text">避免选择*</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="nav-number">15.1.3.</span> <span class="nav-text">连接查询优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Limit"><span class="nav-number">15.1.4.</span> <span class="nav-text">使用Limit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%9C%A8%E5%BC%80%E5%A4%B4%E4%BD%BF%E7%94%A8%E5%B8%A6%E9%80%9A%E9%85%8D%E7%AC%A6%E7%9A%84-LIKE-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">15.1.5.</span> <span class="nav-text">避免在开头使用带通配符的 LIKE 运算符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF"><span class="nav-number">15.2.</span> <span class="nav-text">查询分析技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E8%AE%A1%E5%88%92"><span class="nav-number">15.2.1.</span> <span class="nav-text">解释计划</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="nav-number">15.2.2.</span> <span class="nav-text">合理使用索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7SQL"><span class="nav-number">16.</span> <span class="nav-text">高级SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="nav-number">16.1.</span> <span class="nav-text">递归查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E7%BD%AE%E6%93%8D%E4%BD%9C"><span class="nav-number">16.2.</span> <span class="nav-text">转置操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-number">16.3.</span> <span class="nav-text">窗口函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CTE%EF%BC%88%E9%80%9A%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%89"><span class="nav-number">16.4.</span> <span class="nav-text">CTE（通用表表达式）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81SQL"><span class="nav-number">16.5.</span> <span class="nav-text">动态SQL</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql%E5%AE%89%E8%A3%85"><span class="nav-number">17.</span> <span class="nav-text">Mysql安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD%E8%87%AA%E5%B8%A6mysql"><span class="nav-number">17.1.</span> <span class="nav-text">卸载自带mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAmysql%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">17.2.</span> <span class="nav-text">创建mysql文件夹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Mysql"><span class="nav-number">17.3.</span> <span class="nav-text">安装Mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96mysql"><span class="nav-number">17.4.</span> <span class="nav-text">初始化mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%8B%E4%BA%88mysql%E6%9D%83%E9%99%90"><span class="nav-number">17.5.</span> <span class="nav-text">赋予mysql权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8mysql"><span class="nav-number">17.6.</span> <span class="nav-text">启动mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81"><span class="nav-number">17.7.</span> <span class="nav-text">查找默认密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%99%BB%E5%BD%95"><span class="nav-number">17.8.</span> <span class="nav-text">测试登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81"><span class="nav-number">17.9.</span> <span class="nav-text">修改默认密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95"><span class="nav-number">17.10.</span> <span class="nav-text">远程登录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BDmysql"><span class="nav-number">18.</span> <span class="nav-text">卸载mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%ADMysql"><span class="nav-number">18.1.</span> <span class="nav-text">关闭Mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8yum%E5%8D%B8%E8%BD%BD%E5%AE%89%E8%A3%85%E7%9A%84mysql"><span class="nav-number">18.2.</span> <span class="nav-text">使用yum卸载安装的mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%AE%8B%E4%BD%99%E5%AE%89%E8%A3%85%E5%8C%85"><span class="nav-number">18.3.</span> <span class="nav-text">删除残余安装包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%AE%8B%E4%BD%99%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">18.4.</span> <span class="nav-text">删除残余文件夹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A5%E5%85%85"><span class="nav-number">19.</span> <span class="nav-text">数据库补充</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">19.1.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">19.1.1.</span> <span class="nav-text">MySQL执行流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">19.1.2.</span> <span class="nav-text">存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%EF%BC%88InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%EF%BC%89"><span class="nav-number">19.1.2.1.</span> <span class="nav-text">数据存储（InnoDB存储引擎）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="nav-number">19.1.2.2.</span> <span class="nav-text">InnoDB存储结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81"><span class="nav-number">19.2.</span> <span class="nav-text">锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%94%81%EF%BC%88Global-Lock%EF%BC%89"><span class="nav-number">19.2.1.</span> <span class="nav-text">全局锁（Global Lock）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81%EF%BC%88Table-level-Locks%EF%BC%89"><span class="nav-number">19.2.2.</span> <span class="nav-text">表级锁（Table-level Locks）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B5%E7%BA%A7%E9%94%81%EF%BC%88Page-level-Locks%EF%BC%89"><span class="nav-number">19.2.3.</span> <span class="nav-text">页级锁（Page-level Locks）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81%EF%BC%88Row-level-Locks%EF%BC%89"><span class="nav-number">19.2.4.</span> <span class="nav-text">行级锁（Row-level Locks）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="nav-number">19.2.5.</span> <span class="nav-text">生产环境中的实际应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%94%81%E4%BF%A1%E6%81%AF"><span class="nav-number">19.2.6.</span> <span class="nav-text">查看锁信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="nav-number">19.3.</span> <span class="nav-text">分库分表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="nav-number">19.3.1.</span> <span class="nav-text">设计方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E8%A1%A8%E7%AE%97%E6%B3%95"><span class="nav-number">19.3.2.</span> <span class="nav-text">分表算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80ID%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95"><span class="nav-number">19.3.3.</span> <span class="nav-text">全局唯一ID生成算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">19.3.4.</span> <span class="nav-text">分库分表工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">19.3.5.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81"><span class="nav-number">19.3.6.</span> <span class="nav-text">配置代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">19.4.</span> <span class="nav-text">主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88-1"><span class="nav-number">19.4.1.</span> <span class="nav-text">设计方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-1"><span class="nav-number">19.4.2.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81-1"><span class="nav-number">19.4.3.</span> <span class="nav-text">配置代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="nav-number">19.5.</span> <span class="nav-text">备份与恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD"><span class="nav-number">19.5.1.</span> <span class="nav-text">全量备份</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88-2"><span class="nav-number">19.5.1.1.</span> <span class="nav-text">设计方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-2"><span class="nav-number">19.5.1.2.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81-2"><span class="nav-number">19.5.1.3.</span> <span class="nav-text">配置代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD"><span class="nav-number">19.5.2.</span> <span class="nav-text">增量备份</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3"><span class="nav-number">19.5.2.1.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81-3"><span class="nav-number">19.5.2.2.</span> <span class="nav-text">配置代码</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Orion Potter</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
