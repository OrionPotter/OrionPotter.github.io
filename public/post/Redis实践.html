<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/OrionPotter.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/OrionPotter.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="redis," />










<meta name="description" content="基础概念Redis介绍 Redis（Remote Dictionary Server）是一个开源的内存数据结构存储系统，广泛用于缓存、消息队列、实时分析等场景。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合、位图、HyperLogLog、地理空间和流。  优点 高性能：Redis将数据存储在内存中，读写速度非常快，适合高并发场景。 丰富的数据结构：支持多种数据结构，能够满足各种复杂的数据">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis实践">
<meta property="og:url" content="https://orionpotter.icu/post/Redis%E5%AE%9E%E8%B7%B5.html">
<meta property="og:site_name" content="Orion Potter&#39;s 个人博客">
<meta property="og:description" content="基础概念Redis介绍 Redis（Remote Dictionary Server）是一个开源的内存数据结构存储系统，广泛用于缓存、消息队列、实时分析等场景。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合、位图、HyperLogLog、地理空间和流。  优点 高性能：Redis将数据存储在内存中，读写速度非常快，适合高并发场景。 丰富的数据结构：支持多种数据结构，能够满足各种复杂的数据">
<meta property="og:locale">
<meta property="og:image" content="https://telegraph-image-2ni.pages.dev/file/b72d32e756849d1c331b4.jpg">
<meta property="article:published_time" content="2025-04-04T08:48:53.527Z">
<meta property="article:modified_time" content="2025-04-04T08:48:53.527Z">
<meta property="article:author" content="Orion Potter">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://telegraph-image-2ni.pages.dev/file/b72d32e756849d1c331b4.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://orionpotter.icu/post/Redis实践.html"/>





  <title>Redis实践 | Orion Potter's 个人博客</title>
  








<meta name="generator" content="Hexo 6.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Orion Potter's 个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">持续学习,持续进步</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-folder"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://orionpotter.icu/post/Redis%E5%AE%9E%E8%B7%B5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orion Potter's 个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Redis实践</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-04-04T16:48:53+08:00">
                2025-04-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-04-04T16:48:53+08:00">
                2025-04-04
              </time>
            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13.8k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  54
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><h2 id="Redis介绍"><a href="#Redis介绍" class="headerlink" title="Redis介绍"></a>Redis介绍</h2><blockquote>
<p>Redis（Remote Dictionary Server）是一个开源的内存数据结构存储系统，广泛用于缓存、消息队列、实时分析等场景。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合、位图、HyperLogLog、地理空间和流。</p>
</blockquote>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li><strong>高性能</strong>：Redis将数据存储在内存中，读写速度非常快，适合高并发场景。</li>
<li><strong>丰富的数据结构</strong>：支持多种数据结构，能够满足各种复杂的数据操作需求。</li>
<li><strong>持久化</strong>：支持RDB和AOF两种持久化方式，保证数据的可靠性。</li>
<li><strong>高可用性</strong>：支持主从复制、哨兵模式和集群模式，能够实现高可用性和数据冗余。</li>
<li><strong>简单易用</strong>：提供了丰富的命令和客户端库，开发者可以方便地进行操作。</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li><strong>内存消耗大</strong>：由于数据存储在内存中，内存消耗较大，存储大量数据时成本较高。</li>
<li><strong>持久化性能影响</strong>：虽然支持持久化，但在高并发写入场景下，持久化操作可能会影响性能。</li>
<li><strong>单线程模型</strong>：Redis 的单线程模型虽然简化了设计，但在某些多核 CPU 场景下可能无法充分利用硬件资源。</li>
<li><strong>数据一致性</strong>：在主从复制和集群模式下，可能会有短暂的数据不一致问题。</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="官方snapd商店安装"><a href="#官方snapd商店安装" class="headerlink" title="官方snapd商店安装"></a>官方snapd商店安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> epel-release <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> snapd <span class="token parameter variable">-y</span> 
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> snapd.socket 
<span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /var/lib/snapd/snap /snap
<span class="token function">sudo</span> snap <span class="token function">install</span> redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="官方源码安装-推荐"><a href="#官方源码安装-推荐" class="headerlink" title="官方源码安装[推荐]"></a>官方源码安装[推荐]</h3><p>1.安装阿里源</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># CentOS 7</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
<span class="token comment"># 安装编译器</span>
yum <span class="token function">install</span> gcc-c++ <span class="token parameter variable">-y</span>
<span class="token comment"># 下载源码</span>
<span class="token function">wget</span> https://download.redis.io/redis-stable.tar.gz
<span class="token comment"># 编译redis</span>
<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> redis-stable.tar.gz
<span class="token builtin class-name">cd</span> redis-stable
<span class="token function">make</span>
<span class="token comment"># 安装生成的可执行文件</span>
<span class="token function">make</span> <span class="token function">install</span>
<span class="token comment"># 启动redis</span>
redis-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><p><strong>SET 命令</strong></p>
<blockquote>
<p>将指定的键设置为指定的值。如果键已经存在，则覆盖旧值。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
SET key value
<span class="token comment"># 示例</span>
SET mykey <span class="token string">"Hello, Redis!"</span>
<span class="token comment"># EX seconds：设置键的过期时间（秒）</span>
SET mykey <span class="token string">"Hello, Redis!"</span> EX <span class="token number">10</span>
<span class="token comment"># PX milliseconds：设置键的过期时间（毫秒）</span>
SET mykey <span class="token string">"Hello, Redis!"</span> PX <span class="token number">10000</span>
<span class="token comment"># NX：仅在键不存在时设置键的值</span>
SET mykey <span class="token string">"Hello, Redis!"</span> NX
<span class="token comment"># XX：仅在键已经存在时设置键的值</span>
SET mykey <span class="token string">"Hello, Redis!"</span> XX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>GET 命令</strong></p>
<blockquote>
<p>获取指定键的值。如果键不存在，返回nil</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
GET key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>DEL 命令</strong></p>
<blockquote>
<p>删除指定的键。如果键不存在，忽略该命令。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
DEL key
DEL key1 key2 key3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>EXPIRE 命令</strong></p>
<blockquote>
<p>设置键的过期时间（秒）。当键过期时，它会被自动删除。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
EXPIRE key seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>KEYS 命令</strong></p>
<blockquote>
<p>查找所有符合给定模式的键。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
KEYS pattern
<span class="token comment"># 示例</span>
KEYS *
KEYS user:*
KEYS *name*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>EXISTS 命令</strong></p>
<blockquote>
<p>检查一个或多个键是否存在。返回存在的键的数量。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
EXISTS key
EXISTS key1 key2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>TTL 命令</strong></p>
<blockquote>
<p>获取键的剩余生存时间（秒）。如果键不存在或没有设置过期时间，返回 <code>-1</code>。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
TTL key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>INCR 命令</strong></p>
<blockquote>
<p>将键的值加1。如果键不存在，则将键的值初始化为0，然后执行加1操作。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
INCR key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>DECR 命令</strong></p>
<blockquote>
<p>将键的值减1。如果键不存在，则将键的值初始化为0，然后执行减1操作。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
DECR key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="数据结构操作命令"><a href="#数据结构操作命令" class="headerlink" title="数据结构操作命令"></a>数据结构操作命令</h2><h3 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>字符串是Redis中最简单的类型，可以存储任何形式的字符串值，包括数字、字节数组等。字符串值最多可以达到512MB。</p>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>缓存</strong>：网页内容缓存，提高访问速度。</li>
<li><strong>计数器</strong>：记录网站访问次数。</li>
<li><strong>会话管理</strong>：存储用户会话信息。</li>
<li><strong>简单的键值存储</strong>：存储用户信息。</li>
</ul>
<h4 id="常用命令及参数"><a href="#常用命令及参数" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>SET key value</code>：设置指定key的值。</li>
<li><code>GET key</code>：获取指定key的值。</li>
<li><code>INCR key</code>：将指定key的值加1。</li>
</ul>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisStringExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 缓存网页内容</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"page:home"</span><span class="token punctuation">,</span> <span class="token string">"&lt;html>...&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计数器</span>
        jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"page_views"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pageViews <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"page_views"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Page views: "</span> <span class="token operator">+</span> pageViews<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：1</span>
        <span class="token comment">// 会话管理</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"session:user123"</span><span class="token punctuation">,</span> <span class="token string">"session_data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 简单的键值存储</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user:1001:username"</span><span class="token punctuation">,</span> <span class="token string">"john_doe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user:1001:username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：john_doe</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Hash（哈希）"><a href="#Hash（哈希）" class="headerlink" title="Hash（哈希）"></a>Hash（哈希）</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>哈希是一个键值对集合，特别适用于存储对象。哈希可以高效地存储和访问对象的多个字段。</p>
<h4 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>存储对象</strong>：例如用户信息。</li>
<li><strong>配置项</strong>：存储应用程序配置。</li>
</ul>
<h4 id="常用命令及参数-1"><a href="#常用命令及参数-1" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>HSET key field value</code>：设置哈希表中指定字段的值。</li>
<li><code>HGET key field</code>：获取哈希表中指定字段的值。</li>
<li><code>HGETALL key</code>：获取哈希表中所有字段的值。</li>
</ul>
<h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisHashExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 存储用户信息</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"user:1000"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"user:1000"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"alice@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取用户信息</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"user:1000"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userEmail <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"user:1000"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：Alice</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userEmail<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：alice@example.com</span>
        <span class="token comment">// 存储配置项</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">,</span> <span class="token string">"theme"</span><span class="token punctuation">,</span> <span class="token string">"dark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">,</span> <span class="token string">"version"</span><span class="token punctuation">,</span> <span class="token string">"1.2.3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取配置项</span>
        <span class="token class-name">String</span> theme <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">,</span> <span class="token string">"theme"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> version <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">,</span> <span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Theme: "</span> <span class="token operator">+</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：dark</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Version: "</span> <span class="token operator">+</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：1.2.3</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p>列表是一个链表，可以从两端进行高效操作。适用于需要按顺序访问元素的场景。</p>
<h4 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>消息队列</strong>：实现简单的消息队列系统。</li>
<li><strong>任务列表</strong>：存储待处理的任务。</li>
<li><strong>最新消息</strong>：存储按时间顺序的消息。</li>
</ul>
<h4 id="常用命令及参数-2"><a href="#常用命令及参数-2" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>LPUSH key value</code>：将一个值插入到列表头部。</li>
<li><code>RPUSH key value</code>：将一个值插入到列表尾部。</li>
<li><code>RPOP key</code>：移除并返回列表的最后一个元素。</li>
<li><code>LRANGE key start stop</code>：获取列表在指定范围内的元素。</li>
</ul>
<h4 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisListExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实现消息队列</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"message_queue"</span><span class="token punctuation">,</span> <span class="token string">"message1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"message_queue"</span><span class="token punctuation">,</span> <span class="token string">"message2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从队列中取出消息</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">rpop</span><span class="token punctuation">(</span><span class="token string">"message_queue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Message: "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：message1</span>
        <span class="token comment">// 存储待处理的任务</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"task_list"</span><span class="token punctuation">,</span> <span class="token string">"task1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"task_list"</span><span class="token punctuation">,</span> <span class="token string">"task2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取待处理的任务</span>
        <span class="token class-name">String</span> task <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">rpop</span><span class="token punctuation">(</span><span class="token string">"task_list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Task: "</span> <span class="token operator">+</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：task1</span>
        <span class="token comment">// 存储最新消息</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"news_feed"</span><span class="token punctuation">,</span> <span class="token string">"news1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"news_feed"</span><span class="token punctuation">,</span> <span class="token string">"news2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取最新消息</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> newsFeed <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"news_feed"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> news <span class="token operator">:</span> newsFeed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"News: "</span> <span class="token operator">+</span> news<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：news2, news1</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h3><h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><p>集合是无序的唯一元素集合，提供高效的成员检查和去重功能。</p>
<h4 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>标签</strong>：存储用户的兴趣标签。</li>
<li><strong>唯一性检查</strong>：检查某个元素是否存在。</li>
<li><strong>共同好友</strong>：找出共同好友。</li>
<li><strong>去重</strong>：去除重复数据。</li>
</ul>
<h4 id="常用命令及参数-3"><a href="#常用命令及参数-3" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>SADD key member</code>：向集合添加一个或多个成员。</li>
<li><code>SISMEMBER key member</code>：判断成员是否是集合的成员。</li>
<li><code>SMEMBERS key</code>：返回集合中的所有成员。</li>
</ul>
<h4 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisSetExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 存储用户的兴趣标签</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"user:1000:tags"</span><span class="token punctuation">,</span> <span class="token string">"music"</span><span class="token punctuation">,</span> <span class="token string">"sports"</span><span class="token punctuation">,</span> <span class="token string">"travel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查标签是否存在</span>
        <span class="token keyword">boolean</span> isTagExist <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span><span class="token string">"user:1000:tags"</span><span class="token punctuation">,</span> <span class="token string">"music"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Is tag 'music' exist: "</span> <span class="token operator">+</span> isTagExist<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：true</span>
        <span class="token comment">// 获取所有标签</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> tags <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"user:1000:tags"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> tag <span class="token operator">:</span> tags<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Tag: "</span> <span class="token operator">+</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：music, sports, travel</span>
        <span class="token comment">// 存储用户1和用户2的朋友列表</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"user:1:friends"</span><span class="token punctuation">,</span> <span class="token string">"user2"</span><span class="token punctuation">,</span> <span class="token string">"user3"</span><span class="token punctuation">,</span> <span class="token string">"user4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"user:2:friends"</span><span class="token punctuation">,</span> <span class="token string">"user3"</span><span class="token punctuation">,</span> <span class="token string">"user4"</span><span class="token punctuation">,</span> <span class="token string">"user5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 找出共同好友</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> commonFriends <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">sinter</span><span class="token punctuation">(</span><span class="token string">"user:1:friends"</span><span class="token punctuation">,</span> <span class="token string">"user:2:friends"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> friend <span class="token operator">:</span> commonFriends<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Common friend: "</span> <span class="token operator">+</span> friend<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：user3, user4</span>
        <span class="token comment">// 去除重复数据</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"duplicates"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> uniqueElements <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"duplicates"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> uniqueElements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Unique element: "</span> <span class="token operator">+</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：1, 2, 3, 4</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Sorted-Set（有序集合）"><a href="#Sorted-Set（有序集合）" class="headerlink" title="Sorted Set（有序集合）"></a>Sorted Set（有序集合）</h3><h4 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h4><p>有序集合是带有分数的集合，集合中的元素是有序的。适用于需要按权重排序的场景。</p>
<h4 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>排行榜</strong>：实现游戏的排行榜。</li>
<li><strong>延迟队列</strong>：存储带有时间戳的任务。</li>
<li><strong>按评分排序</strong>：存储商品列表。</li>
</ul>
<h4 id="常用命令及参数-4"><a href="#常用命令及参数-4" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>ZADD key score member</code>：向有序集合添加一个成员，或者更新已存在成员的分数。</li>
<li><code>ZREM key member</code>：移除有序集合中的一个成员。</li>
<li><code>ZRANGE key start stop [WITHSCORES]</code>：</li>
</ul>
<h4 id="示例代码-4"><a href="#示例代码-4" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisSortedSetExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 		<span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实现游戏的排行榜</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"leaderboard"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"leaderboard"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取排行榜</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">></span></span> leaderboard <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrevrangeWithScores</span><span class="token punctuation">(</span><span class="token string">"leaderboard"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tuple</span> tuple <span class="token operator">:</span> leaderboard<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tuple<span class="token punctuation">.</span><span class="token function">getElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> tuple<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：Bob: 200.0, Alice: 100.0</span>
        <span class="token comment">// 存储带有时间戳的任务</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"task_queue"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"task1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"task_queue"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"task2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取任务列表</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> tasks <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"task_queue"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> task <span class="token operator">:</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Task: "</span> <span class="token operator">+</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：task1, task2</span>
        <span class="token comment">// 存储按评分排序的商品列表</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"products"</span><span class="token punctuation">,</span> <span class="token number">9.8</span><span class="token punctuation">,</span> <span class="token string">"ProductA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"products"</span><span class="token punctuation">,</span> <span class="token number">8.6</span><span class="token punctuation">,</span> <span class="token string">"ProductB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取商品列表</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">></span></span> products <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrangeWithScores</span><span class="token punctuation">(</span><span class="token string">"products"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tuple</span> product <span class="token operator">:</span> products<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：ProductB: 8.6, ProductA: 9.8</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Bitmap（位图）"><a href="#Bitmap（位图）" class="headerlink" title="Bitmap（位图）"></a>Bitmap（位图）</h3><h4 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h4><p>位图是对字符串类型的进一步扩展，提供按位操作，适用于大规模数据的快速统计。</p>
<h4 id="应用场景-5"><a href="#应用场景-5" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>用户签到</strong>：记录用户每天的签到情况。</li>
<li><strong>统计</strong>：统计某个时间段内的活跃用户。</li>
<li><strong>布隆过滤器</strong>：用于快速判断某个元素是否存在。</li>
</ul>
<h4 id="常用命令及参数-5"><a href="#常用命令及参数-5" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>SETBIT key offset value</code>：对key指定偏移量上的位进行设置。</li>
<li><code>GETBIT key offset</code>：对key指定偏移量上的位进行获取。</li>
<li><code>BITCOUNT key [start end]</code>：统计字符串被设置为1的bit数。</li>
</ul>
<h4 id="示例代码-5"><a href="#示例代码-5" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisBitmapExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 记录用户签到</span>
        jedis<span class="token punctuation">.</span><span class="token function">setbit</span><span class="token punctuation">(</span><span class="token string">"user:1000:checkin"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setbit</span><span class="token punctuation">(</span><span class="token string">"user:1000:checkin"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查用户是否签到</span>
        <span class="token keyword">boolean</span> isCheckedInDay1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">getbit</span><span class="token punctuation">(</span><span class="token string">"user:1000:checkin"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isCheckedInDay2 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">getbit</span><span class="token punctuation">(</span><span class="token string">"user:1000:checkin"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Day 1 check-in: "</span> <span class="token operator">+</span> isCheckedInDay1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Day 2 check-in: "</span> <span class="token operator">+</span> isCheckedInDay2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：true</span>
        <span class="token comment">// 统计签到次数</span>
        <span class="token keyword">long</span> checkinCount <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">bitcount</span><span class="token punctuation">(</span><span class="token string">"user:1000:checkin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Check-in count: "</span> <span class="token operator">+</span> checkinCount<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：2</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><h4 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h4><p>HyperLogLog是基数估计算法，可以在低内存消耗下进行大规模基数统计，适用于去重统计。</p>
<h4 id="应用场景-6"><a href="#应用场景-6" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>基数统计</strong>：统计网站的独立访问用户数（UV）。</li>
</ul>
<h4 id="常用命令及参数-6"><a href="#常用命令及参数-6" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>PFADD key element [element ...]</code>：将元素添加到HyperLogLog中。</li>
<li><code>PFCOUNT key</code>：返回HyperLogLog的基数估算值。</li>
</ul>
<h4 id="示例代码-6"><a href="#示例代码-6" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisHyperLogLogExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加独立访问用户</span>
        jedis<span class="token punctuation">.</span><span class="token function">pfadd</span><span class="token punctuation">(</span><span class="token string">"unique_visitors"</span><span class="token punctuation">,</span> <span class="token string">"user1"</span><span class="token punctuation">,</span> <span class="token string">"user2"</span><span class="token punctuation">,</span> <span class="token string">"user3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取独立访问用户数</span>
        <span class="token keyword">long</span> uvCount <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">pfcount</span><span class="token punctuation">(</span><span class="token string">"unique_visitors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Unique visitors: "</span> <span class="token operator">+</span> uvCount<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出：3</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Geo（地理空间）"><a href="#Geo（地理空间）" class="headerlink" title="Geo（地理空间）"></a>Geo（地理空间）</h3><h4 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h4><p>地理空间类型允许存储地理位置数据，并提供半径查询功能，适用于地理位置存储与查询。</p>
<h4 id="应用场景-7"><a href="#应用场景-7" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>存储地理位置</strong>：存储用户或商家的地理位置。</li>
<li><strong>查询附近的用户或商家</strong>：实现“附近的人”或“附近的商家”功能。</li>
</ul>
<h4 id="常用命令及参数-7"><a href="#常用命令及参数-7" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>GEOADD key longitude latitude member</code>：将地理空间位置（纬度、经度、名称）添加到指定的key中。</li>
<li><code>GEORADIUS key longitude latitude radius unit</code>：以给定的经纬度为中心，返回指定半径范围内的地理位置。</li>
</ul>
<h4 id="示例代码-7"><a href="#示例代码-7" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisGeoExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加地理位置</span>
        jedis<span class="token punctuation">.</span><span class="token function">geoadd</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">13.361389</span><span class="token punctuation">,</span> <span class="token number">38.115556</span><span class="token punctuation">,</span> <span class="token string">"Palermo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">geoadd</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">15.087269</span><span class="token punctuation">,</span> <span class="token number">37.502669</span><span class="token punctuation">,</span> <span class="token string">"Catania"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查询附近位置</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> nearby <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">georadius</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"km"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> location <span class="token operator">:</span> nearby<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Nearby location: "</span> <span class="token operator">+</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：Catania, Palermo</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Stream（流）"><a href="#Stream（流）" class="headerlink" title="Stream（流）"></a>Stream（流）</h3><h4 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h4><p>流是一种日志结构数据类型，可以添加和读取数据项，适用于实时数据流处理。</p>
<h4 id="应用场景-8"><a href="#应用场景-8" class="headerlink" title="应用场景"></a>应用场景</h4><ul>
<li><strong>实时数据流处理</strong>：处理传感器数据。</li>
<li><strong>日志收集</strong>：收集和处理日志数据。</li>
<li><strong>消息队列</strong>：实现复杂的消息队列系统。</li>
</ul>
<h4 id="常用命令及参数-8"><a href="#常用命令及参数-8" class="headerlink" title="常用命令及参数"></a>常用命令及参数</h4><ul>
<li><code>XADD key ID field value [field value ...]</code>：向流中添加一个消息。</li>
<li><code>XRANGE key start end [COUNT count]</code>：返回指定区间内的流消息。</li>
</ul>
<h4 id="示例代码-8"><a href="#示例代码-8" class="headerlink" title="示例代码"></a>示例代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisStreamExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 连接到Redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加消息到流</span>
        jedis<span class="token punctuation">.</span><span class="token function">xadd</span><span class="token punctuation">(</span><span class="token string">"mystream"</span><span class="token punctuation">,</span> <span class="token class-name">StreamEntryID</span><span class="token punctuation">.</span><span class="token constant">NEW_ENTRY</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"sensor_id"</span><span class="token punctuation">,</span> <span class="token string">"sensor1"</span><span class="token punctuation">,</span> <span class="token string">"temperature"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取消息</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StreamEntry</span><span class="token punctuation">></span></span> messages <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">xrange</span><span class="token punctuation">(</span><span class="token string">"mystream"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StreamEntry</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 输出：[&#123;sensor_id=sensor1, temperature=20&#125;]</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><blockquote>
<p>Redis 提供了事务机制，可以将一组命令打包成一个原子操作。事务中的所有命令都会按顺序执行，确保数据的一致性。Redis 的事务机制主要通过以下命令实现：<code>MULTI</code>、<code>EXEC</code>、<code>DISCARD</code> 和 <code>WATCH</code>。</p>
</blockquote>
<h3 id="MULTI-命令"><a href="#MULTI-命令" class="headerlink" title="MULTI 命令"></a>MULTI 命令</h3><blockquote>
<p>标记一个事务的开始。事务中的所有命令会被放入一个队列，等待执行。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 示例</span>
MULTI
SET key1 <span class="token string">"value1"</span>
SET key2 <span class="token string">"value2"</span>
EXEC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="EXEC-命令"><a href="#EXEC-命令" class="headerlink" title="EXEC 命令"></a>EXEC 命令</h3><blockquote>
<p>执行所有在事务中排队的命令。所有命令会按顺序执行，并且是原子操作。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 示例</span>
MULTI
SET key1 <span class="token string">"value1"</span>
SET key2 <span class="token string">"value2"</span>
EXEC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="DISCARD-命令"><a href="#DISCARD-命令" class="headerlink" title="DISCARD 命令"></a>DISCARD 命令</h3><blockquote>
<p>取消事务，放弃所有在事务中排队的命令。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 示例</span>
MULTI
SET key1 <span class="token string">"value1"</span>
SET key2 <span class="token string">"value2"</span>
DISCARD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="WATCH-命令"><a href="#WATCH-命令" class="headerlink" title="WATCH 命令"></a>WATCH 命令</h3><blockquote>
<p>监视一个或多个键，如果在事务执行之前这些键被修改，事务将被中止。<code>WATCH</code> 命令用于实现乐观锁。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
WATCH key1 key2
MULTI
SET key1 <span class="token string">"value1"</span>
SET key2 <span class="token string">"value2"</span>
EXEC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>Redis 的事务不是严格意义的原子性且不支持回滚。如果事务中的某个命令执行失败，其他命令仍会继续执行。</li>
<li><code>WATCH</code> 命令用于实现乐观锁，可以监视一个或多个键。如果在事务执行之前这些键被修改，事务将被中止。</li>
<li>Redis 事务中的命令会被放入一个队列，等待 <code>EXEC</code> 命令执行。事务中的命令不会立即执行，而是等到 <code>EXEC</code> 命令执行时才会执行。</li>
</ul>
<h3 id="事务失败场景"><a href="#事务失败场景" class="headerlink" title="事务失败场景"></a>事务失败场景</h3><ul>
<li>命令语法错误： 如果在事务队列中的某个命令存在语法错误，整个事务会被标记为失败，但正确的命令仍会执行。确保语法正确。</li>
<li>WATCH监视的键被修改： 如果在事务执行之前，WATCH 监视的键被其他客户端修改，事务将被中止。实现重试机制。</li>
<li>内存不足：如果 Redis 实例内存不足，事务中的某些命令可能会因为内存分配失败而无法执行。配置内存限制和淘汰策略来管理内存使用。</li>
<li>网络错误：网络问题可能导致客户端与 Redis 服务器的连接中断，从而导致事务失败。实现重试机制。</li>
</ul>
<p><strong>重试机制示例</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   redisTemplate<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   redisTemplate<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"new_value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token comment">// 事务成功</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="LUA脚本"><a href="#LUA脚本" class="headerlink" title="LUA脚本"></a>LUA脚本</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>Lua 是一种轻量级的脚本语言，Redis支持在服务器端执行Lua 脚本。通过Lua脚本，可以将多个 Redis 命令组合成一个原子操作，从而保证操作的原子性和一致性。</p>
<h3 id="EVAL-命令"><a href="#EVAL-命令" class="headerlink" title="EVAL 命令"></a>EVAL 命令</h3><blockquote>
<p>EVAL命令用于执行 Lua 脚本</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
<span class="token comment"># script 要执行的 Lua 脚本</span>
<span class="token comment"># numkeys 脚本中使用的键的数量</span>
<span class="token comment"># key 传递给脚本的键</span>
<span class="token comment"># arg 传递给脚本的参数</span>
EVAL script numkeys key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> arg <span class="token punctuation">[</span>arg <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment"># 示例 将mykey设置为Hello, Redis!</span>
EVAL <span class="token string">"return redis.call('SET', KEYS[1], ARGV[1])"</span> <span class="token number">1</span> mykey <span class="token string">"Hello, Redis!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="EVALSHA-命令"><a href="#EVALSHA-命令" class="headerlink" title="EVALSHA 命令"></a>EVALSHA 命令</h3><blockquote>
<p>EVALSHA命令用于执行已经缓存的 Lua 脚本。EVALSHA通过脚本的SHA1校验和来执行脚本，从而避免每次都传递脚本内容。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 语法</span>
<span class="token comment"># sha1 脚本的 SHA1 校验和</span>
EVALSHA sha1 numkeys key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> arg <span class="token punctuation">[</span>arg <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment"># 示例</span>
-- 先使用 EVAL 命令执行脚本
EVAL <span class="token string">"return redis.call('SET', KEYS[1], ARGV[1])"</span> <span class="token number">1</span> mykey <span class="token string">"Hello, Redis!"</span>

-- 获取脚本的 SHA1 校验和
SCRIPT LOAD <span class="token string">"return redis.call('SET', KEYS[1], ARGV[1])"</span>

-- 使用 EVALSHA 命令执行脚本
EVALSHA <span class="token operator">&lt;</span>sha<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token number">1</span> mykey <span class="token string">"Hello, Redis!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="为什么LUA能保证原子性"><a href="#为什么LUA能保证原子性" class="headerlink" title="为什么LUA能保证原子性"></a>为什么LUA能保证原子性</h3><ol>
<li>单线程执行：redis是一个单线程的服务，核心命令都是单线程的，同一时间只能处理一个命令。</li>
<li>脚本作为一个整体执行：使用 <code>EVAL</code> 或 <code>EVALSHA</code> 命令执行 Lua 脚本时，Redis 会将整个脚本作为一个原子操作执行。</li>
<li>脚本执行的原子性： Redis在执行Lua脚本时不会中断脚本的执行。</li>
</ol>
<h3 id="LUA应用场景"><a href="#LUA应用场景" class="headerlink" title="LUA应用场景"></a>LUA应用场景</h3><ol>
<li><strong>脚本缓存</strong>：使用 <code>SCRIPT LOAD</code> 命令将脚本加载到 Redis 服务器，并使用 <code>EVALSHA</code> 命令执行缓存的脚本，减少网络传输和解析脚本的开销。</li>
<li><strong>错误处理</strong>：在 Lua 脚本中添加错误处理逻辑，确保脚本执行过程中出现错误时能够正确处理。</li>
<li><strong>性能优化</strong>：尽量将复杂的逻辑放在 Lua 脚本中执行，减少客户端与 Redis 服务器之间的网络往返次数，提高性能。</li>
</ol>
<h1 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h1><h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><blockquote>
<p>Redis 提供了两种主要的持久化机制：RDB（Redis Database）快照和 AOF（Append Only File）日志</p>
</blockquote>
<h3 id="RDB-快照"><a href="#RDB-快照" class="headerlink" title="RDB 快照"></a>RDB 快照</h3><p>工作原理：RDB 持久化通过创建内存中数据的快照并将其保存到磁盘上来实现。Redis 会在指定的时间间隔内生成 RDB 文件，包含某一时刻的数据快照。</p>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ol>
<li><strong>生成的文件较小</strong>：RDB 文件是压缩的二进制文件，体积较小，适合备份和传输。</li>
<li><strong>恢复速度快</strong>：RDB 文件是一个完整的数据快照，恢复速度较快。</li>
<li><strong>对性能影响小</strong>：RDB 持久化在指定的时间间隔内进行，不会频繁写磁盘，对 Redis 性能影响较小。</li>
</ol>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li><strong>数据丢失风险</strong>：由于 RDB 持久化是定期进行的，可能会丢失最近一次快照后的数据。</li>
<li><strong>生成快照时消耗资源</strong>：生成 RDB 快照时会消耗一定的 CPU 和内存资源，可能会影响 Redis 的性能。</li>
</ol>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>可以在 Redis 配置文件（<code>redis.conf</code>）中配置 RDB 持久化。常用的配置选项包括：</p>
<ul>
<li>save：配置生成 RDB 快照的时间间隔和条件。</li>
<li>dbfilename：指定 RDB 文件的名称。</li>
<li>dir：指定 RDB 文件的存储目录。</li>
</ul>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 在 900 秒内有 1 次写操作时生成快照</span>
<span class="token comment"># 在 300 秒内有 10 次写操作时生成快照</span>
<span class="token comment"># 在 60 秒内有 10000 次写操作时生成快照</span>
save 900 1
save 300 10
save 60 10000

<span class="token comment"># RDB 文件名</span>
dbfilename dump.rdb

<span class="token comment"># RDB 文件存储目录</span>
dir /var/lib/redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="手动生成和恢复-RDB-快照"><a href="#手动生成和恢复-RDB-快照" class="headerlink" title="手动生成和恢复 RDB 快照"></a>手动生成和恢复 RDB 快照</h4><ul>
<li><strong>生成快照</strong>：可以使用 <code>BGSAVE</code> 命令手动生成 RDB 快照。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">BGSAVE<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>恢复快照</strong>：将 RDB 文件放置在 Redis 配置文件中指定的目录下，然后重启 Redis 服务器即可恢复数据。</li>
</ul>
<h3 id="AOF-日志"><a href="#AOF-日志" class="headerlink" title="AOF 日志"></a>AOF 日志</h3><p>工作原理：AOF 持久化通过将每次写操作记录到日志文件中来实现。Redis 会将所有写操作追加到 AOF 文件中，并定期将文件同步到磁盘。</p>
<h4 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h4><ol>
<li><strong>数据恢复更完整</strong>：AOF 文件记录了每次写操作，数据恢复时丢失的可能性较小。</li>
<li><strong>可读性强</strong>：AOF 文件是纯文本文件，包含 Redis 命令，便于调试和分析。</li>
</ol>
<h4 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li><strong>文件较大</strong>：AOF 文件会随着写操作的增加而变大，可能需要定期重写文件以控制文件大小。</li>
<li><strong>对性能影响较大</strong>：由于每次写操作都会记录到 AOF 文件中，频繁的写操作可能会影响 Redis 的性能。</li>
</ol>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p>可以在 Redis 配置文件（<code>redis.conf</code>）中配置 AOF 持久化。常用的配置选项包括：</p>
<ul>
<li>appendonly：启用 AOF 持久化。</li>
<li>appendfilename：指定 AOF 文件的名称。</li>
<li>appendfsync：配置 AOF 文件的同步策略。</li>
</ul>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 启用 AOF 持久化</span>
appendonly yes

<span class="token comment"># AOF 文件名</span>
appendfilename "appendonly.aof"

<span class="token comment"># AOF 文件同步策略</span>
<span class="token comment"># always：每次写操作后立即同步</span>
<span class="token comment"># everysec：每秒同步一次（默认）</span>
<span class="token comment"># no：由操作系统决定何时同步</span>
appendfsync everysec<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h4><p>由于 AOF 文件会随着写操作的增加而变大，Redis 提供了 AOF 重写机制，通过创建一个新的 AOF 文件来压缩旧的 AOF 文件。</p>
<ul>
<li><strong>自动重写</strong>：可以在配置文件中配置自动重写的条件。</li>
</ul>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 当 AOF 文件大小是上次重写后的两倍时触发重写</span>
auto-aof-rewrite-percentage 100
<span class="token comment"># AOF 文件最小大小（字节），达到此大小才会触发重写</span>
auto-aof-rewrite-min-size 64mb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>手动重写</strong>：可以使用 <code>BGREWRITEAOF</code> 命令手动触发 AOF 重写。</li>
</ul>
<h3 id="持久化策略选择"><a href="#持久化策略选择" class="headerlink" title="持久化策略选择"></a>持久化策略选择</h3><ol>
<li><strong>仅使用 RDB</strong>：适用于不太关心数据丢失的场景，例如缓存。RDB 持久化对性能影响较小，但可能会丢失最近一次快照后的数据。</li>
<li><strong>仅使用 AOF</strong>：适用于需要尽量减少数据丢失的场景。AOF 持久化可以记录每次写操作，但对性能影响较大。</li>
<li><strong>同时使用 RDB 和 AOF</strong>：适用于需要兼顾数据完整性和性能的场景。可以同时启用 RDB 和 AOF 持久化，RDB 提供快速恢复，AOF 提供更高的数据完整性。</li>
</ol>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 同时使用 RDB 和 AOF的配置</span>
<span class="token comment"># RDB 配置</span>
save 900 1
save 300 10
save 60 10000
dbfilename dump.rdb
dir /var/lib/redis

<span class="token comment"># AOF 配置</span>
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><blockquote>
<p>Redis 提供了强大的复制机制，使得数据可以在多个 Redis 实例之间进行复制，从而实现数据的高可用性和负载均衡。</p>
</blockquote>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>主从复制就是一个主节点将数据复制到一个或多个从节点上，主节点处理写操作，从节点处理读操作，这样可以提高读性能，并在主节点故障时提供数据冗余。</p>
<h3 id="复制过程"><a href="#复制过程" class="headerlink" title="复制过程"></a>复制过程</h3><ol>
<li><strong>全量复制</strong>：当从节点第一次连接到主节点时，会进行全量复制。主节点会将当前内存中的数据快照发送给从节点，从节点接收到快照后进行数据加载。</li>
<li><strong>增量复制</strong>：在全量复制完成后，主节点会将新的写操作命令发送给从节点，从节点执行这些命令以保持数据同步。</li>
</ol>
<h3 id="配置主从复制"><a href="#配置主从复制" class="headerlink" title="配置主从复制"></a>配置主从复制</h3><h4 id="配置主节点"><a href="#配置主节点" class="headerlink" title="配置主节点"></a>配置主节点</h4><p>主节点无需进行特殊配置，只需启动 Redis 实例即可。</p>
<h4 id="配置从节点"><a href="#配置从节点" class="headerlink" title="配置从节点"></a>配置从节点</h4><p>从节点需要配置连接到主节点。可以在 Redis 配置文件（<code>redis.conf</code>）中添加以下配置：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 指定主节点的 IP 地址和端口</span>
replicaof &lt;master-ip> &lt;master-port>
<span class="token comment"># 示例</span>
replicaof 192.168.1.100 6379
<span class="token comment"># Redis 实例启动后，通过命令行配置从节点</span>
redis-cli REPLICAOF 192.168.1.100 6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="取消从节点"><a href="#取消从节点" class="headerlink" title="取消从节点"></a>取消从节点</h4><p>如果需要将从节点转换为独立的主节点，可以使用以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli REPLICAOF NO ONE<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="管理主从复制"><a href="#管理主从复制" class="headerlink" title="管理主从复制"></a>管理主从复制</h3><h4 id="查看复制状态"><a href="#查看复制状态" class="headerlink" title="查看复制状态"></a>查看复制状态</h4><p>可以使用 <code>INFO replication</code> 命令查看复制状态：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli INFO replication
<span class="token comment"># 结果</span>
<span class="token comment"># Replication</span>
role:master
connected_slaves:1
slave0:ip<span class="token operator">=</span><span class="token number">192.168</span>.1.101,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">1234567</span>,lag<span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="复制延迟"><a href="#复制延迟" class="headerlink" title="复制延迟"></a>复制延迟</h4><p>主从复制是异步进行的，主节点不会等待从节点完成复制就返回客户端，所以从节点总会有一定程度的数据延迟，可以使用 <code>REPLCONF</code> 命令配置从节点的复制延迟，以减少主节点的负载，帮助Redis系统在主节点故障时,快速恢复数据,提高系统的可用性和可靠性。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli REPLCONF ack <span class="token number">1000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="复制断开和重连"><a href="#复制断开和重连" class="headerlink" title="复制断开和重连"></a>复制断开和重连</h4><p>当从节点与主节点的连接断开时，从节点会自动尝试重新连接主节点。在重连期间，从节点会继续处理读请求，但数据可能不是最新的。</p>
<h3 id="高级配置选项"><a href="#高级配置选项" class="headerlink" title="高级配置选项"></a>高级配置选项</h3><h4 id="repl-diskless-sync"><a href="#repl-diskless-sync" class="headerlink" title="repl-diskless-sync"></a><code>repl-diskless-sync</code></h4><p>配置是否使用无盘复制,主节点和从节点初次建立连接的时候，从节点发送sync请求全量复制，配置无盘复制后，主节点会直接将内存中数据传输给从节点，而不是生成RDB快照，将RDB快照发送给从节点，主节点不生成和传输RDB文件，减轻了主节点的磁盘IO。</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">repl-diskless-sync yes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="repl-diskless-sync-delay"><a href="#repl-diskless-sync-delay" class="headerlink" title="repl-diskless-sync-delay"></a><code>repl-diskless-sync-delay</code></h4><p>配置无盘复制的延迟时间，以等待更多从节点连接：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">repl-diskless-sync-delay 5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="min-replicas-to-write-和-min-replicas-max-lag"><a href="#min-replicas-to-write-和-min-replicas-max-lag" class="headerlink" title="min-replicas-to-write 和 min-replicas-max-lag"></a><code>min-replicas-to-write</code> 和 <code>min-replicas-max-lag</code></h4><p>配置最少从节点数量和最大复制延迟，以确保数据的高可用性：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">min-replicas-to-write 1
min-replicas-max-lag 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="主从复制的优缺点"><a href="#主从复制的优缺点" class="headerlink" title="主从复制的优缺点"></a>主从复制的优缺点</h3><h4 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h4><ol>
<li><strong>提高读性能</strong>：从节点可以分担读请求，提高系统的读性能。</li>
<li><strong>数据冗余</strong>：从节点提供数据备份，在主节点故障时可以切换到从节点，确保数据的高可用性。</li>
</ol>
<h4 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li><strong>数据一致性</strong>：主从复制是异步的，可能会有短暂的数据不一致。</li>
<li><strong>写性能影响</strong>：主节点需要将写操作发送给所有从节点，可能会影响写性能。</li>
<li><strong>手动切换</strong>：主节点发生故障，需要手动切换从节点为主节点。</li>
</ol>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p><strong>延迟（Latency）</strong></p>
<ul>
<li><strong>问题</strong>：主从节点之间的网络延迟会导致从节点的数据滞后于主节点，影响数据一致性。</li>
<li><strong>解决</strong>：通过优化网络条件，减少延迟，使用低延迟网络硬件。此外，可以使用 Redis 的 <code>min-slaves-to-write</code> 和 <code>min-slaves-max-lag</code> 配置项，确保主节点在写入数据时有足够数量的从节点保持低延迟。</li>
</ul>
<p><strong>复制风暴（Replication Storm）</strong></p>
<ul>
<li><strong>问题</strong>：主节点重启或故障恢复时，从节点可能同时请求全量复制，造成网络和主节点负载过高。</li>
<li><strong>解决</strong>：通过配置 <code>repl-backlog-size</code> 和 <code>repl-backlog-ttl</code> 增加复制积压缓冲区（backlog），以便在主节点恢复后进行增量复制，而非全量复制。</li>
</ul>
<h2 id="哨兵"><a href="#哨兵" class="headerlink" title="哨兵"></a>哨兵</h2><blockquote>
<p>Redis Sentinel 是 Redis 提供的一种高可用性解决方案，用于监控、自动故障转移和通知管理员。通过 Sentinel，可以实现 Redis 集群的自动化管理，确保系统的高可用性。</p>
</blockquote>
<h3 id="Redis-Sentinel-的主要功能"><a href="#Redis-Sentinel-的主要功能" class="headerlink" title="Redis Sentinel 的主要功能"></a>Redis Sentinel 的主要功能</h3><ol>
<li><strong>监控</strong>：持续监控主节点和从节点的运行状态。</li>
<li><strong>通知</strong>：在检测到故障时，向管理员发送通知。</li>
<li><strong>自动故障转移</strong>：当主节点发生故障时，自动将一个从节点提升为新的主节点。</li>
<li><strong>配置提供者</strong>：客户端可以通过 Sentinel 获取当前的主节点地址。</li>
</ol>
<h3 id="Sentinel-的配置"><a href="#Sentinel-的配置" class="headerlink" title="Sentinel 的配置"></a>Sentinel 的配置</h3><h4 id="Sentinel-配置文件"><a href="#Sentinel-配置文件" class="headerlink" title="Sentinel 配置文件"></a>Sentinel 配置文件</h4><p>Sentinel 使用独立的配置文件，通常命名为 <code>sentinel.conf</code>。以下是一个基本的 Sentinel 配置文件示例：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># Sentinel 实例的端口</span>
port 26379

<span class="token comment"># 监控的主节点，格式为：sentinel monitor &lt;master-name> &lt;master-ip> &lt;master-port> &lt;quorum></span>
<span class="token comment"># &lt;quorum> 是达成一致所需的 Sentinel 数量</span>
sentinel monitor mymaster 192.168.1.100 6379 2

<span class="token comment"># 指定 Sentinel 与主节点通信的密码（如果主节点启用了密码保护）</span>
<span class="token comment"># sentinel auth-pass &lt;master-name> &lt;password></span>
<span class="token comment"># sentinel auth-pass mymaster mypassword</span>

<span class="token comment"># 指定 Sentinel 判断主节点失效的时间（毫秒）</span>
sentinel down-after-milliseconds mymaster 5000

<span class="token comment"># 指定故障转移的超时时间（毫秒）</span>
sentinel failover-timeout mymaster 60000

<span class="token comment"># 指定在故障转移过程中，最多可以有多少个从节点同时对新的主节点进行同步</span>
sentinel parallel-syncs mymaster 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="启动-Sentinel"><a href="#启动-Sentinel" class="headerlink" title="启动 Sentinel"></a>启动 Sentinel</h4><p>可以使用以下命令启动 Sentinel：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-sentinel /path/to/sentinel.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="原理-x2F-算法-x2F-选举过程-x2F-故障转移过程"><a href="#原理-x2F-算法-x2F-选举过程-x2F-故障转移过程" class="headerlink" title="原理&#x2F;算法&#x2F;选举过程&#x2F;故障转移过程"></a>原理&#x2F;算法&#x2F;选举过程&#x2F;故障转移过程</h3><ol>
<li><strong>检测故障</strong>：Sentinel 实例通过 PING 命令检测主节点的状态。如果主节点在指定时间内没有响应，Sentinel 会将其标记为 SDOWN。</li>
<li><strong>确认故障</strong>：如果多个 Sentinel 实例（达到 quorum 数量）都认为主节点下线，Sentinel 会将其标记为 ODOWN，并发起故障转移。</li>
<li><strong>选举新的主节点</strong>：Sentinel 会从从节点中选举一个作为新的主节点。选举过程基于从节点的优先级、复制偏移量等因素。</li>
<li><strong>重新配置从节点</strong>：其他从节点更新其复制目标，开始从新的主节点复制数据。</li>
<li><strong>通知客户端</strong>：Sentinel 会向客户端提供新的主节点地址，以便客户端重新连接。</li>
</ol>
<h3 id="Sentinel-的高级配置"><a href="#Sentinel-的高级配置" class="headerlink" title="Sentinel 的高级配置"></a>Sentinel 的高级配置</h3><h4 id="客户端重定向"><a href="#客户端重定向" class="headerlink" title="客户端重定向"></a>客户端重定向</h4><p>可以配置客户端在连接到 Sentinel 时自动获取主节点地址：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># Sentinel 提供的主节点地址</span>
sentinel announce-ip 192.168.1.101
sentinel announce-port 26379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a>安全配置</h4><p>可以配置 Sentinel 与 Redis 实例之间的认证信息：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># Sentinel 与主节点通信的密码</span>
sentinel auth-pass mymaster mypassword

<span class="token comment"># Sentinel 与从节点通信的密码</span>
sentinel replica-announce-auth-pass mypassword<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="日志和监控"><a href="#日志和监控" class="headerlink" title="日志和监控"></a>日志和监控</h4><p>可以配置 Sentinel 的日志和监控选项：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 日志文件</span>
logfile "/var/log/redis/sentinel.log"

<span class="token comment"># 日志级别</span>
loglevel notice<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="示例配置"><a href="#示例配置" class="headerlink" title="示例配置"></a>示例配置</h3><p>以下是一个完整的 Sentinel 配置示例：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">port 26379
sentinel monitor mymaster 192.168.1.100 6379 2
sentinel auth-pass mymaster mypassword
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
logfile "/var/log/redis/sentinel.log"
loglevel notice<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="启动多个-Sentinel-实例"><a href="#启动多个-Sentinel-实例" class="headerlink" title="启动多个 Sentinel 实例"></a>启动多个 Sentinel 实例</h3><p>为了实现高可用性，通常需要启动多个 Sentinel 实例。可以在不同的服务器上启动 Sentinel，并使用相同的配置文件。</p>
<h3 id="常见问题-1"><a href="#常见问题-1" class="headerlink" title="常见问题"></a>常见问题</h3><ul>
<li><strong>脑裂</strong>：哨兵错误地判断主节点已宕机，触发主从切换，导致脑裂。</li>
<li><strong>哨兵自身问题</strong>：哨兵自身出现故障，导致无法正常工作。Sentinel 集群中如果有一个 Sentinel 节点出现故障，其他 Sentinel 节点仍然可以继续监控主节点和执行故障转移。</li>
</ul>
<p><strong>解决方法</strong></p>
<ul>
<li><p><strong>降低网络延迟</strong>：降低主从节点和哨兵节点之间的网络延迟，可以减少网络问题导致的故障。</p>
</li>
<li><p><strong>合理配置哨兵</strong>：合理配置哨兵的参数，例如min-nodes-to-promote参数和down-after-movement-seconds参数，可以降低哨兵误判主节点宕机的概率。</p>
</li>
<li><p><strong>使用多个哨兵节点</strong>：使用多个哨兵节点可以提高哨兵系统的可用性，即使一个哨兵节点出现故障，其他哨兵节点仍然可以工作。</p>
</li>
</ul>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><blockquote>
<p>Redis 集群（Redis Cluster）是一种分布式的 Redis 部署方式，旨在实现数据的分片和高可用性。通过 Redis 集群，可以将数据分布在多个节点上，从而提高系统的扩展性和容错能力。</p>
</blockquote>
<img src="https://telegraph-image-2ni.pages.dev/file/b72d32e756849d1c331b4.jpg" style="zoom:70%;">

<h3 id="Redis-集群的架构"><a href="#Redis-集群的架构" class="headerlink" title="Redis 集群的架构"></a>Redis 集群的架构</h3><p><strong>Redis集群</strong>是一种<strong>去中心化</strong>的架构，由多个节点组成，每个节点都存储部分数据，并且可以处理读写请求，集群中的节点相互之间平等，没有主从之分，数据在集群中的各个节点之间进行分片（sharding），每个节点负责存储一部分数据。</p>
<h4 id="数据分片"><a href="#数据分片" class="headerlink" title="数据分片"></a>数据分片</h4><p>Redis 集群将数据分片存储在多个节点上，数据分片通过哈希槽（hash slot）来实现，共有 16384 个哈希槽，哈希槽会平均分配到每个服务器上，每个键通过 CRC16 校验和计算得到一个哈希值，然后对 16384 取模，确定该键属于哪个哈希槽，每个节点负责一定范围的哈希槽。</p>
<h4 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h4><p>在Redis集群模式下，主节点的选举主要是通过Redis集群Gossip协议本身实现的，不依赖于哨兵机制，集群模式使用了一种基于投票的选举算法来进行故障转移和新主节点的选举。</p>
<h3 id="选举算法"><a href="#选举算法" class="headerlink" title="选举算法"></a>选举算法</h3><p>Redis集群模式的选举算法可以总结为以下几点：</p>
<ol>
<li><strong>故障检测</strong>：集群节点通过Gossip协议相互通信，定期发送PING消息并接收PONG消息，如果一个节点未能在一定时间内接收到另一个节点的PONG消息，它会将其标记为下线。</li>
<li><strong>故障确认</strong>：如果超过半数的主节点都认为某个主节点下线，那么这个主节点会被标记为确实下线（fail）。</li>
<li><strong>投票选举</strong>：在一个主节点被确认下线后，从节点会参与投票以选举一个新的主节点，投票过程中，每个从节点向其他主节点发送投票请求。</li>
<li><strong>投票决策</strong>：每个主节点在接收到投票请求后，会根据自身的判断决定是否同意这个投票请求，如果超过半数的主节点同意某个从节点成为新的主节点，那么这个从节点将被提升为新的主节点。</li>
<li><strong>故障转移</strong>：新选出的主节点开始承担主节点的角色，其他从节点更新其复制目标。</li>
</ol>
<h3 id="Redis-集群的配置"><a href="#Redis-集群的配置" class="headerlink" title="Redis 集群的配置"></a>Redis 集群的配置</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>每个 Redis 实例都需要一个独立的配置文件。以下是一个基本的 Redis 集群配置文件示例：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># Redis 集群模式</span>
cluster-enabled yes

<span class="token comment"># 集群配置文件</span>
cluster-config-file nodes.conf

<span class="token comment"># 集群节点的超时时间（毫秒）</span>
cluster-node-timeout 5000

<span class="token comment"># 集群端口（默认端口 + 10000）</span>
port 6379
cluster-announce-port 6379
cluster-announce-bus-port 16379

<span class="token comment"># 其他常规配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>将上述配置文件保存为 <code>redis.conf</code>，并复制到每个节点上。</p>
<h4 id="启动-Redis-实例"><a href="#启动-Redis-实例" class="headerlink" title="启动 Redis 实例"></a>启动 Redis 实例</h4><p>在每个节点上启动 Redis 实例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-server /path/to/redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h4><p>使用 <code>redis-cli</code> 工具创建集群。假设有 6 个节点，IP 地址和端口如下：</p>
<ul>
<li>192.168.1.1:6379</li>
<li>192.168.1.2:6379</li>
<li>192.168.1.3:6379</li>
<li>192.168.1.4:6379</li>
<li>192.168.1.5:6379</li>
<li>192.168.1.6:6379</li>
</ul>
<p>在任意一个节点上执行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">192.168</span>.1.1:6379 <span class="token number">192.168</span>.1.2:6379 <span class="token number">192.168</span>.1.3:6379 <span class="token number">192.168</span>.1.4:6379 <span class="token number">192.168</span>.1.5:6379 <span class="token number">192.168</span>.1.6:6379 --cluster-replicas <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>--cluster-replicas 1</code> 表示为每个主节点分配一个从节点。执行该命令后，Redis 会提示确认，输入 <code>yes</code> 以继续。</p>
<h4 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="查看集群状态"></a>查看集群状态</h4><p>可以使用以下命令查看集群状态：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.1.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> cluster nodes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="管理-Redis-集群"><a href="#管理-Redis-集群" class="headerlink" title="管理 Redis 集群"></a>管理 Redis 集群</h3><h4 id="添加节点"><a href="#添加节点" class="headerlink" title="添加节点"></a>添加节点</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token operator">&lt;</span>new-node-ip<span class="token operator">></span>:<span class="token operator">&lt;</span>new-node-port<span class="token operator">></span> <span class="token operator">&lt;</span>existing-node-ip<span class="token operator">></span>:<span class="token operator">&lt;</span>existing-node-port<span class="token operator">></span>
<span class="token comment">#example</span>
redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token number">192.168</span>.1.7:6379 <span class="token number">192.168</span>.1.1:6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">--cluster</span> del-node <span class="token operator">&lt;</span>existing-node-ip<span class="token operator">></span>:<span class="token operator">&lt;</span>existing-node-port<span class="token operator">></span> <span class="token operator">&lt;</span>node-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>要获取 <code>node-id</code>，可以使用 <code>cluster nodes</code> 命令查看。</p>
<h4 id="重新分片"><a href="#重新分片" class="headerlink" title="重新分片"></a>重新分片</h4><p>当集群中的节点数量发生变化时，需要重新分配哈希槽。可以使用以下命令进行重新分片：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token operator">&lt;</span>existing-node-ip<span class="token operator">></span>:<span class="token operator">&lt;</span>existing-node-port<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Redis 会提示输入要移动的哈希槽数量、源节点和目标节点。</p>
<h4 id="故障转移"><a href="#故障转移" class="headerlink" title="故障转移"></a>故障转移</h4><p>当主节点发生故障时，从节点会自动提升为主节点。如果需要手动进行故障转移，可以使用以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">--cluster</span> failover <span class="token operator">&lt;</span>existing-node-ip<span class="token operator">></span>:<span class="token operator">&lt;</span>existing-node-port<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Redis-集群的优缺点"><a href="#Redis-集群的优缺点" class="headerlink" title="Redis 集群的优缺点"></a>Redis 集群的优缺点</h3><h4 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h4><ol>
<li><strong>高可用性</strong>：通过主从复制和故障转移，实现高可用性。</li>
<li><strong>扩展性</strong>：通过数据分片，可以水平扩展 Redis 集群，处理更大的数据量和更高的吞吐量。</li>
<li><strong>负载均衡</strong>：读写请求可以分布在多个节点上，实现负载均衡。</li>
</ol>
<h4 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li><strong>管理复杂性</strong>：配置和管理 Redis 集群比单节点 Redis 更复杂。</li>
<li><strong>数据一致性</strong>：由于 Redis 集群是异步复制，可能会有短暂的数据不一致。</li>
<li><strong>客户端支持</strong>：需要使用支持 Redis 集群的客户端库。</li>
</ol>
<h3 id="常见问题-2"><a href="#常见问题-2" class="headerlink" title="常见问题"></a>常见问题</h3><h4 id="数据不一致"><a href="#数据不一致" class="headerlink" title="数据不一致"></a>数据不一致</h4><p>集群模式下，如果一个节点发生故障，可能会导致数据不一致的问题。例如，数据的写操作可能在某些节点上成功，而在其他节点上失败。</p>
<p><strong>原因</strong></p>
<p>数据不一致的原因通常是由于网络分区或节点故障。Redis 集群采用的是异步复制机制，从节点可能未及时同步主节点的数据。</p>
<p><strong>解决方法</strong></p>
<ul>
<li><strong>使用同步复制</strong>：配置Redis集群使用 <code>wait</code> 命令来确保写操作在返回之前至少传播到一定数量的从节点。</li>
<li><strong>增加复制因子</strong>：通过增加从节点的数量来提高数据的可用性和一致性。</li>
<li><strong>监控和报警</strong>：使用监控工具实时监控集群状态，及时发现并处理数据不一致问题。</li>
</ul>
<h4 id="数据迁移问题"><a href="#数据迁移问题" class="headerlink" title="数据迁移问题"></a>数据迁移问题</h4><p>在集群扩展或缩减时，数据需要在节点之间迁移，可能会导致性能下降或数据丢失。</p>
<p><strong>原因</strong></p>
<p>数据迁移过程需要大量的网络传输和计算资源，可能会影响集群的性能，如果在迁移过程中发生故障，可能导致数据丢失。</p>
<p><strong>解决方法</strong></p>
<ul>
<li><strong>平滑数据迁移</strong>：使用 Redis 提供的 <code>resharding</code> 工具进行平滑的数据迁移，确保在迁移过程中集群的可用性。</li>
<li><strong>监控迁移过程</strong>：实时监控数据迁移过程，及时处理可能出现的问题。</li>
<li><strong>数据备份</strong>：在进行数据迁移之前，进行全面的数据备份，确保在出现问题时可以进行数据恢复。</li>
</ul>
<h4 id="写扩散问题"><a href="#写扩散问题" class="headerlink" title="写扩散问题"></a>写扩散问题</h4><p>在高并发写入的场景下，集群可能会遇到写扩散（write amplification）问题，导致写入性能下降。</p>
<p><strong>原因</strong></p>
<p>写扩散是由于 Redis 集群在写入数据时，需要在多个节点之间进行同步和复制，从而导致额外的写操作和网络开销。</p>
<p><strong>解决方法</strong></p>
<ul>
<li><strong>优化写操作</strong>：减少不必要的写操作，尽量合并写请求。</li>
<li><strong>配置合理的复制策略</strong>：调整 Redis 集群的复制策略，减少写扩散带来的开销。</li>
<li><strong>负载均衡</strong>：通过负载均衡器分散写请求，减少单个节点的负载。</li>
</ul>
<h4 id="节点故障和恢复"><a href="#节点故障和恢复" class="headerlink" title="节点故障和恢复"></a>节点故障和恢复</h4><p>节点故障会导致数据不可用，影响集群的整体可用性。</p>
<p><strong>原因</strong></p>
<p>节点故障可能由硬件故障、软件错误或网络问题引起。集群在失去一个节点后，可能需要时间进行故障转移和数据恢复。</p>
<p><strong>解决方法</strong></p>
<ul>
<li><strong>冗余配置</strong>：配置多个从节点，确保在主节点故障时能够及时进行故障转移。</li>
<li><strong>自动故障转移</strong>：使用 Redis 集群的自动故障转移机制，确保在节点故障时能够自动切换到可用节点。</li>
<li><strong>定期备份</strong>：定期进行数据备份，确保在节点故障时能够进行数据恢复。</li>
</ul>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><h2 id="客户端调优"><a href="#客户端调优" class="headerlink" title="客户端调优"></a>客户端调优</h2><ol>
<li><p><strong>连接管理</strong></p>
<ul>
<li><strong>连接池</strong>：使用连接池来管理与 Redis 的连接，避免频繁的连接和断开操作，提高性能。</li>
<li><strong>长连接</strong>：使用长连接而不是短连接，减少建立连接的开销。</li>
</ul>
</li>
<li><p><strong>请求优化</strong></p>
<ul>
<li><strong>批量操作</strong>：尽可能地使用批量操作，如 <code>MGET</code>、<code>MSET</code> 等，以减少网络往返次数。</li>
<li><strong>管道化（Pipelining）</strong>：使用管道技术，将多个命令打包成一个请求，减少网络延迟。</li>
<li><strong>LUA</strong>：将多个命令打包成lua脚本，使用lua脚本执行命令</li>
</ul>
</li>
<li><p><strong>数据序列化</strong></p>
<ul>
<li><strong>高效序列化</strong>：选择高效的数据序列化方式（如 MessagePack）以减少数据传输量和序列化&#x2F;反序列化的开销。</li>
<li><strong>压缩</strong>：对于较大的数据，可以考虑在客户端压缩数据后再传输，减少网络带宽的使用。</li>
</ul>
</li>
<li><p><strong>请求模式</strong></p>
<ul>
<li><strong>合理设置超时</strong>：设置合理的连接超时和请求超时，避免长时间等待未响应的请求。</li>
<li><strong>减少阻塞操作</strong>：尽量避免使用阻塞操作，影响客户端的响应时间，尽量避免使用可能导致阻塞的命令，如 <code>KEYS</code> 和 <code>FLUSHALL</code>。</li>
</ul>
</li>
<li><p><strong>客户端并发</strong></p>
<ul>
<li><strong>分布式锁</strong>：在高并发场景下，使用 Redis 的分布式锁来保证数据一致性。</li>
<li><strong>异步操作</strong>：使用异步的 Redis 客户端库，以提高请求处理的并发性和响应速度。</li>
</ul>
</li>
</ol>
<h2 id="服务端调优"><a href="#服务端调优" class="headerlink" title="服务端调优"></a>服务端调优</h2><ol>
<li><strong>内存优化</strong><ul>
<li><strong>maxmemory</strong>：设置Redis实例的最大内存使用量，当内存使用达到限制时，Redis 会根据内存淘汰策略释放内存。</li>
<li><strong>内存分配器</strong>：选择合适的内存分配器，如 jemalloc，能更有效地管理内存。</li>
<li><strong>压缩内存</strong>：通过配置文件启用内存压缩，以节省内存。</li>
<li><strong>对象共享</strong>：多个键可以共享相同的值对象，减少内存使用，提高内存利用率</li>
<li><strong>内存淘汰策略</strong>：达到内存限制时，可以通过内存淘汰策略释放内存<ul>
<li><strong>noeviction</strong>：不淘汰任何数据，返回错误。</li>
<li><strong>allkeys-lru</strong>：使用 LRU 算法淘汰所有键。</li>
<li><strong>volatile-lru</strong>：使用 LRU 算法淘汰设置了过期时间的键。</li>
<li><strong>allkeys-random</strong>：随机淘汰所有键。</li>
<li><strong>volatile-random</strong>：随机淘汰设置了过期时间的键。</li>
<li><strong>volatile-ttl</strong>：淘汰剩余生存时间（TTL）最短的键。</li>
</ul>
</li>
</ul>
</li>
<li><strong>持久化</strong><ul>
<li><strong>优化 RDB 持久化</strong>：设置合理的快照频率和条件，避免过于频繁或过于稀疏的快照。</li>
<li><strong>AOF 持久化优化</strong>：选择适当的 AOF 持久化策略（如 <code>appendfsync everysec</code>），在性能和数据安全之间找到平衡。</li>
</ul>
</li>
<li><strong>数据结构优化</strong><ul>
<li><strong>合适的数据结构</strong>：根据使用场景选择合适的数据结构，如字符串、列表、集合、哈希等。</li>
<li><strong>减少内存占用</strong>：使用压缩列表、整数集合的特殊编码等方式，减少内存占用。</li>
</ul>
</li>
<li><strong>集群和高可用</strong><ul>
<li><strong>分片（Sharding）</strong>：将数据分布在多个 Redis 实例上，避免单个实例的性能瓶颈。</li>
<li><strong>Redis Cluster</strong>：使用 Redis Cluster 实现分布式部署，提高扩展性和高可用性。</li>
<li><strong>Sentinel</strong>：使用 Sentinel 实现主从切换和高可用，保证系统的稳定性。</li>
</ul>
</li>
</ol>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 启用压缩列表</span>
list-max-ziplist-entries 512
list-max-ziplist-value 64
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

<span class="token comment"># 启用整数集合</span>
set-max-intset-entries 512

<span class="token comment"># 启用对象共享</span>
maxmemory-sharing 1

<span class="token comment"># 配置内存淘汰策略</span>
maxmemory-policy allkeys-lru

<span class="token comment"># 启用内存压缩</span>
maxmemory-compression 1

<span class="token comment"># 配置最大内存使用量</span>
maxmemory 2gb

<span class="token comment"># 内存配置</span>
maxmemory 2gb
maxmemory-policy allkeys-lru

<span class="token comment"># 持久化配置</span>
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

<span class="token comment"># 网络配置</span>
maxclients 10000
tcp-keepalive 300<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h3><p>Redis 提供了多种缓存淘汰策略，用于在内存达到限制时自动删除一些数据，以确保系统的稳定运行。</p>
<ol>
<li><strong>noeviction</strong>：当内存达到限制时，不淘汰任何数据，直接返回错误。</li>
<li><strong>allkeys-lru</strong>：使用 LRU（Least Recently Used）算法淘汰所有键，优先淘汰最近最少使用的键。</li>
<li><strong>volatile-lru</strong>：使用 LRU 算法淘汰设置了过期时间的键。</li>
<li><strong>allkeys-random</strong>：随机淘汰所有键。</li>
<li><strong>volatile-random</strong>：随机淘汰设置了过期时间的键。</li>
<li><strong>volatile-ttl</strong>：淘汰剩余生存时间（TTL）最短的键。</li>
<li><strong>allkeys-lfu</strong>：使用 LFU（Least Frequently Used）算法淘汰所有键，优先淘汰使用频率最低的键。</li>
<li><strong>volatile-lfu</strong>：使用 LFU 算法淘汰设置了过期时间的键。</li>
</ol>
<h3 id="监控和调试"><a href="#监控和调试" class="headerlink" title="监控和调试"></a>监控和调试</h3><ol>
<li><strong>INFO memory</strong>：获取内存使用情况的详细信息。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli INFO memory<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><strong>MEMORY STATS</strong>：获取内存使用的统计信息。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli MEMORY STATS<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><strong>MEMORY USAGE</strong>：获取指定键的内存使用情况。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli MEMORY USAGE <span class="token operator">&lt;</span>key<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="安全与监控"><a href="#安全与监控" class="headerlink" title="安全与监控"></a>安全与监控</h1><h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><p><strong>身份验证</strong></p>
<p>Redis 支持通过密码进行身份验证，以防止未经授权的访问。</p>
<p><strong>配置身份验证</strong></p>
<p>可以在 Redis 配置文件（<code>redis.conf</code>）中设置密码：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 设置 Redis 密码</span>
requirepass yourpassword<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>动态设置密码</strong></p>
<p>也可以在 Redis 实例运行时，通过命令行设置密码：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli CONFIG SET requirepass yourpassword<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>客户端身份验证</strong></p>
<p>客户端连接到 Redis 服务器后，需要进行身份验证：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 客户端</span>
redis-cli <span class="token parameter variable">-a</span> yourpassword
<span class="token comment"># 第三方客户端</span>
Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"localhost"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.auth<span class="token punctuation">(</span><span class="token string">"yourpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><h3 id="自带的监控命令"><a href="#自带的监控命令" class="headerlink" title="自带的监控命令"></a>自带的监控命令</h3><ol>
<li><strong>INFO 命令</strong>：获取 Redis 实例的详细信息，包括内存使用、连接数、命中率等。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli INFO<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><strong>MONITOR 命令</strong>：实时监控 Redis 实例的所有命令执行情况。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli MONITOR<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><strong>SLOWLOG 命令</strong>：查看慢查询日志，帮助识别性能瓶颈。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli SLOWLOG GET<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="第三方监控工具"><a href="#第三方监控工具" class="headerlink" title="第三方监控工具"></a>第三方监控工具</h3><ol>
<li>Prometheus：开源的监控系统，适用于收集和存储 Redis 的监控数据。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./redis_exporter <span class="token parameter variable">--redis.addr</span><span class="token operator">=</span>redis://localhost:6379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>Grafana：开源的可视化工具，适用于展示和分析 Redis 的监控数据。</li>
</ol>
<h1 id="实践应用"><a href="#实践应用" class="headerlink" title="实践应用"></a>实践应用</h1><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><h3 id="什么是分布式锁"><a href="#什么是分布式锁" class="headerlink" title="什么是分布式锁"></a>什么是分布式锁</h3><p>分布式锁是一种在分布式系统中控制对共享资源访问的机制。它确保在同一时间只有一个进程或线程可以访问某个资源，从而避免数据不一致或竞争条件的发生。</p>
<h3 id="应用场景-9"><a href="#应用场景-9" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li><strong>分布式系统中的资源竞争</strong>：多个服务实例需要访问同一个资源，例如数据库记录或文件。</li>
<li><strong>任务调度</strong>：确保同一任务在同一时间只有一个实例在执行。</li>
<li><strong>限流</strong>：控制并发访问的数量，防止系统过载。</li>
<li><strong>分布式事务</strong>：在分布式环境中实现事务的一致性。</li>
</ol>
<h3 id="实现方式及优缺点"><a href="#实现方式及优缺点" class="headerlink" title="实现方式及优缺点"></a>实现方式及优缺点</h3><ol>
<li><strong>基于数据库的分布式锁</strong><ul>
<li><strong>优点</strong>：实现简单，适用于已有数据库的系统。</li>
<li><strong>缺点</strong>：性能较低，数据库成为瓶颈，可靠性依赖于数据库。</li>
</ul>
</li>
<li><strong>基于Redis的分布式锁</strong><ul>
<li><strong>优点</strong>：性能高，Redis的高可用性和持久化机制可以提高锁的可靠性。</li>
<li><strong>缺点</strong>：需要额外的Redis服务，可能存在锁失效问题。</li>
</ul>
</li>
<li><strong>基于Zookeeper的分布式锁</strong><ul>
<li><strong>优点</strong>：强一致性和高可靠性，适用于需要严格一致性的场景。</li>
<li><strong>缺点</strong>：实现复杂，性能相对较低，需要额外的Zookeeper服务。</li>
</ul>
</li>
</ol>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>以Redis分布式锁为例，其实现原理如下：</p>
<ol>
<li><strong>获取锁</strong>：使用<code>SETNX</code>命令（SET if Not eXists）在Redis中创建一个键，如果键不存在则创建并返回成功，否则返回失败。</li>
<li><strong>设置过期时间</strong>：使用<code>EXPIRE</code>命令为键设置过期时间，防止死锁。</li>
<li><strong>释放锁</strong>：使用<code>DEL</code>命令删除键，释放锁。</li>
</ol>
<h3 id="应用示例"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例</h3><p>假设我们有一个电商系统，多个服务实例需要同时更新库存。为了避免超卖问题，我们需要使用分布式锁来确保同一时间只有一个实例可以更新库存。</p>
<h4 id="基于Redis的分布式锁实现"><a href="#基于Redis的分布式锁实现" class="headerlink" title="基于Redis的分布式锁实现"></a>基于Redis的分布式锁实现</h4><p>在生产环境中，我们可以使用Redisson库来简化Redis分布式锁的实现。Redisson是一个高效的Redis客户端，提供了许多高级功能，包括分布式锁。</p>
<p><strong>代码实现</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisDistributedLock</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">acquireLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> ops <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> lockValue <span class="token operator">=</span> <span class="token function">generateLockValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用线程ID和时间戳生成唯一标识</span>

        <span class="token comment">// 如果键不存在，设置键的值并返回true；如果键已经存在，则返回false</span>
        <span class="token class-name">Boolean</span> success <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> lockValue<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>success <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> success<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> lockValue<span class="token punctuation">;</span> <span class="token comment">// 返回锁的唯一标识</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">releaseLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token class-name">String</span> lockValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> ops <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> currentValue <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>lockValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>currentValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">generateLockValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="优先级队列"><a href="#优先级队列" class="headerlink" title="优先级队列"></a>优先级队列</h2><h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><ol>
<li><strong>使用 Redis 的 Sorted Set</strong>：利用 Redis 的 Sorted Set 数据结构来存储队列中的元素，元素的优先级作为分数。</li>
<li><strong>使用 Lua 脚本</strong>：并发环境中，单个redis的命令是原子性，但是多个命令组合才能实现优先级队列功能（ZRANGE、ZREM），多个命令组合无法保证原子性，Lua脚本在Redis中是原子执行的。即使有多个客户端同时执行 Lua 脚本，Redis 也会保证脚本在执行期间不会被其他命令打断，通过Lua脚本来保证操作的原子性，避免并发问题。</li>
</ol>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><ol>
<li><strong>入队</strong>：将元素添加到 Sorted Set 中，优先级作为分数。</li>
<li><strong>出队</strong>：从 Sorted Set 中移除并返回分数最小的元素（优先级最高）。</li>
</ol>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>需要两个 Lua 脚本，一个用于入队，一个用于出队。</p>
<h4 id="入队脚本（enqueue-lua）"><a href="#入队脚本（enqueue-lua）" class="headerlink" title="入队脚本（enqueue.lua）"></a>入队脚本（enqueue.lua）</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">-- enqueue.lua</span>
<span class="token comment">-- 参数：KEYS[1] - 队列名</span>
<span class="token comment">-- 参数：ARGV[1] - 元素</span>
<span class="token comment">-- 参数：ARGV[2] - 优先级</span>

redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'ZADD'</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ARGV<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="出队脚本（dequeue-lua）"><a href="#出队脚本（dequeue-lua）" class="headerlink" title="出队脚本（dequeue.lua）"></a>出队脚本（dequeue.lua）</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">-- dequeue.lua</span>
<span class="token comment">-- 参数：KEYS[1] - 队列名</span>

<span class="token keyword">local</span> result <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'ZRANGE'</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
    redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'ZREM'</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token keyword">nil</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="RedisPriorityQueueService-java"><a href="#RedisPriorityQueueService-java" class="headerlink" title="RedisPriorityQueueService.java"></a>RedisPriorityQueueService.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisPriorityQueueService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> enqueueScript<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> dequeueScript<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RedisPriorityQueueService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>enqueueScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enqueueScript<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScriptSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceScriptSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"scripts/enqueue.lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enqueueScript<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>dequeueScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dequeueScript<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScriptSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceScriptSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"scripts/dequeue.lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dequeueScript<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token comment">//入队</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token class-name">String</span> queueName<span class="token punctuation">,</span> <span class="token class-name">String</span> element<span class="token punctuation">,</span> <span class="token keyword">double</span> priority<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>enqueueScript<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>queueName<span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token comment">//出队</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token class-name">String</span> queueName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>dequeueScript<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>queueName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="计数器和限流"><a href="#计数器和限流" class="headerlink" title="计数器和限流"></a>计数器和限流</h2><h3 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h3><p>计数器是一种常见的应用场景，用于统计某个事件的发生次数，例如访问次数、点赞次数等。在分布式系统中，可以使用 Redis 来实现高效的分布式计数器。</p>
<h3 id="实现原理-1"><a href="#实现原理-1" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li><strong>递增计数</strong>：使用 Redis 的 <code>INCR</code> 命令对指定键的值进行递增操作。</li>
<li><strong>获取计数</strong>：使用 Redis 的 <code>GET</code> 命令获取指定键的值。</li>
</ol>
<h3 id="应用示例-1"><a href="#应用示例-1" class="headerlink" title="应用示例"></a>应用示例</h3><p>有一个网站，需要统计每个页面的访问次数。我们可以使用 Redis 来实现分布式计数器。</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCounterService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 递增计数器
     * @param key 计数器的键
     * @return 递增后的值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">incrementCounter</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 获取计数器的值
     * @param key 计数器的键
     * @return 计数器的值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0L</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h3><p>限流是一种常见的应用场景，用于控制并发访问的数量，防止系统过载。在分布式系统中，可以使用 Redis 来实现高效的分布式限流。</p>
<h3 id="实现原理-2"><a href="#实现原理-2" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li><strong>令牌桶算法</strong>：使用 Redis 的 <code>INCR</code> 和 <code>EXPIRE</code> 命令实现令牌桶算法。每次请求到来时，检查令牌桶中的令牌数量，如果令牌数量足够，则允许请求，否则拒绝请求。</li>
<li><strong>滑动窗口算法</strong>：使用 Redis 的 <code>ZADD</code> 和 <code>ZREMRANGEBYSCORE</code> 命令实现滑动窗口算法。每次请求到来时，记录请求的时间戳，并删除过期的请求记录。</li>
</ol>
<h3 id="应用示例-2"><a href="#应用示例-2" class="headerlink" title="应用示例"></a>应用示例</h3><p>我们有一个 API 接口，需要限制每分钟的访问次数不超过100次。我们可以使用Redis来实现分布式限流。</p>
<h4 id="基于令牌桶算法的限流实现"><a href="#基于令牌桶算法的限流实现" class="headerlink" title="基于令牌桶算法的限流实现"></a>基于令牌桶算法的限流实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisRateLimiterService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 检查是否允许请求
     * @param key 限流的键
     * @param limit 每分钟的请求限制
     * @return 是否允许请求
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAllowed</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> currentTimeMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> currentMinute <span class="token operator">=</span> currentTimeMillis <span class="token operator">/</span> <span class="token number">60000</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> currentMinute<span class="token punctuation">;</span>

        <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> count <span class="token operator">&lt;=</span> limit<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="基于滑动窗口算法的限流实现"><a href="#基于滑动窗口算法的限流实现" class="headerlink" title="基于滑动窗口算法的限流实现"></a>基于滑动窗口算法的限流实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisSlidingWindowRateLimiterService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 检查是否允许请求
     * @param key 限流的键
     * @param limit 每分钟的请求限制
     * @return 是否允许请求
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAllowed</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> currentTimeMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token string">":requests"</span><span class="token punctuation">;</span>

        <span class="token comment">// 删除一分钟前的请求记录</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeRangeByScore</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> currentTimeMillis <span class="token operator">-</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 记录当前请求</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>currentTimeMillis<span class="token punctuation">)</span><span class="token punctuation">,</span> currentTimeMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取当前时间窗口内的请求数量</span>
        <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zCard</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> count <span class="token operator">&lt;=</span> limit<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="地理位置服务"><a href="#地理位置服务" class="headerlink" title="地理位置服务"></a>地理位置服务</h2><h3 id="什么是地理位置服务"><a href="#什么是地理位置服务" class="headerlink" title="什么是地理位置服务"></a>什么是地理位置服务</h3><p>地理位置服务是一种基于地理空间数据的服务，允许存储和查询地理位置数据。Redis 提供了内置的地理空间数据结构，可以高效地存储和查询地理位置数据。</p>
<h3 id="应用场景-10"><a href="#应用场景-10" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li><strong>查找附近的地点</strong>：例如查找附近的餐馆、加油站等。</li>
<li><strong>用户位置跟踪</strong>：实时跟踪用户位置，提供基于位置的服务。</li>
<li><strong>地理围栏</strong>：检测用户是否进入或离开特定的地理区域。</li>
</ol>
<h3 id="实现方式及优缺点-1"><a href="#实现方式及优缺点-1" class="headerlink" title="实现方式及优缺点"></a>实现方式及优缺点</h3><ol>
<li>基于数据库的地理位置服务<ul>
<li><strong>优点</strong>：实现简单，适用于已有数据库的系统。</li>
<li><strong>缺点</strong>：性能较低，数据库成为瓶颈，查询效率较低。</li>
</ul>
</li>
<li>基于Redis的地理位置服务<ul>
<li><strong>优点</strong>：性能高，Redis 的内置地理空间数据结构可以高效存储和查询地理位置数据。</li>
<li><strong>缺点</strong>：需要额外的 Redis 服务。</li>
</ul>
</li>
</ol>
<h3 id="实现原理-3"><a href="#实现原理-3" class="headerlink" title="实现原理"></a>实现原理</h3><p>Redis 提供了以下几个命令用于地理位置服务：</p>
<ol>
<li><strong>GEOADD</strong>：将地理位置添加到指定的键中。</li>
<li><strong>GEODIST</strong>：计算两个地理位置之间的距离。</li>
<li><strong>GEORADIUS</strong>：查找指定范围内的地理位置。</li>
<li><strong>GEOHASH</strong>：获取地理位置的 Geohash 值。</li>
</ol>
<h3 id="应用示例-3"><a href="#应用示例-3" class="headerlink" title="应用示例"></a>应用示例</h3><p>有一个应用，需要存储多个地点的地理位置，并提供查找附近地点的功能。我们可以使用 Redis 来实现地理位置服务。</p>
<h4 id="基于Redis的地理位置服务实现"><a href="#基于Redis的地理位置服务实现" class="headerlink" title="基于Redis的地理位置服务实现"></a>基于Redis的地理位置服务实现</h4><p>生产环境中，我们可以使用RedisTemplate来简化Redis地理位置服务的实现。</p>
<p><strong>代码实现</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisGeoService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 添加地理位置
     * @param key 键
     * @param longitude 经度
     * @param latitude 纬度
     * @param member 地点名称
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addGeoLocation</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">double</span> longitude<span class="token punctuation">,</span> <span class="token keyword">double</span> latitude<span class="token punctuation">,</span> <span class="token class-name">String</span> member<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">)</span><span class="token punctuation">,</span> member<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 计算两个地点之间的距离
     * @param key 键
     * @param member1 地点1
     * @param member2 地点2
     * @param metric 距离单位
     * @return 距离
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Distance</span> <span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> member1<span class="token punctuation">,</span> <span class="token class-name">String</span> member2<span class="token punctuation">,</span> <span class="token class-name">Metric</span> metric<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> member1<span class="token punctuation">,</span> member2<span class="token punctuation">,</span> metric<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 查找指定范围内的地点
     * @param key 键
     * @param longitude 经度
     * @param latitude 纬度
     * @param radius 范围
     * @param metric 距离单位
     * @return 附近的地点
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">GeoResults</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedisGeoCommands<span class="token punctuation">.</span>GeoLocation</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">getNearbyLocations</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">double</span> longitude<span class="token punctuation">,</span> <span class="token keyword">double</span> latitude<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">,</span> <span class="token class-name">Metric</span> metric<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Circle</span> within <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Distance</span><span class="token punctuation">(</span>radius<span class="token punctuation">,</span> metric<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">radius</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> within<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 获取地理位置的 Geohash 值
     * @param key 键
     * @param members 地点名称
     * @return Geohash 值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getGeoHash</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> members<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> members<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><p>以下是一些使用地理位置服务的示例：</p>
<h4 id="添加地理位置"><a href="#添加地理位置" class="headerlink" title="添加地理位置"></a>添加地理位置</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisGeoService</span> redisGeoService<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    redisGeoService<span class="token punctuation">.</span><span class="token function">addGeoLocation</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">13.361389</span><span class="token punctuation">,</span> <span class="token number">38.115556</span><span class="token punctuation">,</span> <span class="token string">"Palermo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redisGeoService<span class="token punctuation">.</span><span class="token function">addGeoLocation</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">15.087269</span><span class="token punctuation">,</span> <span class="token number">37.502669</span><span class="token punctuation">,</span> <span class="token string">"Catania"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="计算两个地点之间的距离"><a href="#计算两个地点之间的距离" class="headerlink" title="计算两个地点之间的距离"></a>计算两个地点之间的距离</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisGeoService</span> redisGeoService<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">calculateDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Distance</span> distance <span class="token operator">=</span> redisGeoService<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token string">"Palermo"</span><span class="token punctuation">,</span> <span class="token string">"Catania"</span><span class="token punctuation">,</span> <span class="token class-name">Metrics</span><span class="token punctuation">.</span><span class="token constant">KILOMETERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Distance: "</span> <span class="token operator">+</span> distance<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" km"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="查找指定范围内的地点"><a href="#查找指定范围内的地点" class="headerlink" title="查找指定范围内的地点"></a>查找指定范围内的地点</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisGeoService</span> redisGeoService<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findNearbyLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">GeoResults</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedisGeoCommands<span class="token punctuation">.</span>GeoLocation</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> results <span class="token operator">=</span> redisGeoService<span class="token punctuation">.</span><span class="token function">getNearbyLocations</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">Metrics</span><span class="token punctuation">.</span><span class="token constant">KILOMETERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">GeoResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedisGeoCommands<span class="token punctuation">.</span>GeoLocation</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> result <span class="token operator">:</span> results<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Location: "</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", Distance: "</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" km"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="获取地理位置的-Geohash-值"><a href="#获取地理位置的-Geohash-值" class="headerlink" title="获取地理位置的 Geohash 值"></a>获取地理位置的 Geohash 值</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisGeoService</span> redisGeoService<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getGeoHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> geoHashes <span class="token operator">=</span> redisGeoService<span class="token punctuation">.</span><span class="token function">getGeoHash</span><span class="token punctuation">(</span><span class="token string">"locations"</span><span class="token punctuation">,</span> <span class="token string">"Palermo"</span><span class="token punctuation">,</span> <span class="token string">"Catania"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> geoHash <span class="token operator">:</span> geoHashes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Geohash: "</span> <span class="token operator">+</span> geoHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Orion Potter
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://orionpotter.icu/post/Redis%E5%AE%9E%E8%B7%B5.html" title="Redis实践">https://orionpotter.icu/post/Redis%E5%AE%9E%E8%B7%B5.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"># redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/SpringBoot%E5%AE%9E%E8%B7%B5.html" rel="next" title="SpringBoot实践">
                <i class="fa fa-chevron-left"></i> SpringBoot实践
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/RESTful%20API%E8%AE%BE%E8%AE%A1.html" rel="prev" title="RESTful API设计">
                RESTful API设计 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">52</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/OrionPotter" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/imlzgg" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">Redis介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">1.1.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">1.1.2.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9snapd%E5%95%86%E5%BA%97%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.1.</span> <span class="nav-text">官方snapd商店安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85-%E6%8E%A8%E8%8D%90"><span class="nav-number">1.2.2.</span> <span class="nav-text">官方源码安装[推荐]</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">基本命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="nav-number">2.2.</span> <span class="nav-text">数据结构操作命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-number">2.2.1.</span> <span class="nav-text">String（字符串）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="nav-number">2.2.2.</span> <span class="nav-text">Hash（哈希）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-1"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-1"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="nav-number">2.2.2.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="nav-number">2.2.3.</span> <span class="nav-text">List（列表）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-2"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-2"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-2"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">2.2.4.</span> <span class="nav-text">Set（集合）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-3"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-3"><span class="nav-number">2.2.4.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-3"><span class="nav-number">2.2.4.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sorted-Set%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">2.2.5.</span> <span class="nav-text">Sorted Set（有序集合）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-4"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="nav-number">2.2.5.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-4"><span class="nav-number">2.2.5.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-4"><span class="nav-number">2.2.5.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89"><span class="nav-number">2.2.6.</span> <span class="nav-text">Bitmap（位图）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-5"><span class="nav-number">2.2.6.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="nav-number">2.2.6.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-5"><span class="nav-number">2.2.6.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-5"><span class="nav-number">2.2.6.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HyperLogLog"><span class="nav-number">2.2.7.</span> <span class="nav-text">HyperLogLog</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-6"><span class="nav-number">2.2.7.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-6"><span class="nav-number">2.2.7.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-6"><span class="nav-number">2.2.7.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-6"><span class="nav-number">2.2.7.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Geo%EF%BC%88%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%EF%BC%89"><span class="nav-number">2.2.8.</span> <span class="nav-text">Geo（地理空间）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-7"><span class="nav-number">2.2.8.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-7"><span class="nav-number">2.2.8.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-7"><span class="nav-number">2.2.8.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-7"><span class="nav-number">2.2.8.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stream%EF%BC%88%E6%B5%81%EF%BC%89"><span class="nav-number">2.2.9.</span> <span class="nav-text">Stream（流）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-8"><span class="nav-number">2.2.9.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-8"><span class="nav-number">2.2.9.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0-8"><span class="nav-number">2.2.9.3.</span> <span class="nav-text">常用命令及参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-8"><span class="nav-number">2.2.9.4.</span> <span class="nav-text">示例代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">2.3.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MULTI-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.1.</span> <span class="nav-text">MULTI 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXEC-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.2.</span> <span class="nav-text">EXEC 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DISCARD-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.3.</span> <span class="nav-text">DISCARD 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WATCH-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.4.</span> <span class="nav-text">WATCH 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">2.3.5.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%B1%E8%B4%A5%E5%9C%BA%E6%99%AF"><span class="nav-number">2.3.6.</span> <span class="nav-text">事务失败场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LUA%E8%84%9A%E6%9C%AC"><span class="nav-number">2.4.</span> <span class="nav-text">LUA脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">2.4.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EVAL-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.4.2.</span> <span class="nav-text">EVAL 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EVALSHA-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.4.3.</span> <span class="nav-text">EVALSHA 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88LUA%E8%83%BD%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="nav-number">2.4.4.</span> <span class="nav-text">为什么LUA能保证原子性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LUA%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.4.5.</span> <span class="nav-text">LUA应用场景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">3.</span> <span class="nav-text">高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">3.1.</span> <span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB-%E5%BF%AB%E7%85%A7"><span class="nav-number">3.1.1.</span> <span class="nav-text">RDB 快照</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-1"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E7%94%9F%E6%88%90%E5%92%8C%E6%81%A2%E5%A4%8D-RDB-%E5%BF%AB%E7%85%A7"><span class="nav-number">3.1.1.4.</span> <span class="nav-text">手动生成和恢复 RDB 快照</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF-%E6%97%A5%E5%BF%97"><span class="nav-number">3.1.2.</span> <span class="nav-text">AOF 日志</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-2"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="nav-number">3.1.2.3.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AOF%E9%87%8D%E5%86%99"><span class="nav-number">3.1.2.4.</span> <span class="nav-text">AOF重写</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9"><span class="nav-number">3.1.3.</span> <span class="nav-text">持久化策略选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6"><span class="nav-number">3.2.</span> <span class="nav-text">复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.2.1.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B"><span class="nav-number">3.2.2.</span> <span class="nav-text">复制过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">3.2.3.</span> <span class="nav-text">配置主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E8%8A%82%E7%82%B9"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">配置主节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%8E%E8%8A%82%E7%82%B9"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">配置从节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E4%BB%8E%E8%8A%82%E7%82%B9"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">取消从节点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">3.2.4.</span> <span class="nav-text">管理主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">查看复制状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E5%BB%B6%E8%BF%9F"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">复制延迟</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E6%96%AD%E5%BC%80%E5%92%8C%E9%87%8D%E8%BF%9E"><span class="nav-number">3.2.4.3.</span> <span class="nav-text">复制断开和重连</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="nav-number">3.2.5.</span> <span class="nav-text">高级配置选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#repl-diskless-sync"><span class="nav-number">3.2.5.1.</span> <span class="nav-text">repl-diskless-sync</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#repl-diskless-sync-delay"><span class="nav-number">3.2.5.2.</span> <span class="nav-text">repl-diskless-sync-delay</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#min-replicas-to-write-%E5%92%8C-min-replicas-max-lag"><span class="nav-number">3.2.5.3.</span> <span class="nav-text">min-replicas-to-write 和 min-replicas-max-lag</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">3.2.6.</span> <span class="nav-text">主从复制的优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-3"><span class="nav-number">3.2.6.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-3"><span class="nav-number">3.2.6.2.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">3.2.7.</span> <span class="nav-text">常见问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%A8%E5%85%B5"><span class="nav-number">3.3.</span> <span class="nav-text">哨兵</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-Sentinel-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-number">3.3.1.</span> <span class="nav-text">Redis Sentinel 的主要功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.2.</span> <span class="nav-text">Sentinel 的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sentinel-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">Sentinel 配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-Sentinel"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">启动 Sentinel</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-x2F-%E7%AE%97%E6%B3%95-x2F-%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B-x2F-%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E8%BF%87%E7%A8%8B"><span class="nav-number">3.3.3.</span> <span class="nav-text">原理&#x2F;算法&#x2F;选举过程&#x2F;故障转移过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E7%9A%84%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.4.</span> <span class="nav-text">Sentinel 的高级配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">3.3.4.1.</span> <span class="nav-text">客户端重定向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.4.2.</span> <span class="nav-text">安全配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%92%8C%E7%9B%91%E6%8E%A7"><span class="nav-number">3.3.4.3.</span> <span class="nav-text">日志和监控</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.5.</span> <span class="nav-text">示例配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%A4%9A%E4%B8%AA-Sentinel-%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.3.6.</span> <span class="nav-text">启动多个 Sentinel 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-1"><span class="nav-number">3.3.7.</span> <span class="nav-text">常见问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4"><span class="nav-number">3.4.</span> <span class="nav-text">集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="nav-number">3.4.1.</span> <span class="nav-text">Redis 集群的架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">数据分片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">高可用性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E4%B8%BE%E7%AE%97%E6%B3%95"><span class="nav-number">3.4.2.</span> <span class="nav-text">选举算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.4.3.</span> <span class="nav-text">Redis 集群的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-Redis-%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">启动 Redis 实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="nav-number">3.4.3.3.</span> <span class="nav-text">创建集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="nav-number">3.4.3.4.</span> <span class="nav-text">查看集群状态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86-Redis-%E9%9B%86%E7%BE%A4"><span class="nav-number">3.4.4.</span> <span class="nav-text">管理 Redis 集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9"><span class="nav-number">3.4.4.1.</span> <span class="nav-text">添加节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="nav-number">3.4.4.2.</span> <span class="nav-text">删除节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%88%86%E7%89%87"><span class="nav-number">3.4.4.3.</span> <span class="nav-text">重新分片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="nav-number">3.4.4.4.</span> <span class="nav-text">故障转移</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">3.4.5.</span> <span class="nav-text">Redis 集群的优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-4"><span class="nav-number">3.4.5.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-4"><span class="nav-number">3.4.5.2.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-2"><span class="nav-number">3.4.6.</span> <span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="nav-number">3.4.6.1.</span> <span class="nav-text">数据不一致</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E9%97%AE%E9%A2%98"><span class="nav-number">3.4.6.2.</span> <span class="nav-text">数据迁移问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E6%89%A9%E6%95%A3%E9%97%AE%E9%A2%98"><span class="nav-number">3.4.6.3.</span> <span class="nav-text">写扩散问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E6%95%85%E9%9A%9C%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-number">3.4.6.4.</span> <span class="nav-text">节点故障和恢复</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E4%BC%98"><span class="nav-number">4.1.</span> <span class="nav-text">客户端调优</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B0%83%E4%BC%98"><span class="nav-number">4.2.</span> <span class="nav-text">服务端调优</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="nav-number">4.2.1.</span> <span class="nav-text">缓存策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E8%AF%95"><span class="nav-number">4.2.2.</span> <span class="nav-text">监控和调试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E4%B8%8E%E7%9B%91%E6%8E%A7"><span class="nav-number">5.</span> <span class="nav-text">安全与监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">5.1.</span> <span class="nav-text">安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7"><span class="nav-number">5.2.</span> <span class="nav-text">监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%B8%A6%E7%9A%84%E7%9B%91%E6%8E%A7%E5%91%BD%E4%BB%A4"><span class="nav-number">5.2.1.</span> <span class="nav-text">自带的监控命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7"><span class="nav-number">5.2.2.</span> <span class="nav-text">第三方监控工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E5%BA%94%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">实践应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">6.1.</span> <span class="nav-text">分布式锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">6.1.1.</span> <span class="nav-text">什么是分布式锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-9"><span class="nav-number">6.1.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">6.1.3.</span> <span class="nav-text">实现方式及优缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">6.1.4.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.1.5.</span> <span class="nav-text">应用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8ERedis%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.1.5.1.</span> <span class="nav-text">基于Redis的分布式锁实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97"><span class="nav-number">6.2.</span> <span class="nav-text">优先级队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="nav-number">6.2.1.</span> <span class="nav-text">设计思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-number">6.2.2.</span> <span class="nav-text">实现步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.3.</span> <span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A5%E9%98%9F%E8%84%9A%E6%9C%AC%EF%BC%88enqueue-lua%EF%BC%89"><span class="nav-number">6.2.3.1.</span> <span class="nav-text">入队脚本（enqueue.lua）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BA%E9%98%9F%E8%84%9A%E6%9C%AC%EF%BC%88dequeue-lua%EF%BC%89"><span class="nav-number">6.2.3.2.</span> <span class="nav-text">出队脚本（dequeue.lua）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RedisPriorityQueueService-java"><span class="nav-number">6.2.3.3.</span> <span class="nav-text">RedisPriorityQueueService.java</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8%E5%92%8C%E9%99%90%E6%B5%81"><span class="nav-number">6.3.</span> <span class="nav-text">计数器和限流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">6.3.1.</span> <span class="nav-text">计数器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-1"><span class="nav-number">6.3.2.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">6.3.3.</span> <span class="nav-text">应用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">6.3.3.1.</span> <span class="nav-text">代码实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%90%E6%B5%81"><span class="nav-number">6.3.4.</span> <span class="nav-text">限流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-2"><span class="nav-number">6.3.5.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B-2"><span class="nav-number">6.3.6.</span> <span class="nav-text">应用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95%E7%9A%84%E9%99%90%E6%B5%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.3.6.1.</span> <span class="nav-text">基于令牌桶算法的限流实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%AE%97%E6%B3%95%E7%9A%84%E9%99%90%E6%B5%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.3.6.2.</span> <span class="nav-text">基于滑动窗口算法的限流实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.4.</span> <span class="nav-text">地理位置服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.4.1.</span> <span class="nav-text">什么是地理位置服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-10"><span class="nav-number">6.4.2.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9-1"><span class="nav-number">6.4.3.</span> <span class="nav-text">实现方式及优缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3"><span class="nav-number">6.4.4.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B-3"><span class="nav-number">6.4.5.</span> <span class="nav-text">应用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8ERedis%E7%9A%84%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.4.5.1.</span> <span class="nav-text">基于Redis的地理位置服务实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.4.6.</span> <span class="nav-text">使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.4.6.1.</span> <span class="nav-text">添加地理位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E4%B8%A4%E4%B8%AA%E5%9C%B0%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB"><span class="nav-number">6.4.6.2.</span> <span class="nav-text">计算两个地点之间的距离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%8C%87%E5%AE%9A%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E5%9C%B0%E7%82%B9"><span class="nav-number">6.4.6.3.</span> <span class="nav-text">查找指定范围内的地点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E7%9A%84-Geohash-%E5%80%BC"><span class="nav-number">6.4.6.4.</span> <span class="nav-text">获取地理位置的 Geohash 值</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Orion Potter</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">225.5k</span>
  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
